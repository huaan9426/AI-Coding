# ç¬¬11ç«  Kubernetesè°ƒè¯•ä¸æ•…éšœæ’æŸ¥

## æœ¬ç« æ¦‚è¿°

åœ¨å‰é¢çš„ç« èŠ‚ä¸­,æˆ‘ä»¬ç³»ç»Ÿå­¦ä¹ äº†Kubernetesçš„æ ¸å¿ƒæ¦‚å¿µã€èµ„æºç®¡ç†ã€ç½‘ç»œå­˜å‚¨ã€å®‰å…¨æœºåˆ¶ã€ç›‘æ§å¯è§‚æµ‹æ€§ä»¥åŠé«˜çº§ç‰¹æ€§ã€‚ç„¶è€Œ,åœ¨ç”Ÿäº§ç¯å¢ƒä¸­,é—®é¢˜å’Œæ•…éšœæ˜¯ä¸å¯é¿å…çš„ã€‚ä¸€ä¸ªæˆç†Ÿçš„Kuberneteså·¥ç¨‹å¸ˆä¸ä»…è¦ä¼šéƒ¨ç½²åº”ç”¨,æ›´è¦èƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œè§£å†³å„ç§ç–‘éš¾é—®é¢˜ã€‚

**ä¸ºä»€ä¹ˆè°ƒè¯•ä¸æ•…éšœæ’æŸ¥å¦‚æ­¤é‡è¦?**

è€ƒè™‘ä»¥ä¸‹ç”Ÿäº§åœºæ™¯:

ğŸš¨ **åº”ç”¨æ•…éšœåœºæ™¯**:
- Podä¸€ç›´å¤„äºPendingçŠ¶æ€,æ— æ³•è°ƒåº¦åˆ°èŠ‚ç‚¹
- å®¹å™¨åå¤CrashLoopBackOff,æ—¥å¿—æ˜¾ç¤ºå†…å­˜ä¸è¶³
- Serviceæ— æ³•è®¿é—®,ä½†PodçŠ¶æ€æ­£å¸¸
- Ingressé…ç½®æ­£ç¡®,ä½†åŸŸåæ— æ³•è§£æ
- StatefulSetæ»šåŠ¨æ›´æ–°å¡ä½,åªæ›´æ–°äº†ä¸€ä¸ªPod

ğŸ”¥ **æ€§èƒ½é—®é¢˜åœºæ™¯**:
- APIè¯·æ±‚å»¶è¿Ÿçªç„¶ä»100mså¢åŠ åˆ°5ç§’
- èŠ‚ç‚¹CPU/å†…å­˜èµ„æºè€—å°½,å¤§é‡Podè¢«é©±é€
- etcdæ€§èƒ½ä¸‹é™,API Serverå“åº”ç¼“æ…¢
- ç½‘ç»œååé‡å¼‚å¸¸,Podé—´é€šä¿¡ä¸¢åŒ…ç‡é«˜
- å­˜å‚¨IOæ€§èƒ½å·®,æ•°æ®åº“å“åº”æ…¢

ğŸŒŠ **é›†ç¾¤çº§æ•…éšœåœºæ™¯**:
- MasterèŠ‚ç‚¹å®•æœº,æ§åˆ¶å¹³é¢ä¸å¯ç”¨
- WorkerèŠ‚ç‚¹NotReady,Podå¤§è§„æ¨¡è¿ç§»
- DNSæœåŠ¡æ•…éšœ,æ‰€æœ‰æœåŠ¡å‘ç°å¤±è´¥
- CNIæ’ä»¶å¼‚å¸¸,æ–°å»ºPodæ— æ³•åˆ†é…IP
- Controller Manager OOM,æ§åˆ¶å™¨åœæ­¢å·¥ä½œ

è¿™äº›é—®é¢˜å¦‚æœä¸èƒ½å¿«é€Ÿå®šä½å’Œè§£å†³,å°†å¯¼è‡´:
- **ä¸šåŠ¡ä¸­æ–­** - ç”¨æˆ·æ— æ³•è®¿é—®æœåŠ¡,é€ æˆç»æµæŸå¤±
- **æ•°æ®ä¸¢å¤±** - æŒä¹…åŒ–å­˜å‚¨é—®é¢˜å¯¼è‡´æ•°æ®æŸå
- **é›ªå´©æ•ˆåº”** - ä¸€ä¸ªç»„ä»¶æ•…éšœå¼•å‘è¿é”ååº”
- **ä¿¡ä»»å±æœº** - é¢‘ç¹æ•…éšœå½±å“å›¢é˜Ÿå¯¹Kubernetesçš„ä¿¡å¿ƒ

**æœ¬ç« ä¸»è¦å†…å®¹**:

1. **è°ƒè¯•å·¥å…·ä¸æ–¹æ³•è®º** (11.1)
   - ç³»ç»ŸåŒ–æ•…éšœæ’æŸ¥æ–¹æ³•
   - kubectlæ ¸å¿ƒè°ƒè¯•å‘½ä»¤
   - å®¹å™¨å†…è°ƒè¯•æŠ€å·§
   - ç½‘ç»œè°ƒè¯•å·¥å…·é“¾

2. **Podæ•…éšœæ’æŸ¥** (11.2)
   - Podç”Ÿå‘½å‘¨æœŸé—®é¢˜
   - é•œåƒæ‹‰å–å¤±è´¥
   - èµ„æºä¸è¶³å¯¼è‡´çš„é—®é¢˜
   - å¥åº·æ£€æŸ¥é…ç½®é”™è¯¯

3. **ç½‘ç»œé—®é¢˜è¯Šæ–­** (11.3)
   - Serviceä¸å¯è¾¾
   - DNSè§£æå¤±è´¥
   - ç½‘ç»œç­–ç•¥é—®é¢˜
   - CNIæ’ä»¶æ•…éšœ

4. **å­˜å‚¨æ•…éšœå¤„ç†** (11.4)
   - PVCç»‘å®šå¤±è´¥
   - å­˜å‚¨æ€§èƒ½é—®é¢˜
   - æ•°æ®ä¸¢å¤±æ¢å¤
   - StorageClassé…ç½®

5. **èŠ‚ç‚¹ä¸é›†ç¾¤æ•…éšœ** (11.5)
   - èŠ‚ç‚¹NotReadyè¯Šæ–­
   - æ§åˆ¶å¹³é¢ç»„ä»¶æ•…éšœ
   - etcdé›†ç¾¤é—®é¢˜
   - èµ„æºè€—å°½å¤„ç†

6. **åº”ç”¨è°ƒè¯•æœ€ä½³å®è·µ** (11.6)
   - æ—¥å¿—åˆ†ææŠ€å·§
   - æ€§èƒ½åˆ†æå·¥å…·
   - è¿œç¨‹è°ƒè¯•æ–¹æ³•
   - ç”Ÿäº§ç¯å¢ƒdebugæŠ€å·§

7. **æ•…éšœæ¡ˆä¾‹åˆ†æ** (11.7)
   - çœŸå®ç”Ÿäº§æ•…éšœå¤ç›˜
   - æ ¹å› åˆ†ææ–¹æ³•
   - é¢„é˜²æªæ–½åˆ¶å®š
   - åº”æ€¥å“åº”æµç¨‹

8. **æœ¬ç« æ€»ç»“** (11.8)
   - æ ¸å¿ƒçŸ¥è¯†å›é¡¾
   - è°ƒè¯•æŠ€èƒ½æ¸…å•
   - å­¦ä¹ èµ„æºæ¨è

**å­¦ä¹ ç›®æ ‡**:

- âœ… æŒæ¡ç³»ç»ŸåŒ–çš„æ•…éšœæ’æŸ¥æ–¹æ³•è®º
- âœ… ç†Ÿç»ƒä½¿ç”¨kubectlå’Œå®¹å™¨è°ƒè¯•å·¥å…·
- âœ… èƒ½å¤Ÿå¿«é€Ÿå®šä½Podã€ç½‘ç»œã€å­˜å‚¨é—®é¢˜
- âœ… ç†è§£é›†ç¾¤çº§æ•…éšœçš„è¯Šæ–­æµç¨‹
- âœ… å­¦ä¼šåˆ†æç”Ÿäº§ç¯å¢ƒå¤æ‚é—®é¢˜
- âœ… å»ºç«‹é¢„é˜²æ€§æ•…éšœå¤„ç†æœºåˆ¶

**å‰ç½®çŸ¥è¯†**:

- ç†Ÿæ‚‰Kubernetesæ ¸å¿ƒæ¦‚å¿µ(ç¬¬1-4ç« )
- ç†è§£ç½‘ç»œå’Œå­˜å‚¨æœºåˆ¶(ç¬¬5-6ç« )
- æŒæ¡ç›‘æ§å’Œæ—¥å¿—åˆ†æ(ç¬¬9ç« )

**æŠ€èƒ½ç­‰çº§è¦æ±‚**:

```yaml
åˆçº§è¿ç»´å·¥ç¨‹å¸ˆ:
  - ä¼šä½¿ç”¨kubectl describe/logsæŸ¥çœ‹åŸºç¡€ä¿¡æ¯
  - èƒ½å¤Ÿè¯†åˆ«Podçš„å¸¸è§é”™è¯¯çŠ¶æ€
  - äº†è§£åŸºæœ¬çš„æ•…éšœæ’æŸ¥æµç¨‹

ä¸­çº§è¿ç»´å·¥ç¨‹å¸ˆ:
  - ç†Ÿç»ƒä½¿ç”¨æ‰€æœ‰kubectlè°ƒè¯•å‘½ä»¤
  - èƒ½å¤Ÿè¯Šæ–­ç½‘ç»œå’Œå­˜å‚¨é—®é¢˜
  - æŒæ¡èŠ‚ç‚¹çº§æ•…éšœæ’æŸ¥
  - ä¼šä½¿ç”¨tcpdumpã€straceç­‰ç³»ç»Ÿå·¥å…·

é«˜çº§è¿ç»´å·¥ç¨‹å¸ˆ/SRE:
  - èƒ½å¤Ÿåˆ†æå¤æ‚çš„é›†ç¾¤çº§æ•…éšœ
  - æŒæ¡æ€§èƒ½åˆ†æå’Œä¼˜åŒ–æ–¹æ³•
  - ä¼šç¼–å†™è‡ªåŠ¨åŒ–æ•…éšœè¯Šæ–­è„šæœ¬
  - èƒ½å¤Ÿé¢„æµ‹å’Œé¢„é˜²æ½œåœ¨é—®é¢˜
```

---

## æœ¬ç« å†…å®¹æ¦‚è§ˆ

```
ç¬¬11ç« : Kubernetesè°ƒè¯•ä¸æ•…éšœæ’æŸ¥
â”œâ”€â”€ 11.1 è°ƒè¯•å·¥å…·ä¸æ–¹æ³•è®º
â”‚   â”œâ”€â”€ ç³»ç»ŸåŒ–æ•…éšœæ’æŸ¥æµç¨‹
â”‚   â”œâ”€â”€ kubectlæ ¸å¿ƒè°ƒè¯•å‘½ä»¤
â”‚   â”œâ”€â”€ å®¹å™¨å†…è°ƒè¯•æŠ€å·§
â”‚   â””â”€â”€ ç½‘ç»œè°ƒè¯•å·¥å…·é“¾
â”‚
â”œâ”€â”€ 11.2 Podæ•…éšœæ’æŸ¥
â”‚   â”œâ”€â”€ PendingçŠ¶æ€è¯Šæ–­
â”‚   â”œâ”€â”€ CrashLoopBackOffåˆ†æ
â”‚   â”œâ”€â”€ ImagePullBackOffè§£å†³
â”‚   â”œâ”€â”€ OOMKilledå¤„ç†
â”‚   â””â”€â”€ Initå®¹å™¨å¤±è´¥è°ƒè¯•
â”‚
â”œâ”€â”€ 11.3 ç½‘ç»œé—®é¢˜è¯Šæ–­
â”‚   â”œâ”€â”€ Serviceä¸å¯è¾¾æ’æŸ¥
â”‚   â”œâ”€â”€ DNSè§£æé—®é¢˜
â”‚   â”œâ”€â”€ NetworkPolicyè°ƒè¯•
â”‚   â”œâ”€â”€ CNIæ’ä»¶æ•…éšœ
â”‚   â””â”€â”€ Ingressé…ç½®é—®é¢˜
â”‚
â”œâ”€â”€ 11.4 å­˜å‚¨æ•…éšœå¤„ç†
â”‚   â”œâ”€â”€ PVC Pendingæ’æŸ¥
â”‚   â”œâ”€â”€ æŒ‚è½½å¤±è´¥è¯Šæ–­
â”‚   â”œâ”€â”€ å­˜å‚¨æ€§èƒ½åˆ†æ
â”‚   â”œâ”€â”€ æ•°æ®æ¢å¤æ–¹æ³•
â”‚   â””â”€â”€ CSIé©±åŠ¨é—®é¢˜
â”‚
â”œâ”€â”€ 11.5 èŠ‚ç‚¹ä¸é›†ç¾¤æ•…éšœ
â”‚   â”œâ”€â”€ èŠ‚ç‚¹NotReadyè¯Šæ–­
â”‚   â”œâ”€â”€ kubeletæ•…éšœæ’æŸ¥
â”‚   â”œâ”€â”€ æ§åˆ¶å¹³é¢ç»„ä»¶å¼‚å¸¸
â”‚   â”œâ”€â”€ etcdé›†ç¾¤é—®é¢˜
â”‚   â””â”€â”€ èµ„æºè€—å°½å¤„ç†
â”‚
â”œâ”€â”€ 11.6 åº”ç”¨è°ƒè¯•æœ€ä½³å®è·µ
â”‚   â”œâ”€â”€ æ—¥å¿—æœ€ä½³å®è·µ
â”‚   â”œâ”€â”€ æ€§èƒ½åˆ†ææ–¹æ³•
â”‚   â”œâ”€â”€ è¿œç¨‹è°ƒè¯•æŠ€å·§
â”‚   â”œâ”€â”€ ä¸´æ—¶å®¹å™¨è°ƒè¯•
â”‚   â””â”€â”€ ç”Ÿäº§ç¯å¢ƒdebugç­–ç•¥
â”‚
â”œâ”€â”€ 11.7 æ•…éšœæ¡ˆä¾‹åˆ†æ
â”‚   â”œâ”€â”€ ç”Ÿäº§ç¯å¢ƒçœŸå®æ¡ˆä¾‹
â”‚   â”œâ”€â”€ æ ¹å› åˆ†ææ–¹æ³•
â”‚   â”œâ”€â”€ å¤ç›˜ä¸æ€»ç»“
â”‚   â””â”€â”€ é¢„é˜²æªæ–½
â”‚
â””â”€â”€ 11.8 æœ¬ç« æ€»ç»“
    â”œâ”€â”€ æ ¸å¿ƒçŸ¥è¯†å›é¡¾
    â”œâ”€â”€ è°ƒè¯•æŠ€èƒ½æ¸…å•
    â”œâ”€â”€ å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨
    â””â”€â”€ å­¦ä¹ èµ„æºæ¨è
```

## å­¦ä¹ è·¯å¾„å»ºè®®

**åˆå­¦è€…è·¯å¾„**(æŒæ¡åŸºç¡€è°ƒè¯•):
1. å…ˆå­¦ä¹ 11.1è°ƒè¯•å·¥å…·,ç†Ÿç»ƒä½¿ç”¨kubectlå‘½ä»¤
2. å®è·µ11.2 Podæ•…éšœæ’æŸ¥,ç†è§£å¸¸è§é”™è¯¯
3. å­¦ä¹ 11.3åŸºç¡€ç½‘ç»œè°ƒè¯•
4. æŒæ¡11.6æ—¥å¿—åˆ†ææŠ€å·§

**è¿›é˜¶è·¯å¾„**(ç‹¬ç«‹å¤„ç†ç”Ÿäº§é—®é¢˜):
1. æ·±å…¥11.3ç½‘ç»œé—®é¢˜è¯Šæ–­
2. æŒæ¡11.4å­˜å‚¨æ•…éšœå¤„ç†
3. å­¦ä¹ 11.5èŠ‚ç‚¹å’Œé›†ç¾¤çº§æ•…éšœ
4. ç ”ç©¶11.7çœŸå®æ•…éšœæ¡ˆä¾‹

**ä¸“å®¶è·¯å¾„**(æˆä¸ºæ•…éšœæ’æŸ¥ä¸“å®¶):
1. æŒæ¡æ‰€æœ‰è°ƒè¯•å·¥å…·å’Œæ–¹æ³•
2. èƒ½å¤Ÿç¼–å†™è‡ªåŠ¨åŒ–è¯Šæ–­è„šæœ¬
3. å»ºç«‹ç³»ç»ŸåŒ–çš„æ•…éšœçŸ¥è¯†åº“
4. åˆ¶å®šé¢„é˜²æ€§ç»´æŠ¤ç­–ç•¥

---

**å‡†å¤‡å¥½äº†å—?** è®©æˆ‘ä»¬å¼€å§‹å­¦ä¹ Kubernetesçš„è°ƒè¯•å·¥å…·å’Œæ•…éšœæ’æŸ¥æ–¹æ³•è®º!

---

## 11.1 è°ƒè¯•å·¥å…·ä¸æ–¹æ³•è®º

### 11.1.1 ç³»ç»ŸåŒ–æ•…éšœæ’æŸ¥æµç¨‹

#### æ•…éšœæ’æŸ¥æ–¹æ³•è®º

åœ¨Kubernetesç¯å¢ƒä¸­,æ•…éšœæ’æŸ¥éœ€è¦éµå¾ªç³»ç»ŸåŒ–çš„æ–¹æ³•è®ºã€‚ç›²ç›®å°è¯•æˆ–å‡­ç›´è§‰çŒœæµ‹å¾€å¾€ä¼šæµªè´¹å¤§é‡æ—¶é—´ã€‚ä»¥ä¸‹æ˜¯è¡Œä¹‹æœ‰æ•ˆçš„æ•…éšœæ’æŸ¥æ¡†æ¶:

**1. USEæ–¹æ³• (Utilization, Saturation, Errors)**

ç”±æ€§èƒ½åˆ†æä¸“å®¶Brendan Greggæå‡º,é€‚ç”¨äºèµ„æºåˆ†æ:

```yaml
USEæ–¹æ³•åˆ†ææ¡†æ¶:

Utilization (åˆ©ç”¨ç‡):
  å«ä¹‰: èµ„æºè¢«ä½¿ç”¨çš„ç™¾åˆ†æ¯”
  å…³é”®æŒ‡æ ‡:
    - CPUåˆ©ç”¨ç‡: å½“å‰ä½¿ç”¨/æ€»å®¹é‡
    - å†…å­˜åˆ©ç”¨ç‡: å·²ç”¨å†…å­˜/æ€»å†…å­˜
    - ç£ç›˜åˆ©ç”¨ç‡: å·²ç”¨ç©ºé—´/æ€»ç©ºé—´
    - ç½‘ç»œå¸¦å®½åˆ©ç”¨ç‡: å½“å‰æµé‡/æ¥å£å¸¦å®½
  
  æ­£å¸¸èŒƒå›´:
    - CPU: <70% (ç•™30%ä½™é‡åº”å¯¹çªå‘)
    - Memory: <80% (é¿å…OOM)
    - Disk: <85% (é¿å…ç£ç›˜æ»¡)
    - Network: <60% (é¿å…æ‹¥å¡)

Saturation (é¥±å’Œåº¦):
  å«ä¹‰: èµ„æºæ— æ³•æ»¡è¶³è¯·æ±‚çš„ç¨‹åº¦
  å…³é”®æŒ‡æ ‡:
    - CPU run queueé•¿åº¦ (ç­‰å¾…è°ƒåº¦çš„çº¿ç¨‹æ•°)
    - Swapä½¿ç”¨é‡ (å†…å­˜ä¸è¶³å¯¼è‡´)
    - ç£ç›˜IOç­‰å¾…æ—¶é—´
    - ç½‘ç»œä¸¢åŒ…ç‡
  
  å‘Šè­¦é˜ˆå€¼:
    - Run queue > CPUæ ¸æ•° * 2
    - Swap > 0 (ç”Ÿäº§ç¯å¢ƒåº”ç¦ç”¨swap)
    - IO wait > 20%
    - Packet loss > 1%

Errors (é”™è¯¯):
  å«ä¹‰: æ˜ç¡®çš„é”™è¯¯äº‹ä»¶
  å…³é”®æ¥æº:
    - ç³»ç»Ÿæ—¥å¿— (dmesg, /var/log/messages)
    - åº”ç”¨æ—¥å¿— (kubectl logs)
    - Kubernetes Events (kubectl get events)
    - ç›‘æ§å‘Šè­¦ (Prometheus Alerts)
```

**å®æˆ˜ç¤ºä¾‹ - ä½¿ç”¨USEæ–¹æ³•è¯Šæ–­èŠ‚ç‚¹é—®é¢˜**:

```bash
# 1. Utilization - æ£€æŸ¥èµ„æºåˆ©ç”¨ç‡
kubectl top node node-1
# è¾“å‡ºç¤ºä¾‹:
# NAME     CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
# node-1   3800m        95%    28Gi            92%
# åˆ†æ: CPU 95%, Memory 92% - èµ„æºä¸¥é‡ä¸è¶³!

# 2. Saturation - æ£€æŸ¥é¥±å’Œåº¦
kubectl describe node node-1 | grep -A 5 "Allocated resources"
# è¾“å‡ºç¤ºä¾‹:
#   Resource           Requests     Limits
#   --------           --------     ------
#   cpu                3900m (97%)  7800m (195%)
#   memory             30Gi (98%)   45Gi (147%)
# åˆ†æ: Requestsæ¥è¿‘100%,Limitsè¶…é¢åˆ†é… - å­˜åœ¨èµ„æºç«äº‰!

# ç™»å½•èŠ‚ç‚¹æ£€æŸ¥ç³»ç»Ÿçº§é¥±å’Œåº¦
ssh node-1
# æ£€æŸ¥CPUé˜Ÿåˆ—é•¿åº¦
vmstat 1 5
# procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
#  r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
#  8  2      0  1.2G   245M  15.3G    0    0    12   156  234  456 85 12  0  3  0
# åˆ†æ: r=8 (ç­‰å¾…CPUçš„è¿›ç¨‹æ•°) > CPUæ ¸æ•°4 - CPUé¥±å’Œ!
#       b=2 (ç­‰å¾…IOçš„è¿›ç¨‹æ•°) - å­˜åœ¨IOé˜»å¡

# 3. Errors - æ£€æŸ¥é”™è¯¯æ—¥å¿—
kubectl get events --field-selector involvedObject.name=node-1,type=Warning
# ç¤ºä¾‹è¾“å‡º:
# LAST SEEN   TYPE      REASON            OBJECT    MESSAGE
# 2m ago      Warning   FrequentKubeletRestart   Node   Kubelet restarted 3 times in 10 minutes
# 5m ago      Warning   SystemOOM         Node   System OOM encountered, victim process: java

# æ£€æŸ¥Podé©±é€äº‹ä»¶
kubectl get pods -o wide | grep node-1
kubectl describe pod <pod-name> | grep -A 5 "Events:"
```

**2. REDæ–¹æ³• (Rate, Errors, Duration)**

é€‚ç”¨äºæœåŠ¡è¯·æ±‚åˆ†æ:

```yaml
REDæ–¹æ³•åˆ†ææ¡†æ¶:

Rate (è¯·æ±‚é€Ÿç‡):
  å«ä¹‰: å•ä½æ—¶é—´å†…çš„è¯·æ±‚æ•°é‡
  å…³é”®æŒ‡æ ‡:
    - HTTPè¯·æ±‚QPS (Queries Per Second)
    - gRPCè°ƒç”¨RPS (Requests Per Second)
    - æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹é€Ÿç‡
  
  ç›‘æ§ç»´åº¦:
    - æŒ‰ç«¯ç‚¹åˆ†ç»„ (GET /api/users, POST /api/orders)
    - æŒ‰çŠ¶æ€ç åˆ†ç»„ (2xx, 4xx, 5xx)
    - æŒ‰æ¥æºåˆ†ç»„ (å®¢æˆ·ç«¯IP, User-Agent)

Errors (é”™è¯¯ç‡):
  å«ä¹‰: å¤±è´¥è¯·æ±‚å æ€»è¯·æ±‚çš„æ¯”ä¾‹
  å…³é”®æŒ‡æ ‡:
    - HTTP 5xxé”™è¯¯ç‡
    - è¶…æ—¶ç‡
    - è¿æ¥å¤±è´¥ç‡
  
  å‘Šè­¦é˜ˆå€¼:
    - é”™è¯¯ç‡ > 1% (99% SLO)
    - é”™è¯¯ç‡ > 0.1% (99.9% SLO)

Duration (å»¶è¿Ÿ):
  å«ä¹‰: è¯·æ±‚å¤„ç†æ—¶é—´
  å…³é”®æŒ‡æ ‡:
    - P50å»¶è¿Ÿ (ä¸­ä½æ•°)
    - P95å»¶è¿Ÿ (95%è¯·æ±‚)
    - P99å»¶è¿Ÿ (99%è¯·æ±‚)
  
  SLAç¤ºä¾‹:
    - P50 < 100ms
    - P95 < 500ms
    - P99 < 1s
```

**å®æˆ˜ç¤ºä¾‹ - ä½¿ç”¨REDæ–¹æ³•è¯Šæ–­æœåŠ¡é—®é¢˜**:

```bash
# å‰æ: åº”ç”¨å·²é›†æˆPrometheus client,æš´éœ²metrics
# è®¿é—®åº”ç”¨çš„/metricsç«¯ç‚¹

# 1. Rate - æ£€æŸ¥è¯·æ±‚é€Ÿç‡
# PromQLæŸ¥è¯¢:
rate(http_requests_total{job="api-server"}[5m])
# æŒ‰ç«¯ç‚¹åˆ†ç»„:
sum(rate(http_requests_total[5m])) by (endpoint)

# 2. Errors - æ£€æŸ¥é”™è¯¯ç‡
# HTTP 5xxé”™è¯¯ç‡:
sum(rate(http_requests_total{status=~"5.."}[5m])) 
  / 
sum(rate(http_requests_total[5m]))

# æŒ‰ç«¯ç‚¹æŸ¥çœ‹é”™è¯¯ç‡:
sum(rate(http_requests_total{status=~"5.."}[5m])) by (endpoint)
  /
sum(rate(http_requests_total[5m])) by (endpoint)

# 3. Duration - æ£€æŸ¥å»¶è¿Ÿ
# P95å»¶è¿Ÿ:
histogram_quantile(0.95, 
  sum(rate(http_request_duration_seconds_bucket[5m])) by (le, endpoint)
)

# P99å»¶è¿Ÿ:
histogram_quantile(0.99, 
  sum(rate(http_request_duration_seconds_bucket[5m])) by (le)
)

# åœ¨Grafanaä¸­å¯è§†åŒ–:
# - åˆ›å»ºä»ªè¡¨ç›˜,æ·»åŠ 3ä¸ªé¢æ¿åˆ†åˆ«æ˜¾ç¤ºRate/Errors/Duration
# - è®¾ç½®å‘Šè­¦è§„åˆ™: é”™è¯¯ç‡>1%, P99å»¶è¿Ÿ>1s
```

**3. The Four Golden Signals (Google SRE)**

Googleæå‡ºçš„æœåŠ¡ç›‘æ§å››å¤§é»„é‡‘æŒ‡æ ‡:

```yaml
å››å¤§é»„é‡‘æŒ‡æ ‡:

1. Latency (å»¶è¿Ÿ):
   å®šä¹‰: æœåŠ¡å“åº”è¯·æ±‚æ‰€éœ€çš„æ—¶é—´
   åŒºåˆ†:
     - æˆåŠŸè¯·æ±‚çš„å»¶è¿Ÿ
     - å¤±è´¥è¯·æ±‚çš„å»¶è¿Ÿ (é€šå¸¸æ›´å¿«,å› ä¸ºç›´æ¥è¿”å›é”™è¯¯)
   
   ç›‘æ§:
     - P50/P90/P95/P99å»¶è¿Ÿ
     - æŒ‰ç«¯ç‚¹/ç”¨æˆ·/åœ°åŸŸåˆ†ç»„

2. Traffic (æµé‡):
   å®šä¹‰: ç³»ç»Ÿæ‰¿å—çš„è¯·æ±‚é‡
   æŒ‡æ ‡:
     - HTTP: æ¯ç§’è¯·æ±‚æ•° (RPS)
     - æ•°æ®åº“: æ¯ç§’æŸ¥è¯¢æ•° (QPS)
     - æ¶ˆæ¯é˜Ÿåˆ—: æ¯ç§’æ¶ˆæ¯æ•°
   
   ç”¨é€”:
     - å®¹é‡è§„åˆ’
     - æ£€æµ‹æµé‡å¼‚å¸¸ (DDoSæ”»å‡»)

3. Errors (é”™è¯¯):
   å®šä¹‰: å¤±è´¥è¯·æ±‚çš„æ¯”ç‡
   åˆ†ç±»:
     - æ˜¾å¼é”™è¯¯: HTTP 500, gRPC INTERNAL
     - éšå¼é”™è¯¯: HTTP 200ä½†è¿”å›é”™è¯¯æ•°æ®
     - ç­–ç•¥é”™è¯¯: å› ç­–ç•¥è¢«æ‹’ç»çš„è¯·æ±‚
   
   å‘Šè­¦:
     - é”™è¯¯ç‡ > é˜ˆå€¼
     - é”™è¯¯æ•°ç»å¯¹å¢é•¿

4. Saturation (é¥±å’Œåº¦):
   å®šä¹‰: æœåŠ¡æˆ–èµ„æºçš„"æ»¡"ç¨‹åº¦
   æŒ‡æ ‡:
     - CPU/å†…å­˜/ç£ç›˜ä½¿ç”¨ç‡
     - çº¿ç¨‹æ± å ç”¨ç‡
     - æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡
   
   é¢„æµ‹:
     - åŸºäºè¶‹åŠ¿é¢„æµ‹èµ„æºè€—å°½æ—¶é—´
     - æå‰æ‰©å®¹
```

**4. 5W1Hæ•…éšœåˆ†ææ³•**

ç³»ç»ŸåŒ–çš„é—®é¢˜æè¿°æ–¹æ³•:

```yaml
5W1Hæ•…éšœåˆ†ææ¡†æ¶:

What (ä»€ä¹ˆé—®é¢˜):
  é—®é¢˜: å…·ä½“çš„æ•…éšœç°è±¡æ˜¯ä»€ä¹ˆ?
  ç¤ºä¾‹:
    - "ç”¨æˆ·ç™»å½•æ¥å£è¿”å›504è¶…æ—¶"
    - "è®¢å•Podæ— æ³•å¯åŠ¨,ä¸€ç›´Pending"
    - "é›†ç¾¤DNSè§£æå¤±è´¥"

When (ä½•æ—¶å‘ç”Ÿ):
  é—®é¢˜: æ•…éšœä»€ä¹ˆæ—¶å€™å¼€å§‹çš„?å¤šä¹…å‘ç”Ÿä¸€æ¬¡?
  ç¤ºä¾‹:
    - "ä»Šå¤©ä¸‹åˆ3ç‚¹å¼€å§‹"
    - "æ¯å¤©å‡Œæ™¨2ç‚¹å·¦å³"
    - "é—´æ­‡æ€§å‘ç”Ÿ,æ¯å°æ—¶1-2æ¬¡"
  
  æ—¶é—´çº¿åˆ†æ:
    - æ•…éšœå‘ç”Ÿæ—¶é—´ vs ç³»ç»Ÿå˜æ›´æ—¶é—´
    - æ•…éšœå‘ç”Ÿæ—¶é—´ vs æµé‡é«˜å³°æ—¶é—´

Where (ä½•å¤„å‘ç”Ÿ):
  é—®é¢˜: æ•…éšœå½±å“å“ªäº›ç»„ä»¶/æœåŠ¡/ç”¨æˆ·?
  ç¤ºä¾‹:
    - "ä»…å½±å“node-3ä¸Šçš„Pod"
    - "ä»…å½±å“ä½äºus-weståŒºåŸŸçš„ç”¨æˆ·"
    - "æ‰€æœ‰è°ƒç”¨ç”¨æˆ·æœåŠ¡çš„æ¥å£"
  
  èŒƒå›´ç¡®å®š:
    - å…¨å±€æ•…éšœ vs å±€éƒ¨æ•…éšœ
    - ç‰¹å®šé›†ç¾¤/å‘½åç©ºé—´/èŠ‚ç‚¹

Who (è°å—å½±å“):
  é—®é¢˜: å“ªäº›ç”¨æˆ·/ç³»ç»Ÿå—åˆ°å½±å“?
  ç¤ºä¾‹:
    - "æ‰€æœ‰ç§»åŠ¨ç«¯ç”¨æˆ·"
    - "VIPå®¢æˆ·çš„è®¢å•å¤„ç†"
    - "å†…éƒ¨APIè°ƒç”¨"

Why (ä¸ºä»€ä¹ˆå‘ç”Ÿ):
  é—®é¢˜: æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ?
  æ–¹æ³•:
    - 5 Whysåˆ†ææ³• (è¿ç»­é—®5æ¬¡ä¸ºä»€ä¹ˆ)
    - å› æœå›¾(é±¼éª¨å›¾)
  
  ç¤ºä¾‹ (5 Whys):
    1. ä¸ºä»€ä¹ˆè®¢å•Podæ— æ³•å¯åŠ¨? 
       â†’ å› ä¸ºé•œåƒæ‹‰å–å¤±è´¥
    2. ä¸ºä»€ä¹ˆé•œåƒæ‹‰å–å¤±è´¥? 
       â†’ å› ä¸ºé•œåƒä»“åº“è¿æ¥è¶…æ—¶
    3. ä¸ºä»€ä¹ˆé•œåƒä»“åº“è¿æ¥è¶…æ—¶? 
       â†’ å› ä¸ºèŠ‚ç‚¹æ— æ³•è§£æé•œåƒä»“åº“åŸŸå
    4. ä¸ºä»€ä¹ˆæ— æ³•è§£æåŸŸå? 
       â†’ å› ä¸ºCoreDNS Podå…¨éƒ¨crash
    5. ä¸ºä»€ä¹ˆCoreDNS crash? 
       â†’ å› ä¸ºèŠ‚ç‚¹å†…å­˜è€—å°½,Podè¢«OOMKilled

How (å¦‚ä½•è§£å†³):
  é—®é¢˜: ä¸´æ—¶æ–¹æ¡ˆå’Œæ°¸ä¹…æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ?
  ç¤ºä¾‹:
    ä¸´æ—¶æ–¹æ¡ˆ:
      - "é‡å¯CoreDNS Podæ¢å¤DNSæœåŠ¡"
      - "æ‰‹åŠ¨é©±é€éƒ¨åˆ†Podé‡Šæ”¾å†…å­˜"
    
    æ°¸ä¹…æ–¹æ¡ˆ:
      - "å¢åŠ CoreDNSçš„å†…å­˜é™åˆ¶"
      - "å®æ–½Podèµ„æºé…é¢,é˜²æ­¢èµ„æºè€—å°½"
      - "æ·»åŠ ç›‘æ§å‘Šè­¦,æå‰å‘ç°å†…å­˜ä¸è¶³"
```

**å®æˆ˜æ¡ˆä¾‹ - ä½¿ç”¨5W1Håˆ†æç”Ÿäº§æ•…éšœ**:

```yaml
æ•…éšœæ¡ˆä¾‹: è®¢å•æœåŠ¡å¤§é¢ç§¯è¶…æ—¶

What:
  - è®¢å•åˆ›å»ºAPIå“åº”æ—¶é—´ä»100mså¢åŠ åˆ°5ç§’
  - éƒ¨åˆ†è¯·æ±‚è¿”å›504 Gateway Timeout
  - é”™è¯¯ç‡ä»0.1%é£™å‡åˆ°15%

When:
  - å¼€å§‹æ—¶é—´: 2024-02-08 14:35
  - æŒç»­æ—¶é—´: 45åˆ†é’Ÿ
  - å˜æ›´è®°å½•: 14:30éƒ¨ç½²äº†è®¢å•æœåŠ¡v2.3.0

Where:
  - ä»…å½±å“è®¢å•æœåŠ¡ (order-service)
  - åº“å­˜æœåŠ¡ã€æ”¯ä»˜æœåŠ¡æ­£å¸¸
  - æ‰€æœ‰åœ°åŸŸçš„ç”¨æˆ·éƒ½å—å½±å“

Who:
  - æ‰€æœ‰å°è¯•ä¸‹å•çš„ç”¨æˆ·
  - å½±å“çº¦10000ä¸ªè®¢å•
  - é¢„ä¼°ä¸šåŠ¡æŸå¤±: $50000

Why (5 Whysåˆ†æ):
  1. ä¸ºä»€ä¹ˆè®¢å•æœåŠ¡è¶…æ—¶?
     â†’ å› ä¸ºæ•°æ®åº“æŸ¥è¯¢è€—æ—¶ä»10mså¢åŠ åˆ°4ç§’
  
  2. ä¸ºä»€ä¹ˆæ•°æ®åº“æŸ¥è¯¢å˜æ…¢?
     â†’ å› ä¸ºæ•°æ®åº“CPUé£™å‡åˆ°98%
  
  3. ä¸ºä»€ä¹ˆæ•°æ®åº“CPUé£™å‡?
     â†’ å› ä¸ºå‡ºç°äº†å¤§é‡å…¨è¡¨æ‰«ææŸ¥è¯¢
  
  4. ä¸ºä»€ä¹ˆå‡ºç°å…¨è¡¨æ‰«æ?
     â†’ å› ä¸ºæ–°ç‰ˆæœ¬ä»£ç ä¸­ä¸€ä¸ªæŸ¥è¯¢ç¼ºå°‘ç´¢å¼•
  
  5. ä¸ºä»€ä¹ˆç¼ºå°‘ç´¢å¼•æ²¡æœ‰åœ¨æµ‹è¯•ä¸­å‘ç°?
     â†’ å› ä¸ºæµ‹è¯•ç¯å¢ƒæ•°æ®é‡å°(1000æ¡),æ€§èƒ½æµ‹è¯•æœªè¦†ç›–

How (è§£å†³æ–¹æ¡ˆ):
  ä¸´æ—¶æ–¹æ¡ˆ (14:50æ‰§è¡Œ):
    - kubectl rollout undo deployment order-service
    - å›æ»šåˆ°v2.2.0ç‰ˆæœ¬
    - 15:20 æœåŠ¡å®Œå…¨æ¢å¤
  
  æ°¸ä¹…æ–¹æ¡ˆ:
    1. åœ¨æ•°æ®åº“æ·»åŠ ç¼ºå¤±çš„ç´¢å¼•
    2. ä¿®å¤v2.3.0ä»£ç 
    3. åœ¨é¢„å‘ç¯å¢ƒç”¨ç”Ÿäº§çº§æ•°æ®é‡è¿›è¡Œæ€§èƒ½æµ‹è¯•
    4. åˆ¶å®šæ…¢æŸ¥è¯¢ç›‘æ§å‘Šè­¦è§„åˆ™
    5. å»ºç«‹æ•°æ®åº“å˜æ›´reviewæµç¨‹

é¢„é˜²æªæ–½:
  1. ä»£ç Reviewé˜¶æ®µæ£€æŸ¥SQLæŸ¥è¯¢æ˜¯å¦æœ‰ç´¢å¼•
  2. æ€§èƒ½æµ‹è¯•ç¯å¢ƒæ•°æ®é‡æå‡åˆ°ç”Ÿäº§çº§åˆ«
  3. æ·»åŠ æ•°æ®åº“æ…¢æŸ¥è¯¢ç›‘æ§ (>100ms)
  4. å»ºç«‹é‡‘ä¸é›€å‘å¸ƒæµç¨‹,é€æ­¥æ”¾é‡
  5. åˆ¶å®šå¿«é€Ÿå›æ»šSOP (æ ‡å‡†æ“ä½œæµç¨‹)
```

#### æ•…éšœæ’æŸ¥é€šç”¨æµç¨‹

ä»¥ä¸‹æ˜¯ç»è¿‡ç”Ÿäº§éªŒè¯çš„ç³»ç»ŸåŒ–æ•…éšœæ’æŸ¥æµç¨‹:

```yaml
æ•…éšœæ’æŸ¥å…­æ­¥æ³•:

æ­¥éª¤1: ç°è±¡ç¡®è®¤ (5åˆ†é’Ÿå†…å®Œæˆ)
  ç›®æ ‡: å¿«é€Ÿäº†è§£æ•…éšœå…¨è²Œ
  è¡ŒåŠ¨:
    - æ”¶é›†ç”¨æˆ·æŠ¥å‘Šçš„é”™è¯¯ä¿¡æ¯
    - æ£€æŸ¥ç›‘æ§ç³»ç»Ÿå‘Šè­¦ (Prometheus/Grafana)
    - æŸ¥çœ‹è¿‘æœŸKubernetes Events
    - ç¡®è®¤æ•…éšœå½±å“èŒƒå›´å’Œä¸¥é‡ç¨‹åº¦
  
  å‘½ä»¤:
    # æ£€æŸ¥æœ€è¿‘çš„å‘Šè­¦
    kubectl get events --sort-by='.lastTimestamp' | head -20
    
    # æ£€æŸ¥å¼‚å¸¸Pod
    kubectl get pods --all-namespaces --field-selector status.phase!=Running
    
    # æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
    kubectl get nodes
    
    # æŸ¥çœ‹å…³é”®ç»„ä»¶çŠ¶æ€
    kubectl get pods -n kube-system

æ­¥éª¤2: ä¿¡æ¯æ”¶é›† (10-15åˆ†é’Ÿ)
  ç›®æ ‡: æ”¶é›†è¶³å¤Ÿçš„è¯Šæ–­ä¿¡æ¯
  è¡ŒåŠ¨:
    - æ”¶é›†Podæ—¥å¿— (stdout/stderr)
    - æ”¶é›†Previouså®¹å™¨æ—¥å¿— (crashåœºæ™¯)
    - æ”¶é›†ç³»ç»Ÿæ—¥å¿— (kubelet/docker)
    - å¯¼å‡ºèµ„æºå¯¹è±¡å®šä¹‰ (YAML)
    - è®°å½•æ—¶é—´çº¿ (ä½•æ—¶å¼€å§‹ã€æŒç»­æ—¶é—´ã€å˜æ›´è®°å½•)
  
  å‘½ä»¤:
    # Podå½“å‰æ—¥å¿—
    kubectl logs <pod-name> -c <container-name> --tail=100
    
    # Podå´©æºƒå‰æ—¥å¿—
    kubectl logs <pod-name> -c <container-name> --previous
    
    # å¯¼å‡ºPodå®šä¹‰
    kubectl get pod <pod-name> -o yaml > pod-debug.yaml
    
    # æŸ¥çœ‹è¯¦ç»†æè¿°
    kubectl describe pod <pod-name>
    
    # èŠ‚ç‚¹ç³»ç»Ÿæ—¥å¿—
    ssh <node> journalctl -u kubelet -n 100

æ­¥éª¤3: é—®é¢˜å®šä½ (20-30åˆ†é’Ÿ)
  ç›®æ ‡: æ‰¾åˆ°æ•…éšœçš„æ ¹æœ¬åŸå› 
  è¡ŒåŠ¨:
    - åˆ†ææ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
    - æ£€æŸ¥èµ„æºé…ç½®æ˜¯å¦åˆç†
    - éªŒè¯ç½‘ç»œ/å­˜å‚¨è¿é€šæ€§
    - å¯¹æ¯”æ­£å¸¸å’Œå¼‚å¸¸Podçš„å·®å¼‚
    - ä½¿ç”¨æ’é™¤æ³•ç¼©å°é—®é¢˜èŒƒå›´
  
  æŠ€å·§:
    # æ¯”è¾ƒæ­£å¸¸å’Œå¼‚å¸¸Podå·®å¼‚
    kubectl diff <(kubectl get pod normal-pod -o yaml) <(kubectl get pod failed-pod -o yaml)
    
    # æ£€æŸ¥Podè°ƒåº¦åˆ°å“ªä¸ªèŠ‚ç‚¹
    kubectl get pod <pod-name> -o wide
    
    # æ£€æŸ¥èŠ‚ç‚¹èµ„æºæ˜¯å¦å……è¶³
    kubectl describe node <node-name> | grep -A 5 "Allocated resources"
    
    # è¿›å…¥Podå†…éƒ¨æ’æŸ¥
    kubectl exec -it <pod-name> -- /bin/sh

æ­¥éª¤4: å‡è®¾éªŒè¯ (æ ¹æ®å¤æ‚åº¦)
  ç›®æ ‡: éªŒè¯é—®é¢˜å‡è®¾æ˜¯å¦æ­£ç¡®
  è¡ŒåŠ¨:
    - æå‡ºå¯èƒ½çš„æ•…éšœåŸå› å‡è®¾
    - è®¾è®¡éªŒè¯å®éªŒ
    - æ‰§è¡ŒéªŒè¯å¹¶è®°å½•ç»“æœ
    - æ’é™¤é”™è¯¯å‡è®¾,èšç„¦æ­£ç¡®æ–¹å‘
  
  ç¤ºä¾‹:
    å‡è®¾1: Podå› å†…å­˜ä¸è¶³è¢«Kill
    éªŒè¯: 
      - kubectl describe pod | grep -i "OOMKilled"
      - æ£€æŸ¥ç›‘æ§ç³»ç»Ÿçš„å†…å­˜æ›²çº¿
    ç»“æœ: âœ… ç¡®è®¤æ˜¯OOMå¯¼è‡´
    
    å‡è®¾2: Serviceæ— æ³•è®¿é—®æ˜¯DNSé—®é¢˜
    éªŒè¯:
      - kubectl run test --image=busybox -it --rm -- nslookup my-service
    ç»“æœ: âŒ DNSè§£ææ­£å¸¸,æ’é™¤æ­¤å‡è®¾

æ­¥éª¤5: é—®é¢˜è§£å†³ (æ ¹æ®æ–¹æ¡ˆ)
  ç›®æ ‡: æ¢å¤æœåŠ¡æ­£å¸¸è¿è¡Œ
  åŸåˆ™:
    - ä¼˜å…ˆæ¢å¤ä¸šåŠ¡,å†åˆ†ææ ¹å› 
    - ä¸´æ—¶æ–¹æ¡ˆ + æ°¸ä¹…æ–¹æ¡ˆç»“åˆ
    - è®°å½•æ‰€æœ‰æ“ä½œæ­¥éª¤
  
  ä¸´æ—¶æ–¹æ¡ˆç¤ºä¾‹:
    - é‡å¯Pod: kubectl delete pod <pod-name>
    - æ‰©å®¹å‰¯æœ¬: kubectl scale deployment <name> --replicas=5
    - å›æ»šç‰ˆæœ¬: kubectl rollout undo deployment <name>
    - æ¸…ç†èµ„æº: kubectl delete pod <pod-name> --grace-period=0 --force
  
  æ°¸ä¹…æ–¹æ¡ˆç¤ºä¾‹:
    - ä¿®æ”¹èµ„æºé™åˆ¶
    - ä¿®å¤åº”ç”¨ä»£ç 
    - è°ƒæ•´é…ç½®å‚æ•°
    - å¢åŠ ç›‘æ§å‘Šè­¦

æ­¥éª¤6: æ€»ç»“å¤ç›˜ (äº‹å)
  ç›®æ ‡: ä»æ•…éšœä¸­å­¦ä¹ ,é˜²æ­¢å†æ¬¡å‘ç”Ÿ
  è¡ŒåŠ¨:
    - æ’°å†™æ•…éšœæŠ¥å‘Š (RCA - Root Cause Analysis)
    - æ€»ç»“ç»éªŒæ•™è®­
    - åˆ¶å®šé¢„é˜²æªæ–½
    - æ›´æ–°è¿ç»´æ–‡æ¡£
    - å›¢é˜Ÿåˆ†äº«
  
  æ•…éšœæŠ¥å‘Šæ¨¡æ¿:
    1. æ•…éšœæ‘˜è¦ (What happened)
    2. å½±å“èŒƒå›´ (Impact)
    3. æ ¹æœ¬åŸå›  (Root Cause)
    4. æ—¶é—´çº¿ (Timeline)
    5. è§£å†³æ–¹æ¡ˆ (Resolution)
    6. é¢„é˜²æªæ–½ (Prevention)
    7. è¡ŒåŠ¨é¡¹ (Action Items)
```

**æ•…éšœä¸¥é‡çº§åˆ«å®šä¹‰**:

```yaml
P0 - ä¸¥é‡æ•…éšœ (Critical):
  å®šä¹‰: æ ¸å¿ƒä¸šåŠ¡å®Œå…¨ä¸­æ–­
  ç¤ºä¾‹:
    - ç”Ÿäº§ç¯å¢ƒå…¨ç«™downæœº
    - æ”¯ä»˜ç³»ç»Ÿæ— æ³•ä½¿ç”¨
    - æ•°æ®ä¸¢å¤±æˆ–æŸå
  
  å“åº”æ—¶é—´: ç«‹å³ (5åˆ†é’Ÿå†…)
  è§£å†³æ—¶é—´: < 1å°æ—¶
  å‡çº§ç­–ç•¥: ç«‹å³å¬é›†æ‰€æœ‰ç›¸å…³äººå‘˜
  
  å¤„ç†åŸåˆ™:
    - æ‰€æœ‰äººhands-on deck
    - ä¼˜å…ˆæ¢å¤æœåŠ¡,æš‚åœæ‰€æœ‰å˜æ›´
    - æ¯15åˆ†é’ŸåŒæ­¥è¿›å±•
    - CEO/CTOéœ€è¦çŸ¥æ™“

P1 - é«˜ä¼˜å…ˆçº§æ•…éšœ (High):
  å®šä¹‰: æ ¸å¿ƒåŠŸèƒ½å—æŸ,éƒ¨åˆ†ç”¨æˆ·å—å½±å“
  ç¤ºä¾‹:
    - ç™»å½•æˆåŠŸç‡ä¸‹é™50%
    - å…³é”®APIé”™è¯¯ç‡>5%
    - ä¸»è¦åŠŸèƒ½å“åº”æ…¢
  
  å“åº”æ—¶é—´: 15åˆ†é’Ÿå†…
  è§£å†³æ—¶é—´: < 4å°æ—¶
  å‡çº§ç­–ç•¥: On-callå·¥ç¨‹å¸ˆç«‹å³å“åº”
  
  å¤„ç†åŸåˆ™:
    - On-callå·¥ç¨‹å¸ˆä¸»å¯¼
    - éœ€è¦å‘ç®¡ç†å±‚é€šæŠ¥
    - æ¯å°æ—¶æ›´æ–°è¿›å±•

P2 - ä¸­ç­‰ä¼˜å…ˆçº§ (Medium):
  å®šä¹‰: éæ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸,å½±å“æœ‰é™
  ç¤ºä¾‹:
    - éå…³é”®åŠŸèƒ½æŠ¥é”™
    - éƒ¨åˆ†åœ°åŒºç”¨æˆ·å—å½±å“
    - æ€§èƒ½è½»å¾®ä¸‹é™
  
  å“åº”æ—¶é—´: 1å°æ—¶å†…
  è§£å†³æ—¶é—´: < 8å°æ—¶
  
  å¤„ç†åŸåˆ™:
    - å·¥ä½œæ—¶é—´å†…è§£å†³
    - è®°å½•è¯¦ç»†ä¿¡æ¯ä¾›åç»­åˆ†æ

P3 - ä½ä¼˜å…ˆçº§ (Low):
  å®šä¹‰: è½»å¾®é—®é¢˜,ä¸å½±å“ç”¨æˆ·
  ç¤ºä¾‹:
    - å‘Šè­¦è¯¯æŠ¥
    - éç”Ÿäº§ç¯å¢ƒé—®é¢˜
    - ä¼˜åŒ–å»ºè®®
  
  å“åº”æ—¶é—´: å·¥ä½œæ—¶é—´å†…
  è§£å†³æ—¶é—´: æ ¹æ®æ’æœŸ
  
  å¤„ç†åŸåˆ™:
    - çº³å…¥å¸¸è§„å·¥ä½œæµ
    - å®šæœŸreviewå’Œå¤„ç†
```

### 11.1.2 kubectlæ ¸å¿ƒè°ƒè¯•å‘½ä»¤

#### kubectlè°ƒè¯•å‘½ä»¤åˆ†ç±»

kubectlæä¾›äº†ä¸°å¯Œçš„è°ƒè¯•å‘½ä»¤,æŒæ¡è¿™äº›å‘½ä»¤æ˜¯Kubernetesæ•…éšœæ’æŸ¥çš„åŸºç¡€:

**1. èµ„æºæŸ¥çœ‹å‘½ä»¤**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl get - åˆ—å‡ºèµ„æº
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹æ‰€æœ‰Pod (ç®€æ´è§†å›¾)
kubectl get pods

# æŸ¥çœ‹æ‰€æœ‰Pod (å®½è§†å›¾,æ˜¾ç¤ºIPå’ŒèŠ‚ç‚¹)
kubectl get pods -o wide

# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´çš„Pod
kubectl get pods --all-namespaces
# æˆ–ç®€å†™
kubectl get pods -A

# æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯ (YAMLæ ¼å¼)
kubectl get pod <pod-name> -o yaml

# æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯ (JSONæ ¼å¼)
kubectl get pod <pod-name> -o json

# ä½¿ç”¨JSONPathæå–ç‰¹å®šå­—æ®µ
kubectl get pod <pod-name> -o jsonpath='{.status.podIP}'
kubectl get pod <pod-name> -o jsonpath='{.spec.containers[*].name}'

# è‡ªå®šä¹‰åˆ—æ˜¾ç¤º
kubectl get pods -o custom-columns=\
NAME:.metadata.name,\
STATUS:.status.phase,\
NODE:.spec.nodeName,\
IP:.status.podIP

# æŒ‰æ ‡ç­¾é€‰æ‹©
kubectl get pods -l app=nginx
kubectl get pods -l 'app in (nginx,apache)'
kubectl get pods -l app=nginx,env=prod

# æŒ‰å­—æ®µé€‰æ‹©
kubectl get pods --field-selector status.phase=Running
kubectl get pods --field-selector spec.nodeName=node-1

# æ’åºè¾“å‡º
kubectl get pods --sort-by='.status.startTime'
kubectl get pods --sort-by='.metadata.creationTimestamp'

# ç›‘å¬èµ„æºå˜åŒ– (watchæ¨¡å¼)
kubectl get pods -w
kubectl get pods -w -o wide

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl describe - æŸ¥çœ‹èµ„æºè¯¦ç»†ä¿¡æ¯
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯ (äººç±»å¯è¯»æ ¼å¼)
kubectl describe pod <pod-name>

# describeè¾“å‡ºåŒ…å«:
# - åŸºæœ¬ä¿¡æ¯: Name, Namespace, Node, Labels, Annotations
# - çŠ¶æ€ä¿¡æ¯: Status, IP, Controlled By
# - å®¹å™¨ä¿¡æ¯: Image, Ports, Resources, Environment
# - æ¡ä»¶ä¿¡æ¯: Initialized, Ready, ContainersReady, PodScheduled
# - å·æŒ‚è½½: Volumes, Mounts
# - QoSç±»: Guaranteed/Burstable/BestEffort
# - äº‹ä»¶: Events (æœ€è¿‘çš„Podäº‹ä»¶,éå¸¸é‡è¦!)

# æŸ¥çœ‹Nodeè¯¦ç»†ä¿¡æ¯
kubectl describe node <node-name>
# è¾“å‡ºåŒ…å«:
# - èŠ‚ç‚¹æ ‡ç­¾å’Œæ±¡ç‚¹
# - ç³»ç»Ÿä¿¡æ¯: OS, Kernel, Container Runtime
# - èµ„æºå®¹é‡å’Œå¯åˆ†é…èµ„æº
# - å·²åˆ†é…èµ„æºç»Ÿè®¡
# - Podåˆ—è¡¨
# - èŠ‚ç‚¹äº‹ä»¶

# æŸ¥çœ‹Serviceè¯¦ç»†ä¿¡æ¯
kubectl describe service <service-name>
# è¾“å‡ºåŒ…å«:
# - Serviceç±»å‹ (ClusterIP/NodePort/LoadBalancer)
# - ClusterIPå’Œç«¯å£
# - Endpoints (åç«¯Pod IPåˆ—è¡¨)
# - Session Affinity
# - Events

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl top - æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# å‰æ: éœ€è¦éƒ¨ç½²metrics-server

# æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨
kubectl top node
# è¾“å‡ºç¤ºä¾‹:
# NAME     CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
# node-1   850m         21%    4096Mi          52%
# node-2   1200m        30%    6144Mi          78%

# æŸ¥çœ‹Podèµ„æºä½¿ç”¨
kubectl top pod
kubectl top pod -n kube-system
kubectl top pod --all-namespaces

# æŒ‰èµ„æºæ’åº
kubectl top pod --sort-by=cpu
kubectl top pod --sort-by=memory

# æŸ¥çœ‹Podä¸­å„å®¹å™¨çš„èµ„æºä½¿ç”¨
kubectl top pod <pod-name> --containers

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl events - æŸ¥çœ‹äº‹ä»¶
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹æ‰€æœ‰äº‹ä»¶
kubectl get events

# æŒ‰æ—¶é—´æ’åº (æœ€æ–°çš„åœ¨å‰)
kubectl get events --sort-by='.lastTimestamp'

# æŸ¥çœ‹ç‰¹å®šèµ„æºçš„äº‹ä»¶
kubectl get events --field-selector involvedObject.name=<pod-name>

# æŸ¥çœ‹ç‰¹å®šç±»å‹çš„äº‹ä»¶
kubectl get events --field-selector type=Warning
kubectl get events --field-selector type=Normal

# æŸ¥çœ‹ç‰¹å®šå‘½åç©ºé—´çš„äº‹ä»¶
kubectl get events -n kube-system

# ç›‘å¬æ–°äº‹ä»¶
kubectl get events -w

# æŸ¥çœ‹äº‹ä»¶è¯¦ç»†ä¿¡æ¯
kubectl describe event <event-name>

**2. æ—¥å¿—æŸ¥çœ‹å‘½ä»¤**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl logs - æŸ¥çœ‹å®¹å™¨æ—¥å¿—
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹Podæ—¥å¿— (å•å®¹å™¨Pod)
kubectl logs <pod-name>

# æŸ¥çœ‹Podä¸­ç‰¹å®šå®¹å™¨çš„æ—¥å¿— (å¤šå®¹å™¨Pod)
kubectl logs <pod-name> -c <container-name>

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
kubectl logs <pod-name> --tail=100

# æŸ¥çœ‹æœ€è¿‘1å°æ—¶çš„æ—¥å¿—
kubectl logs <pod-name> --since=1h
kubectl logs <pod-name> --since=60m

# æŸ¥çœ‹æŒ‡å®šæ—¶é—´ä¹‹åçš„æ—¥å¿—
kubectl logs <pod-name> --since-time=2024-02-08T14:00:00Z

# å®æ—¶è·Ÿè¸ªæ—¥å¿— (ç±»ä¼¼tail -f)
kubectl logs <pod-name> -f
kubectl logs <pod-name> -c <container-name> -f --tail=50

# æŸ¥çœ‹ä¹‹å‰å®¹å™¨çš„æ—¥å¿— (å®¹å™¨é‡å¯/å´©æºƒåœºæ™¯)
kubectl logs <pod-name> --previous
kubectl logs <pod-name> -c <container-name> --previous

# åœºæ™¯: å®¹å™¨åå¤é‡å¯,æŸ¥çœ‹å´©æºƒåŸå› 
kubectl logs <pod-name> -c <container-name> --previous --tail=100

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„æ—¥å¿— (åŒ…æ‹¬initå®¹å™¨)
kubectl logs <pod-name> --all-containers=true

# æŸ¥çœ‹initå®¹å™¨æ—¥å¿—
kubectl logs <pod-name> -c <init-container-name>

# æ·»åŠ æ—¶é—´æˆ³
kubectl logs <pod-name> --timestamps

# è¿‡æ»¤æ—¥å¿— (ç»“åˆgrep)
kubectl logs <pod-name> | grep ERROR
kubectl logs <pod-name> | grep -i "exception\|error\|fatal"

# æŸ¥çœ‹å¤šä¸ªPodçš„æ—¥å¿— (ä½¿ç”¨æ ‡ç­¾)
kubectl logs -l app=nginx --all-containers=true

# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
kubectl logs <pod-name> > pod-logs.txt
kubectl logs <pod-name> --previous > pod-crash-logs.txt

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æ—¥å¿—åˆ†ææŠ€å·§
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æŸ¥æ‰¾é”™è¯¯å…³é”®è¯
kubectl logs <pod-name> | grep -E "error|exception|fatal|panic|fail" -i

# 2. ç»Ÿè®¡é”™è¯¯å‡ºç°æ¬¡æ•°
kubectl logs <pod-name> | grep -i error | wc -l

# 3. æŸ¥æ‰¾ç‰¹å®šæ—¶é—´æ®µçš„é”™è¯¯
kubectl logs <pod-name> --since=1h | grep ERROR

# 4. æŸ¥çœ‹åº”ç”¨å¯åŠ¨æ—¥å¿— (æ£€æŸ¥å¯åŠ¨å¤±è´¥åŸå› )
kubectl logs <pod-name> --tail=200 | head -50

# 5. æŸ¥æ‰¾OOM (å†…å­˜æº¢å‡º) ç›¸å…³æ—¥å¿—
kubectl logs <pod-name> --previous | grep -i "out of memory\|oom"

# 6. æŸ¥æ‰¾è¿æ¥é”™è¯¯
kubectl logs <pod-name> | grep -i "connection refused\|timeout\|connect failed"

# 7. å¯¼å‡ºæ‰€æœ‰Podæ—¥å¿— (æ‰¹é‡æ’æŸ¥)
for pod in $(kubectl get pods -l app=nginx -o name); do
  echo "=== $pod ===" >> all-logs.txt
  kubectl logs $pod >> all-logs.txt 2>&1
done
```

**å®æˆ˜æ¡ˆä¾‹ - ä½¿ç”¨æ—¥å¿—æ’æŸ¥Podå¯åŠ¨å¤±è´¥**:

```bash
# åœºæ™¯: Podä¸€ç›´å¤„äºCrashLoopBackOffçŠ¶æ€

# 1. æŸ¥çœ‹PodçŠ¶æ€
kubectl get pod myapp-5d7f8c9b-xyz
# NAME                    READY   STATUS             RESTARTS   AGE
# myapp-5d7f8c9b-xyz      0/1     CrashLoopBackOff   5          5m

# 2. æŸ¥çœ‹å´©æºƒå‰çš„æ—¥å¿—
kubectl logs myapp-5d7f8c9b-xyz --previous --tail=50
# è¾“å‡ºç¤ºä¾‹:
# 2024-02-08T10:15:30.123Z INFO  Starting application...
# 2024-02-08T10:15:30.456Z INFO  Connecting to database mysql://db.example.com:3306
# 2024-02-08T10:15:32.789Z ERROR Failed to connect: Connection refused
# 2024-02-08T10:15:32.790Z FATAL Application failed to start
# 2024-02-08T10:15:32.790Z INFO  Exiting with code 1

# 3. åˆ†æ: åº”ç”¨æ— æ³•è¿æ¥åˆ°æ•°æ®åº“,å¯¼è‡´å¯åŠ¨å¤±è´¥

# 4. éªŒè¯æ•°æ®åº“æœåŠ¡æ˜¯å¦å­˜åœ¨
kubectl get svc mysql
# å¦‚æœä¸å­˜åœ¨,åˆ™éœ€è¦å…ˆéƒ¨ç½²æ•°æ®åº“æœåŠ¡

# 5. å¦‚æœæœåŠ¡å­˜åœ¨,æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
kubectl run test --image=mysql:8.0 -it --rm -- \
  mysql -h mysql.default.svc.cluster.local -u root -p

# 6. æ£€æŸ¥åº”ç”¨é…ç½®
kubectl get pod myapp-5d7f8c9b-xyz -o yaml | grep -A 10 env:
# æŸ¥çœ‹æ•°æ®åº“è¿æ¥é…ç½®æ˜¯å¦æ­£ç¡®
```

**3. å®¹å™¨äº¤äº’å‘½ä»¤**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl exec - åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# åœ¨Podä¸­æ‰§è¡Œå•ä¸ªå‘½ä»¤
kubectl exec <pod-name> -- ls -la /app

# åœ¨å¤šå®¹å™¨Podä¸­æŒ‡å®šå®¹å™¨
kubectl exec <pod-name> -c <container-name> -- ps aux

# è¿›å…¥å®¹å™¨äº¤äº’å¼shell
kubectl exec -it <pod-name> -- /bin/bash
kubectl exec -it <pod-name> -- /bin/sh  # å¦‚æœæ²¡æœ‰bash

# å¤šå®¹å™¨Podè¿›å…¥æŒ‡å®šå®¹å™¨
kubectl exec -it <pod-name> -c <container-name> -- /bin/bash

# åœ¨å®¹å™¨ä¸­æŸ¥çœ‹ç¯å¢ƒå˜é‡
kubectl exec <pod-name> -- env

# åœ¨å®¹å™¨ä¸­æµ‹è¯•ç½‘ç»œè¿é€šæ€§
kubectl exec <pod-name> -- ping 8.8.8.8
kubectl exec <pod-name> -- curl http://service-name:8080/health

# åœ¨å®¹å™¨ä¸­æ£€æŸ¥è¿›ç¨‹
kubectl exec <pod-name> -- ps aux
kubectl exec <pod-name> -- top -b -n 1

# åœ¨å®¹å™¨ä¸­æ£€æŸ¥æ–‡ä»¶
kubectl exec <pod-name> -- ls -la /var/log/
kubectl exec <pod-name> -- cat /etc/nginx/nginx.conf

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl exec å®æˆ˜æŠ€å·§
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥å®¹å™¨å†…DNSè§£æ
kubectl exec <pod-name> -- nslookup kubernetes.default
kubectl exec <pod-name> -- cat /etc/resolv.conf

# 2. æµ‹è¯•Serviceè¿æ¥
kubectl exec <pod-name> -- curl -v http://my-service:8080

# 3. æ£€æŸ¥æŒ‚è½½çš„Volume
kubectl exec <pod-name> -- df -h
kubectl exec <pod-name> -- ls -la /mnt/data

# 4. æŸ¥çœ‹å®¹å™¨å†…æ—¥å¿—æ–‡ä»¶
kubectl exec <pod-name> -- tail -f /var/log/app.log

# 5. æ£€æŸ¥åº”ç”¨é…ç½®æ–‡ä»¶
kubectl exec <pod-name> -- cat /etc/app/config.yaml

# 6. æ’æŸ¥æ•°æ®åº“è¿æ¥é—®é¢˜
kubectl exec <pod-name> -- nc -zv mysql-service 3306

# 7. æ£€æŸ¥å®¹å™¨æ—¶åŒºé…ç½®
kubectl exec <pod-name> -- date
kubectl exec <pod-name> -- cat /etc/timezone

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl cp - å¤åˆ¶æ–‡ä»¶åˆ°/ä»å®¹å™¨
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°
kubectl cp <pod-name>:/path/to/file ./local-file
kubectl cp <pod-name>:/var/log/app.log ./app.log

# ä»æœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨
kubectl cp ./local-file <pod-name>:/path/to/file
kubectl cp ./config.yaml <pod-name>:/etc/app/config.yaml

# å¤šå®¹å™¨PodæŒ‡å®šå®¹å™¨
kubectl cp <pod-name>:/path/to/file ./local-file -c <container-name>

# å¤åˆ¶æ•´ä¸ªç›®å½•
kubectl cp <pod-name>:/var/log/ ./logs/

# åœºæ™¯: å¯¼å‡ºå®¹å™¨å†…çš„æ—¥å¿—æ–‡ä»¶åˆ°æœ¬åœ°åˆ†æ
kubectl cp myapp-pod:/var/log/application.log ./debug-logs/
```

**å®æˆ˜æ¡ˆä¾‹ - ä½¿ç”¨execæ’æŸ¥åº”ç”¨é—®é¢˜**:

```bash
# åœºæ™¯: åº”ç”¨è¿”å›500é”™è¯¯,éœ€è¦è¿›å…¥å®¹å™¨æ’æŸ¥

# 1. è¿›å…¥å®¹å™¨
kubectl exec -it myapp-5d7f8c9b-xyz -- /bin/bash

# 2. æ£€æŸ¥åº”ç”¨è¿›ç¨‹
ps aux | grep java
# ç¡®è®¤åº”ç”¨è¿›ç¨‹æ˜¯å¦è¿è¡Œ

# 3. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tunlp | grep 8080
# æˆ–
ss -tunlp | grep 8080
# ç¡®è®¤åº”ç”¨æ˜¯å¦ç›‘å¬æ­£ç¡®ç«¯å£

# 4. æµ‹è¯•åº”ç”¨æ¥å£
curl http://localhost:8080/health
curl http://localhost:8080/api/users

# 5. æ£€æŸ¥åº”ç”¨æ—¥å¿—
tail -f /var/log/application.log
# å®æ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—

# 6. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /etc/app/application.yaml
# ç¡®è®¤é…ç½®æ˜¯å¦æ­£ç¡®

# 7. æµ‹è¯•æ•°æ®åº“è¿æ¥
nc -zv mysql-service 3306
# å¦‚æœå®¹å™¨å†…æ²¡æœ‰nc,å°è¯•telnet:
telnet mysql-service 3306

# 8. æ£€æŸ¥ç¯å¢ƒå˜é‡
env | grep -i db
# æŸ¥çœ‹æ•°æ®åº“ç›¸å…³ç¯å¢ƒå˜é‡

# 9. æ£€æŸ¥DNSè§£æ
nslookup mysql-service
dig mysql-service

# 10. é€€å‡ºå®¹å™¨
exit
```

**4. èµ„æºç¼–è¾‘å‘½ä»¤**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl edit - åœ¨çº¿ç¼–è¾‘èµ„æº
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ç¼–è¾‘Deployment
kubectl edit deployment <deployment-name>
# ä¼šæ‰“å¼€é»˜è®¤ç¼–è¾‘å™¨ (é€šå¸¸æ˜¯vim),ä¿®æ”¹åä¿å­˜å³ç”Ÿæ•ˆ

# ç¼–è¾‘Service
kubectl edit service <service-name>

# ç¼–è¾‘ConfigMap
kubectl edit configmap <configmap-name>

# æŒ‡å®šç¼–è¾‘å™¨
KUBE_EDITOR="nano" kubectl edit deployment <deployment-name>

# æ³¨æ„: editå‘½ä»¤ç›´æ¥ä¿®æ”¹etcdä¸­çš„èµ„æº,éœ€è°¨æ…ä½¿ç”¨

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl patch - éƒ¨åˆ†æ›´æ–°èµ„æº
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ›´æ–°Deploymentå‰¯æœ¬æ•°
kubectl patch deployment myapp -p '{"spec":{"replicas":5}}'

# æ›´æ–°Podå®¹å™¨é•œåƒ
kubectl patch pod myapp-pod -p '{"spec":{"containers":[{"name":"myapp","image":"myapp:v2.0"}]}}'

# æ·»åŠ æ ‡ç­¾
kubectl patch pod myapp-pod -p '{"metadata":{"labels":{"version":"v2.0"}}}'

# ä½¿ç”¨JSON patch
kubectl patch deployment myapp --type='json' -p='[{"op":"replace","path":"/spec/replicas","value":3}]'

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl scale - æ‰©ç¼©å®¹
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ‰‹åŠ¨æ‰©å®¹
kubectl scale deployment myapp --replicas=5

# ç¼©å®¹
kubectl scale deployment myapp --replicas=1

# æ‰©å®¹StatefulSet
kubectl scale statefulset mysql --replicas=3

# æ¡ä»¶æ‰©å®¹ (ä»…å½“å½“å‰å‰¯æœ¬æ•°ä¸º2æ—¶æ‰æ‰©å®¹åˆ°3)
kubectl scale deployment myapp --current-replicas=2 --replicas=3

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl set - æ›´æ–°èµ„æº
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ›´æ–°é•œåƒ
kubectl set image deployment/myapp myapp=myapp:v2.0
kubectl set image deployment/myapp myapp=myapp:v2.0 --record

# æ›´æ–°èµ„æºé™åˆ¶
kubectl set resources deployment myapp -c=myapp --limits=cpu=500m,memory=512Mi

# æ›´æ–°ç¯å¢ƒå˜é‡
kubectl set env deployment/myapp DB_HOST=mysql.example.com

# æŸ¥çœ‹ç¯å¢ƒå˜é‡
kubectl set env deployment/myapp --list

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl rollout - ç®¡ç†å‘å¸ƒ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹å‘å¸ƒçŠ¶æ€
kubectl rollout status deployment/myapp

# æŸ¥çœ‹å‘å¸ƒå†å²
kubectl rollout history deployment/myapp

# æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬è¯¦æƒ…
kubectl rollout history deployment/myapp --revision=2

# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/myapp

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
kubectl rollout undo deployment/myapp --to-revision=2

# æš‚åœå‘å¸ƒ (é‡‘ä¸é›€éƒ¨ç½²åœºæ™¯)
kubectl rollout pause deployment/myapp

# æ¢å¤å‘å¸ƒ
kubectl rollout resume deployment/myapp

# é‡å¯Deployment (å¼ºåˆ¶é‡å»ºæ‰€æœ‰Pod)
kubectl rollout restart deployment/myapp
```

**5. è°ƒè¯•ä¸“ç”¨å‘½ä»¤**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl debug - ä¸´æ—¶è°ƒè¯•å®¹å™¨ (K8s 1.18+)
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# åœ¨ç°æœ‰Podä¸­åˆ›å»ºè°ƒè¯•å®¹å™¨
kubectl debug <pod-name> -it --image=busybox
kubectl debug <pod-name> -it --image=nicolaka/netshoot

# å¤åˆ¶Podå¹¶æ·»åŠ è°ƒè¯•å®¹å™¨
kubectl debug <pod-name> -it --image=busybox --copy-to=debug-pod

# å¤åˆ¶Podå¹¶ä¿®æ”¹å‘½ä»¤ (æ’æŸ¥å¯åŠ¨å¤±è´¥)
kubectl debug <pod-name> -it --copy-to=debug-pod --container=myapp -- sh

# åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºè°ƒè¯•Pod (è®¿é—®èŠ‚ç‚¹æ–‡ä»¶ç³»ç»Ÿ)
kubectl debug node/<node-name> -it --image=ubuntu

# åœºæ™¯: Podæ— æ³•å¯åŠ¨,ä½¿ç”¨debugå®¹å™¨æ’æŸ¥
kubectl debug failing-pod -it --image=busybox --copy-to=debug-pod
# åœ¨debug-podä¸­æ‰‹åŠ¨è¿è¡Œåº”ç”¨å‘½ä»¤,æŸ¥çœ‹é”™è¯¯

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl run - ä¸´æ—¶æµ‹è¯•Pod
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# åˆ›å»ºä¸´æ—¶æµ‹è¯•Pod
kubectl run test --image=busybox -it --rm -- sh
# --rm: Podé€€å‡ºåè‡ªåŠ¨åˆ é™¤

# æµ‹è¯•DNSè§£æ
kubectl run test-dns --image=busybox -it --rm -- nslookup kubernetes.default

# æµ‹è¯•Serviceè¿é€šæ€§
kubectl run test-curl --image=curlimages/curl -it --rm -- \
  curl http://my-service:8080

# æµ‹è¯•æ•°æ®åº“è¿æ¥
kubectl run test-mysql --image=mysql:8.0 -it --rm -- \
  mysql -h mysql-service -u root -p

# ç½‘ç»œè¯Šæ–­ (ä½¿ç”¨netshootå·¥å…·é•œåƒ)
kubectl run netshoot --image=nicolaka/netshoot -it --rm -- bash
# netshootåŒ…å«: tcpdump, netstat, iperf, nmapç­‰å·¥å…·

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl port-forward - ç«¯å£è½¬å‘
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è½¬å‘Podç«¯å£åˆ°æœ¬åœ°
kubectl port-forward <pod-name> 8080:80
# æœ¬åœ°è®¿é—®: http://localhost:8080

# è½¬å‘Serviceç«¯å£
kubectl port-forward svc/<service-name> 8080:80

# æŒ‡å®šæœ¬åœ°ç›‘å¬åœ°å€
kubectl port-forward --address 0.0.0.0 <pod-name> 8080:80
# å…è®¸å…¶ä»–æœºå™¨è®¿é—®

# å¤šç«¯å£è½¬å‘
kubectl port-forward <pod-name> 8080:80 9090:9090

# åœºæ™¯: æœ¬åœ°è°ƒè¯•Podåº”ç”¨
kubectl port-forward myapp-pod 8080:8080
# åœ¨æœ¬åœ°æµè§ˆå™¨è®¿é—® http://localhost:8080

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl proxy - APIä»£ç†
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# å¯åŠ¨APIä»£ç†æœåŠ¡å™¨
kubectl proxy --port=8001
# è®¿é—®: http://localhost:8001/api/v1/namespaces/default/pods

# è®¿é—®Podçš„metricsç«¯ç‚¹
# http://localhost:8001/api/v1/namespaces/default/pods/<pod-name>/proxy/metrics

# è®¿é—®Service
# http://localhost:8001/api/v1/namespaces/default/services/<service-name>/proxy/
```

### 11.1.3 å®¹å™¨è°ƒè¯•æŠ€å·§

#### å®¹å™¨æ— æ³•å¯åŠ¨çš„è°ƒè¯•

å½“å®¹å™¨æ— æ³•å¯åŠ¨æ—¶,éœ€è¦ç³»ç»ŸåŒ–åœ°æ’æŸ¥åŸå› :

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# åœºæ™¯1: é•œåƒæ‹‰å–å¤±è´¥ (ImagePullBackOff)
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æŸ¥çœ‹PodçŠ¶æ€
kubectl get pod myapp-pod
# STATUS: ImagePullBackOff æˆ– ErrImagePull

# 2. æŸ¥çœ‹è¯¦ç»†é”™è¯¯
kubectl describe pod myapp-pod
# Events:
#   Warning  Failed     3m    kubelet  Failed to pull image "myapp:v1.0": rpc error: code = Unknown desc = Error response from daemon: pull access denied

# å¸¸è§åŸå› :
# - é•œåƒåç§°æˆ–æ ‡ç­¾é”™è¯¯
# - é•œåƒä¸å­˜åœ¨
# - ç§æœ‰ä»“åº“è®¤è¯å¤±è´¥
# - ç½‘ç»œé—®é¢˜å¯¼è‡´æ— æ³•è®¿é—®é•œåƒä»“åº“

# 3. è§£å†³æ–¹æ¡ˆ

# æ–¹æ¡ˆA: æ£€æŸ¥é•œåƒæ˜¯å¦å­˜åœ¨
docker pull myapp:v1.0
# å¦‚æœæœ¬åœ°å¯ä»¥æ‹‰å–,åˆ™è¯´æ˜é•œåƒå­˜åœ¨

# æ–¹æ¡ˆB: åˆ›å»ºé•œåƒæ‹‰å–å¯†é’¥ (ç§æœ‰ä»“åº“)
kubectl create secret docker-registry regcred \
  --docker-server=registry.example.com \
  --docker-username=myuser \
  --docker-password=mypassword \
  --docker-email=myemail@example.com

# åœ¨Podä¸­ä½¿ç”¨å¯†é’¥
cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: registry.example.com/myapp:v1.0
  imagePullSecrets:
  - name: regcred  # å¼•ç”¨å¯†é’¥


**2. æ—¥å¿—æŸ¥çœ‹å‘½ä»¤**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl logs - æŸ¥çœ‹å®¹å™¨æ—¥å¿—
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹Podæ—¥å¿— (å•å®¹å™¨Pod)
kubectl logs <pod-name>

# æŸ¥çœ‹Podä¸­ç‰¹å®šå®¹å™¨çš„æ—¥å¿— (å¤šå®¹å™¨Pod)
kubectl logs <pod-name> -c <container-name>

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
kubectl logs <pod-name> --tail=100

# æŸ¥çœ‹æœ€è¿‘1å°æ—¶çš„æ—¥å¿—
kubectl logs <pod-name> --since=1h
kubectl logs <pod-name> --since=60m

# æŸ¥çœ‹æŒ‡å®šæ—¶é—´ä¹‹åçš„æ—¥å¿—
kubectl logs <pod-name> --since-time=2024-02-08T14:00:00Z

# å®æ—¶è·Ÿè¸ªæ—¥å¿— (ç±»ä¼¼tail -f)
kubectl logs <pod-name> -f
kubectl logs <pod-name> -c <container-name> -f --tail=50

# æŸ¥çœ‹ä¹‹å‰å®¹å™¨çš„æ—¥å¿— (å®¹å™¨é‡å¯/å´©æºƒåœºæ™¯)
kubectl logs <pod-name> --previous
kubectl logs <pod-name> -c <container-name> --previous

# åœºæ™¯: å®¹å™¨åå¤é‡å¯,æŸ¥çœ‹å´©æºƒåŸå› 
kubectl logs <pod-name> -c <container-name> --previous --tail=100

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„æ—¥å¿— (åŒ…æ‹¬initå®¹å™¨)
kubectl logs <pod-name> --all-containers=true

# æŸ¥çœ‹initå®¹å™¨æ—¥å¿—
kubectl logs <pod-name> -c <init-container-name>

# æ·»åŠ æ—¶é—´æˆ³
kubectl logs <pod-name> --timestamps

# è¿‡æ»¤æ—¥å¿— (ç»“åˆgrep)
kubectl logs <pod-name> | grep ERROR
kubectl logs <pod-name> | grep -i "exception\|error\|fatal"

# æŸ¥çœ‹å¤šä¸ªPodçš„æ—¥å¿— (ä½¿ç”¨æ ‡ç­¾)
kubectl logs -l app=nginx --all-containers=true

# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
kubectl logs <pod-name> > pod-logs.txt
kubectl logs <pod-name> --previous > pod-crash-logs.txt

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æ—¥å¿—åˆ†ææŠ€å·§
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æŸ¥æ‰¾é”™è¯¯å…³é”®è¯
kubectl logs <pod-name> | grep -E "error|exception|fatal|panic|fail" -i

# 2. ç»Ÿè®¡é”™è¯¯å‡ºç°æ¬¡æ•°
kubectl logs <pod-name> | grep -i error | wc -l

# 3. æŸ¥æ‰¾ç‰¹å®šæ—¶é—´æ®µçš„é”™è¯¯
kubectl logs <pod-name> --since=1h | grep ERROR

# 4. æŸ¥çœ‹åº”ç”¨å¯åŠ¨æ—¥å¿— (æ£€æŸ¥å¯åŠ¨å¤±è´¥åŸå› )
kubectl logs <pod-name> --tail=200 | head -50

# 5. æŸ¥æ‰¾OOM (å†…å­˜æº¢å‡º) ç›¸å…³æ—¥å¿—
kubectl logs <pod-name> --previous | grep -i "out of memory\|oom"

# 6. æŸ¥æ‰¾è¿æ¥é”™è¯¯
kubectl logs <pod-name> | grep -i "connection refused\|timeout\|connect failed"

# 7. å¯¼å‡ºæ‰€æœ‰Podæ—¥å¿— (æ‰¹é‡æ’æŸ¥)
for pod in $(kubectl get pods -l app=nginx -o name); do
  echo "=== $pod ===" >> all-logs.txt
  kubectl logs $pod >> all-logs.txt 2>&1
done
```

**å®æˆ˜æ¡ˆä¾‹ - ä½¿ç”¨æ—¥å¿—æ’æŸ¥Podå¯åŠ¨å¤±è´¥**:

```bash
# åœºæ™¯: Podä¸€ç›´å¤„äºCrashLoopBackOffçŠ¶æ€

# 1. æŸ¥çœ‹PodçŠ¶æ€
kubectl get pod myapp-5d7f8c9b-xyz
# NAME                    READY   STATUS             RESTARTS   AGE
# myapp-5d7f8c9b-xyz      0/1     CrashLoopBackOff   5          5m

# 2. æŸ¥çœ‹å´©æºƒå‰çš„æ—¥å¿—
kubectl logs myapp-5d7f8c9b-xyz --previous --tail=50
# è¾“å‡ºç¤ºä¾‹:
# 2024-02-08T10:15:30.123Z INFO  Starting application...
# 2024-02-08T10:15:30.456Z INFO  Connecting to database mysql://db.example.com:3306
# 2024-02-08T10:15:32.789Z ERROR Failed to connect: Connection refused
# 2024-02-08T10:15:32.790Z FATAL Application failed to start
# 2024-02-08T10:15:32.790Z INFO  Exiting with code 1

# 3. åˆ†æ: åº”ç”¨æ— æ³•è¿æ¥åˆ°æ•°æ®åº“,å¯¼è‡´å¯åŠ¨å¤±è´¥

# 4. éªŒè¯æ•°æ®åº“æœåŠ¡æ˜¯å¦å­˜åœ¨
kubectl get svc mysql
# å¦‚æœä¸å­˜åœ¨,åˆ™éœ€è¦å…ˆéƒ¨ç½²æ•°æ®åº“æœåŠ¡

# 5. å¦‚æœæœåŠ¡å­˜åœ¨,æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
kubectl run test --image=mysql:8.0 -it --rm -- \
  mysql -h mysql.default.svc.cluster.local -u root -p

# 6. æ£€æŸ¥åº”ç”¨é…ç½®
kubectl get pod myapp-5d7f8c9b-xyz -o yaml | grep -A 10 env:
# æŸ¥çœ‹æ•°æ®åº“è¿æ¥é…ç½®æ˜¯å¦æ­£ç¡®
```

**3. å®¹å™¨äº¤äº’å‘½ä»¤**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubectl exec - åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# åœ¨Podä¸­æ‰§è¡Œå•ä¸ªå‘½ä»¤
kubectl exec <pod-name> -- ls -la /app

# åœ¨å¤šå®¹å™¨Podä¸­æŒ‡å®šå®¹å™¨
kubectl exec <pod-name> -c <container-name> -- ps aux

# è¿›å…¥å®¹å™¨äº¤äº’å¼shell
kubectl exec -it <pod-name> -- /bin/bash
kubectl exec -it <pod-name> -- /bin/sh  # å¦‚æœæ²¡æœ‰bash

# å¤šå®¹å™¨Podè¿›å…¥æŒ‡å®šå®¹å™¨
kubectl exec -it <pod-name> -c <container-name> -- /bin/bash

# åœ¨å®¹å™¨ä¸­æŸ¥çœ‹ç¯å¢ƒå˜é‡
kubectl exec <pod-name> -- env

# åœ¨å®¹å™¨ä¸­æµ‹è¯•ç½‘ç»œè¿é€šæ€§
kubectl exec <pod-name> -- ping 8.8.8.8
kubectl exec <pod-name> -- curl http://service-name:8080/health

# åœ¨å®¹å™¨ä¸­æ£€æŸ¥è¿›ç¨‹
kubectl exec <pod-name> -- ps aux
kubectl exec <pod-name> -- top -b -n 1

# åœ¨å®¹å™¨ä¸­æ£€æŸ¥æ–‡ä»¶
kubectl exec <pod-name> -- ls -la /var/log/
kubectl exec <pod-name> -- cat /etc/nginx/nginx.conf
```

### 11.1.3 å®¹å™¨è°ƒè¯•å®æˆ˜æŠ€å·§

#### 1. ä½¿ç”¨Ephemeralå®¹å™¨è°ƒè¯•

Kubernetes 1.23+ æ”¯æŒä¸´æ—¶è°ƒè¯•å®¹å™¨,è¿™æ˜¯è°ƒè¯•ç”Ÿäº§ç¯å¢ƒPodçš„æœ€ä½³å®è·µ:

```bash
# åœºæ™¯: ç”Ÿäº§Podä½¿ç”¨distrolessé•œåƒ,æ²¡æœ‰shellå’Œè°ƒè¯•å·¥å…·

# åœ¨è¿è¡Œçš„Podä¸­æ·»åŠ ä¸´æ—¶è°ƒè¯•å®¹å™¨
kubectl debug myapp-pod -it --image=busybox --target=myapp

# ä½¿ç”¨åŒ…å«æ›´å¤šå·¥å…·çš„é•œåƒ
kubectl debug myapp-pod -it --image=nicolaka/netshoot --target=myapp

# nicolaka/netshoot åŒ…å«çš„å·¥å…·:
# - tcpdump (ç½‘ç»œæŠ“åŒ…)
# - netstat/ss (è¿æ¥æŸ¥çœ‹)
# - curl/wget (HTTPæµ‹è¯•)
# - dig/nslookup (DNSæµ‹è¯•)
# - iperf (ç½‘ç»œæ€§èƒ½æµ‹è¯•)
# - strace (ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ª)
# - htop (è¿›ç¨‹ç›‘æ§)
```

#### 2. å¤åˆ¶Podè¿›è¡Œè°ƒè¯•

å½“éœ€è¦ä¿®æ”¹Podé…ç½®è¿›è¡Œè°ƒè¯•æ—¶:

```bash
# å¤åˆ¶Podå¹¶ä¿®æ”¹å¯åŠ¨å‘½ä»¤
kubectl debug failing-pod -it --copy-to=debug-pod \
  --container=myapp -- /bin/sh

# åœ¨è°ƒè¯•Podä¸­æ‰‹åŠ¨è¿è¡Œåº”ç”¨
/app/start.sh

# è°ƒè¯•å®Œæˆååˆ é™¤
kubectl delete pod debug-pod
```

#### 3. èŠ‚ç‚¹çº§è°ƒè¯•

å½“éœ€è¦è®¿é—®èŠ‚ç‚¹æ–‡ä»¶ç³»ç»Ÿæ—¶:

```bash
# åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºç‰¹æƒè°ƒè¯•Pod
kubectl debug node/node-1 -it --image=ubuntu

# èŠ‚ç‚¹çš„æ ¹æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åœ¨ /host
ls /host/var/log/
cat /host/etc/resolv.conf

# æ£€æŸ¥èŠ‚ç‚¹ä¸Šçš„å®¹å™¨
crictl ps
crictl logs <container-id>
```



### 11.1.4 ç½‘ç»œè°ƒè¯•å·¥å…·é“¾

Kubernetesç½‘ç»œé—®é¢˜æ˜¯æœ€å¸¸è§ä¹Ÿæœ€å¤æ‚çš„æ•…éšœç±»å‹ã€‚æŒæ¡ç½‘ç»œè°ƒè¯•å·¥å…·é“¾è‡³å…³é‡è¦ã€‚

#### ç½‘ç»œè°ƒè¯•å·¥å…·é•œåƒ

é¦–å…ˆå‡†å¤‡ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç½‘ç»œå·¥å…·çš„è°ƒè¯•é•œåƒ:

```bash
# æ¨èä½¿ç”¨ nicolaka/netshoot é•œåƒ
# åŒ…å«: tcpdump, netstat, curl, dig, nslookup, iperf, nmapç­‰

# åˆ›å»ºç½‘ç»œè°ƒè¯•Pod
kubectl run netshoot --image=nicolaka/netshoot -it --rm -- bash

# æˆ–è€…ä½¿ç”¨busybox (æ›´è½»é‡)
kubectl run busybox --image=busybox:1.36 -it --rm -- sh
```

#### 1. DNSè°ƒè¯•

```bash
# åœ¨Podä¸­æµ‹è¯•DNSè§£æ
kubectl exec <pod-name> -- nslookup kubernetes.default
kubectl exec <pod-name> -- dig kubernetes.default.svc.cluster.local

# æ£€æŸ¥DNSé…ç½®
kubectl exec <pod-name> -- cat /etc/resolv.conf
# åº”è¯¥çœ‹åˆ°:
# nameserver 10.96.0.10  (CoreDNS Service IP)
# search default.svc.cluster.local svc.cluster.local cluster.local
# options ndots:5

# æµ‹è¯•DNSæœåŠ¡æ˜¯å¦æ­£å¸¸
kubectl run test-dns --image=busybox:1.36 -it --rm -- nslookup kubernetes.default

# æ£€æŸ¥CoreDNS PodçŠ¶æ€
kubectl get pods -n kube-system -l k8s-app=kube-dns

# æŸ¥çœ‹CoreDNSæ—¥å¿—
kubectl logs -n kube-system -l k8s-app=kube-dns --tail=100

# å¸¸è§DNSé—®é¢˜:
# 1. CoreDNS Podæœªè¿è¡Œ
# 2. CoreDNS Service ClusterIPé”™è¯¯
# 3. kubeletçš„--cluster-dnså‚æ•°é…ç½®é”™è¯¯
# 4. NetworkPolicyé˜»æ­¢DNSæµé‡
```

**DNSè°ƒè¯•å®æˆ˜æ¡ˆä¾‹**:

```yaml
# åœºæ™¯: Podæ— æ³•è§£æServiceåŸŸå

# 1. éªŒè¯DNSæœåŠ¡å­˜åœ¨
kubectl get svc -n kube-system kube-dns
# NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)         AGE
# kube-dns   ClusterIP   10.96.0.10   <none>        53/UDP,53/TCP   30d

# 2. æµ‹è¯•DNSè§£æ
kubectl run test --image=busybox:1.36 -it --rm -- nslookup my-service
# å¦‚æœè¿”å› "server can't find my-service: NXDOMAIN"
# è¯´æ˜DNSæœåŠ¡æ­£å¸¸,ä½†Serviceä¸å­˜åœ¨æˆ–åç§°é”™è¯¯

# 3. æ£€æŸ¥Serviceæ˜¯å¦å­˜åœ¨
kubectl get svc my-service
# å¦‚æœä¸å­˜åœ¨,éœ€è¦åˆ›å»ºService

# 4. æµ‹è¯•å®Œæ•´åŸŸå
kubectl run test --image=busybox:1.36 -it --rm -- \
  nslookup my-service.default.svc.cluster.local
# æˆåŠŸåˆ™è¯´æ˜éœ€è¦ä½¿ç”¨å®Œæ•´åŸŸåæˆ–é…ç½®searchåŸŸ

# 5. æ£€æŸ¥Podçš„resolv.conf
kubectl exec <pod-name> -- cat /etc/resolv.conf
```

#### 2. ç½‘ç»œè¿é€šæ€§æµ‹è¯•

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ping - ICMPæµ‹è¯•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æµ‹è¯•Pod IPè¿é€šæ€§
kubectl exec <source-pod> -- ping <target-pod-ip>

# æµ‹è¯•å¤–ç½‘è¿é€šæ€§
kubectl exec <pod-name> -- ping 8.8.8.8

# æ³¨æ„: æŸäº›ç½‘ç»œæ’ä»¶é»˜è®¤ç¦ç”¨ICMP,pingä¸é€šä¸ä»£è¡¨ç½‘ç»œä¸é€š

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# curl/wget - HTTPæµ‹è¯•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æµ‹è¯•Serviceè¿é€šæ€§ (HTTP)
kubectl exec <pod-name> -- curl -v http://my-service:8080

# æµ‹è¯•Pod IPç›´è¿
kubectl exec <pod-name> -- curl -v http://10.244.1.5:8080

# æµ‹è¯•å¤–éƒ¨URL
kubectl exec <pod-name> -- curl -v https://www.google.com

# æŸ¥çœ‹HTTPå“åº”å¤´
kubectl exec <pod-name> -- curl -I http://my-service:8080

# è®¾ç½®è¶…æ—¶æ—¶é—´
kubectl exec <pod-name> -- curl --max-time 5 http://my-service:8080

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# nc (netcat) - ç«¯å£æµ‹è¯•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æµ‹è¯•TCPç«¯å£è¿é€šæ€§
kubectl exec <pod-name> -- nc -zv my-service 8080
# è¾“å‡º: my-service (10.96.0.20:8080) open

# æµ‹è¯•UDPç«¯å£
kubectl exec <pod-name> -- nc -zuv my-service 53

# ç›‘å¬ç«¯å£ (æµ‹è¯•å…¥ç«™è¿æ¥)
kubectl exec <pod-name> -- nc -l -p 8080

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# telnet - ç«¯å£æµ‹è¯•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æµ‹è¯•TCPè¿æ¥
kubectl exec <pod-name> -- telnet my-service 8080
# æˆåŠŸ: Connected to my-service
# å¤±è´¥: Connection refused æˆ–è¶…æ—¶
```

#### 3. ç½‘ç»œæŠ“åŒ…åˆ†æ

ä½¿ç”¨tcpdumpæŠ“åŒ…æ˜¯è¯Šæ–­ç½‘ç»œé—®é¢˜çš„ç»ˆææ­¦å™¨:

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# tcpdumpåŸºç¡€ç”¨æ³•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# åœ¨Podä¸­æŠ“åŒ… (éœ€è¦NET_ADMIN capability)
kubectl exec <pod-name> -- tcpdump -i any -nn

# æŠ“å–ç‰¹å®šç«¯å£çš„åŒ…
kubectl exec <pod-name> -- tcpdump -i any -nn port 8080

# æŠ“å–ç‰¹å®šä¸»æœºçš„åŒ…
kubectl exec <pod-name> -- tcpdump -i any -nn host 10.244.1.5

# æŠ“å–HTTPæµé‡
kubectl exec <pod-name> -- tcpdump -i any -nn 'tcp port 80'

# ä¿å­˜æŠ“åŒ…åˆ°æ–‡ä»¶
kubectl exec <pod-name> -- tcpdump -i any -nn -w /tmp/capture.pcap
kubectl cp <pod-name>:/tmp/capture.pcap ./capture.pcap
# ä½¿ç”¨Wiresharkåˆ†æ

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# tcpdumpé«˜çº§è¿‡æ»¤
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŠ“å–SYNåŒ… (TCPæ¡æ‰‹)
kubectl exec <pod-name> -- tcpdump -i any 'tcp[tcpflags] & (tcp-syn) != 0'

# æŠ“å–HTTP POSTè¯·æ±‚
kubectl exec <pod-name> -- tcpdump -i any -s 0 -A 'tcp dst port 80 and (tcp[((tcp[12:1] & 0xf0) >> 2):4] = 0x504f5354)'

# æ’é™¤æŸäº›æµé‡
kubectl exec <pod-name> -- tcpdump -i any -nn not port 22

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# èŠ‚ç‚¹çº§æŠ“åŒ… (æ›´å…¨é¢)
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# SSHåˆ°èŠ‚ç‚¹
ssh node-1

# æŠ“å–æ‰€æœ‰æ¥å£çš„æµé‡
sudo tcpdump -i any -nn port 8080

# æŠ“å–ç‰¹å®šå®¹å™¨ç½‘ç»œå‘½åç©ºé—´çš„æµé‡
# 1. æ‰¾åˆ°å®¹å™¨ID
crictl ps | grep myapp

# 2. æ‰¾åˆ°å®¹å™¨çš„ç½‘ç»œå‘½åç©ºé—´
crictl inspect <container-id> | grep pid
# "pid": 12345

# 3. è¿›å…¥ç½‘ç»œå‘½åç©ºé—´æŠ“åŒ…
nsenter -t 12345 -n tcpdump -i eth0 -nn

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å®æˆ˜æ¡ˆä¾‹ - æ’æŸ¥Serviceæ— æ³•è®¿é—®
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# åœºæ™¯: Pod A è®¿é—® Service B è¶…æ—¶

# 1. åœ¨Pod Aä¸­å‘èµ·è¯·æ±‚å¹¶æŠ“åŒ…
kubectl exec pod-a -- tcpdump -i any -nn port 8080 &
kubectl exec pod-a -- curl http://service-b:8080

# 2. åˆ†ææŠ“åŒ…ç»“æœ
# å¦‚æœçœ‹åˆ°: SYN -> SYN-ACK -> ACK (æ­£å¸¸ä¸‰æ¬¡æ¡æ‰‹)
# è¯´æ˜TCPè¿æ¥å»ºç«‹æˆåŠŸ,é—®é¢˜åœ¨åº”ç”¨å±‚

# å¦‚æœçœ‹åˆ°: SYN -> SYN -> SYN (é‡ä¼ )
# è¯´æ˜ç›®æ ‡ç«¯å£ä¸å¯è¾¾æˆ–è¢«é˜²ç«å¢™æ‹¦æˆª

# 3. åœ¨Pod Bä¸­æŠ“åŒ… (éªŒè¯æµé‡æ˜¯å¦åˆ°è¾¾)
kubectl exec pod-b -- tcpdump -i any -nn port 8080

# 4. å¦‚æœPod Bæ²¡æœ‰æ”¶åˆ°åŒ…,æ£€æŸ¥Serviceå’ŒEndpoints
kubectl get svc service-b
kubectl get endpoints service-b
```

#### 4. ç½‘ç»œè·¯å¾„è¿½è¸ª

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# traceroute - è·¯å¾„è¿½è¸ª
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è¿½è¸ªåˆ°ç›®æ ‡çš„ç½‘ç»œè·¯å¾„
kubectl exec <pod-name> -- traceroute 8.8.8.8

# TCP traceroute (æ›´å¯é )
kubectl exec <pod-name> -- traceroute -T -p 80 www.google.com

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# mtr - æŒç»­è·¯å¾„è¿½è¸ª
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ç»“åˆpingå’Œtracerouteçš„åŠŸèƒ½
kubectl exec <pod-name> -- mtr 8.8.8.8

# ç”ŸæˆæŠ¥å‘Š
kubectl exec <pod-name> -- mtr --report 8.8.8.8
```

#### 5. ç«¯å£å’Œè¿æ¥æŸ¥çœ‹

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# netstat - ç½‘ç»œè¿æ¥æŸ¥çœ‹
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹æ‰€æœ‰TCPè¿æ¥
kubectl exec <pod-name> -- netstat -tan

# æŸ¥çœ‹ç›‘å¬ç«¯å£
kubectl exec <pod-name> -- netstat -tunlp

# æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
kubectl exec <pod-name> -- netstat -s

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ss - socketç»Ÿè®¡ (æ›´ç°ä»£çš„å·¥å…·)
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹æ‰€æœ‰TCPè¿æ¥
kubectl exec <pod-name> -- ss -tan

# æŸ¥çœ‹ç›‘å¬ç«¯å£
kubectl exec <pod-name> -- ss -tunlp

# æŸ¥çœ‹ESTABLISHEDè¿æ¥
kubectl exec <pod-name> -- ss -tan state established

# ç»Ÿè®¡è¿æ¥æ•°
kubectl exec <pod-name> -- ss -s

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# lsof - æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶å’Œç½‘ç»œè¿æ¥
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹è¿›ç¨‹ç›‘å¬çš„ç«¯å£
kubectl exec <pod-name> -- lsof -i -P -n

# æŸ¥çœ‹ç‰¹å®šç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨
kubectl exec <pod-name> -- lsof -i :8080
```

#### 6. ç½‘ç»œæ€§èƒ½æµ‹è¯•

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# iperf - ç½‘ç»œå¸¦å®½æµ‹è¯•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# åœ¨Pod Aä¸­å¯åŠ¨iperfæœåŠ¡å™¨
kubectl exec pod-a -- iperf -s

# åœ¨Pod Bä¸­è¿è¡Œiperfå®¢æˆ·ç«¯
kubectl exec pod-b -- iperf -c <pod-a-ip>

# è¾“å‡ºç¤ºä¾‹:
# ------------------------------------------------------------
# Client connecting to 10.244.1.5, TCP port 5001
# TCP window size: 85.0 KByte (default)
# ------------------------------------------------------------
# [  3] local 10.244.2.8 port 52434 connected with 10.244.1.5 port 5001
# [ ID] Interval       Transfer     Bandwidth
# [  3]  0.0-10.0 sec  1.10 GBytes   941 Mbits/sec

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# iperf3 - æ›´æ–°ç‰ˆæœ¬
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æœåŠ¡ç«¯
kubectl exec pod-a -- iperf3 -s

# å®¢æˆ·ç«¯ (TCPæµ‹è¯•)
kubectl exec pod-b -- iperf3 -c <pod-a-ip> -t 30

# å®¢æˆ·ç«¯ (UDPæµ‹è¯•)
kubectl exec pod-b -- iperf3 -c <pod-a-ip> -u -b 1G

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ping - å»¶è¿Ÿæµ‹è¯•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æµ‹è¯•å»¶è¿Ÿå’Œä¸¢åŒ…ç‡
kubectl exec <pod-name> -- ping -c 100 <target-ip>
# å…³æ³¨: min/avg/max/mdev å’Œ packet loss
```

#### 7. NetworkPolicyè°ƒè¯•

NetworkPolicyé—®é¢˜æ˜¯ç½‘ç»œæ•…éšœçš„å¸¸è§åŸå› :

```bash
# 1. æŸ¥çœ‹å½“å‰å‘½åç©ºé—´çš„NetworkPolicy
kubectl get networkpolicy

# 2. æŸ¥çœ‹NetworkPolicyè¯¦æƒ…
kubectl describe networkpolicy <policy-name>

# 3. æµ‹è¯•NetworkPolicyæ˜¯å¦ç”Ÿæ•ˆ
# åˆ›å»ºæµ‹è¯•Pod
kubectl run test-source --image=busybox -it --rm -- sh
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯åˆ›å»ºç›®æ ‡Pod
kubectl run test-target --image=nginx --labels="app=test"

# åœ¨test-sourceä¸­æµ‹è¯•è¿æ¥
wget -O- http://test-target

# 4. å¦‚æœè¿æ¥è¢«é˜»æ­¢,æ£€æŸ¥NetworkPolicyè§„åˆ™
kubectl get networkpolicy -o yaml

# 5. ä¸´æ—¶ç¦ç”¨NetworkPolicy (è°ƒè¯•ç”¨)
kubectl delete networkpolicy <policy-name>
# é‡æ–°æµ‹è¯•è¿æ¥
```

**NetworkPolicyè°ƒè¯•æ¡ˆä¾‹**:

```yaml
# åœºæ™¯: Pod A æ— æ³•è®¿é—® Pod B

# 1. æ£€æŸ¥Pod Bçš„æ ‡ç­¾
kubectl get pod pod-b --show-labels
# Labels: app=backend,tier=database

# 2. æ£€æŸ¥æ˜¯å¦æœ‰NetworkPolicyåº”ç”¨åˆ°Pod B
kubectl get networkpolicy
kubectl describe networkpolicy backend-policy

# 3. ç¤ºä¾‹NetworkPolicy
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: backend-policy
spec:
  podSelector:
    matchLabels:
      app: backend
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: frontend  # åªå…è®¸frontend Podè®¿é—®
    ports:
    - protocol: TCP
      port: 3306

# 4. åˆ†æ: Pod A æ²¡æœ‰ app=frontend æ ‡ç­¾,æ‰€ä»¥è¢«æ‹’ç»

# 5. è§£å†³æ–¹æ¡ˆA: ç»™Pod Aæ·»åŠ æ ‡ç­¾
kubectl label pod pod-a app=frontend

# è§£å†³æ–¹æ¡ˆB: ä¿®æ”¹NetworkPolicy,å…è®¸Pod Aè®¿é—®
kubectl edit networkpolicy backend-policy
```

### 11.1.5 ç³»ç»Ÿçº§è°ƒè¯•å·¥å…·

å½“éœ€è¦æ·±å…¥åˆ°ç³»ç»Ÿå±‚é¢è°ƒè¯•æ—¶,éœ€è¦ä½¿ç”¨ä»¥ä¸‹å·¥å…·:

#### 1. strace - ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ª

```bash
# è·Ÿè¸ªè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨
kubectl exec <pod-name> -- strace -p <pid>

# è·Ÿè¸ªæ–‡ä»¶æ“ä½œ
kubectl exec <pod-name> -- strace -e trace=open,read,write -p <pid>

# è·Ÿè¸ªç½‘ç»œæ“ä½œ
kubectl exec <pod-name> -- strace -e trace=network -p <pid>

# ç»Ÿè®¡ç³»ç»Ÿè°ƒç”¨
kubectl exec <pod-name> -- strace -c -p <pid>

# åœºæ™¯: åº”ç”¨æŒ‚èµ·ä¸å“åº”
# æŸ¥çœ‹åº”ç”¨æ­£åœ¨æ‰§è¡Œä»€ä¹ˆç³»ç»Ÿè°ƒç”¨
ps aux | grep myapp  # æ‰¾åˆ°PID
strace -p <pid>
# å¦‚æœçœ‹åˆ°å¤§é‡ futex(WAIT) è°ƒç”¨,å¯èƒ½æ˜¯æ­»é”
```

#### 2. lsof - æŸ¥çœ‹æ‰“å¼€çš„æ–‡ä»¶

```bash
# æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶
kubectl exec <pod-name> -- lsof -p <pid>

# æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„ç½‘ç»œè¿æ¥
kubectl exec <pod-name> -- lsof -i -p <pid>

# æŸ¥çœ‹å“ªä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨æŸä¸ªæ–‡ä»¶
kubectl exec <pod-name> -- lsof /var/log/app.log

# åœºæ™¯: ç£ç›˜ç©ºé—´æ»¡,ä½†åˆ é™¤æ–‡ä»¶åç©ºé—´æœªé‡Šæ”¾
# åŸå› : è¿›ç¨‹ä»ç„¶æŒæœ‰å·²åˆ é™¤æ–‡ä»¶çš„å¥æŸ„
lsof | grep deleted
# éœ€è¦é‡å¯æŒæœ‰å¥æŸ„çš„è¿›ç¨‹
```

#### 3. top/htop - è¿›ç¨‹ç›‘æ§

```bash
# æŸ¥çœ‹è¿›ç¨‹èµ„æºä½¿ç”¨
kubectl exec <pod-name> -- top -b -n 1

# æ›´å‹å¥½çš„ç•Œé¢ (å¦‚æœå®¹å™¨ä¸­æœ‰htop)
kubectl exec <pod-name> -it -- htop

# æŒ‰å†…å­˜æ’åº
kubectl exec <pod-name> -- top -o %MEM

# æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„çº¿ç¨‹
kubectl exec <pod-name> -- top -H -p <pid>
```

#### 4. èŠ‚ç‚¹çº§è°ƒè¯•

```bash
# SSHåˆ°èŠ‚ç‚¹
ssh node-1

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç³»ç»Ÿèµ„æºæŸ¥çœ‹
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# CPUä½¿ç”¨æƒ…å†µ
mpstat 1 5

# å†…å­˜ä½¿ç”¨æƒ…å†µ
free -h
vmstat 1 5

# ç£ç›˜IO
iostat -x 1 5

# ç£ç›˜ç©ºé—´
df -h

# inodeä½¿ç”¨æƒ…å†µ
df -i

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å®¹å™¨è¿è¡Œæ—¶è°ƒè¯•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨
crictl ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
crictl logs <container-id>

# æŸ¥çœ‹å®¹å™¨è¯¦æƒ…
crictl inspect <container-id>

# è¿›å…¥å®¹å™¨
crictl exec -it <container-id> /bin/sh

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# kubeletæ—¥å¿—
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹kubeletæ—¥å¿—
journalctl -u kubelet -f

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯
journalctl -u kubelet -p err -n 50

# æŒ‰æ—¶é—´è¿‡æ»¤
journalctl -u kubelet --since "2024-02-08 10:00:00"
```

### 11.1.6 è°ƒè¯•å‘½ä»¤é€ŸæŸ¥è¡¨

ä»¥ä¸‹æ˜¯å¸¸ç”¨è°ƒè¯•å‘½ä»¤çš„å¿«é€Ÿå‚è€ƒ:

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PodçŠ¶æ€è¯Šæ–­
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
kubectl get pods                          # æŸ¥çœ‹PodçŠ¶æ€
kubectl describe pod <pod-name>           # æŸ¥çœ‹Podè¯¦æƒ…å’Œäº‹ä»¶
kubectl logs <pod-name> --previous        # æŸ¥çœ‹å´©æºƒå‰æ—¥å¿—
kubectl get events --sort-by='.lastTimestamp' | head -20  # æœ€è¿‘äº‹ä»¶

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç½‘ç»œè¯Šæ–­
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
kubectl exec <pod> -- nslookup <service>  # DNSè§£ææµ‹è¯•
kubectl exec <pod> -- curl http://<svc>   # HTTPè¿é€šæ€§æµ‹è¯•
kubectl exec <pod> -- nc -zv <host> <port>  # ç«¯å£è¿é€šæ€§æµ‹è¯•
kubectl exec <pod> -- tcpdump -i any -nn  # ç½‘ç»œæŠ“åŒ…

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# èµ„æºè¯Šæ–­
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
kubectl top node                          # èŠ‚ç‚¹èµ„æºä½¿ç”¨
kubectl top pod                           # Podèµ„æºä½¿ç”¨
kubectl describe node <node>              # èŠ‚ç‚¹è¯¦æƒ…

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# åº”ç”¨è°ƒè¯•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
kubectl exec -it <pod> -- /bin/bash       # è¿›å…¥å®¹å™¨
kubectl cp <pod>:/path/to/file ./file     # å¤åˆ¶æ–‡ä»¶
kubectl port-forward <pod> 8080:80        # ç«¯å£è½¬å‘
kubectl debug <pod> -it --image=busybox   # ä¸´æ—¶è°ƒè¯•å®¹å™¨

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å¿«é€Ÿä¿®å¤
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
kubectl delete pod <pod>                  # é‡å¯Pod
kubectl rollout restart deployment <name> # é‡å¯Deployment
kubectl rollout undo deployment <name>    # å›æ»šç‰ˆæœ¬
kubectl scale deployment <name> --replicas=3  # æ‰©ç¼©å®¹
```

---

**æœ¬èŠ‚å°ç»“**

åœ¨11.1èŠ‚ä¸­,æˆ‘ä»¬ç³»ç»Ÿå­¦ä¹ äº†Kubernetesè°ƒè¯•çš„æ–¹æ³•è®ºå’Œå·¥å…·:

1. **æ•…éšœæ’æŸ¥æ–¹æ³•è®º**:
   - USEæ–¹æ³• (Utilization, Saturation, Errors)
   - REDæ–¹æ³• (Rate, Errors, Duration)
   - Google SREå››å¤§é»„é‡‘æŒ‡æ ‡
   - 5W1Hæ•…éšœåˆ†ææ³•
   - æ•…éšœæ’æŸ¥å…­æ­¥æ³•

2. **kubectlæ ¸å¿ƒå‘½ä»¤**:
   - èµ„æºæŸ¥çœ‹: get, describe, top, events
   - æ—¥å¿—æŸ¥çœ‹: logs (--previous, --tail, -f)
   - å®¹å™¨äº¤äº’: exec, cp
   - èµ„æºç¼–è¾‘: edit, patch, scale, set
   - å‘å¸ƒç®¡ç†: rollout
   - ä¸´æ—¶è°ƒè¯•: debug, run, port-forward

3. **å®¹å™¨è°ƒè¯•æŠ€å·§**:
   - é•œåƒæ‹‰å–å¤±è´¥å¤„ç†
   - CrashLoopBackOffæ’æŸ¥
   - OOMKilledé—®é¢˜è§£å†³
   - Ephemeralå®¹å™¨ä½¿ç”¨
   - èŠ‚ç‚¹çº§è°ƒè¯•

4. **ç½‘ç»œè°ƒè¯•å·¥å…·é“¾**:
   - DNSè°ƒè¯• (nslookup, dig)
   - è¿é€šæ€§æµ‹è¯• (ping, curl, nc, telnet)
   - ç½‘ç»œæŠ“åŒ… (tcpdump)
   - è·¯å¾„è¿½è¸ª (traceroute, mtr)
   - è¿æ¥æŸ¥çœ‹ (netstat, ss, lsof)
   - æ€§èƒ½æµ‹è¯• (iperf)
   - NetworkPolicyè°ƒè¯•

5. **ç³»ç»Ÿçº§å·¥å…·**:
   - strace (ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ª)
   - lsof (æ–‡ä»¶å¥æŸ„)
   - top/htop (è¿›ç¨‹ç›‘æ§)
   - èŠ‚ç‚¹çº§è¯Šæ–­

æŒæ¡è¿™äº›å·¥å…·å’Œæ–¹æ³•å,ä½ å°†èƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œè§£å†³90%ä»¥ä¸Šçš„Kubernetesé—®é¢˜ã€‚åœ¨åç»­ç« èŠ‚ä¸­,æˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ å…·ä½“çš„æ•…éšœåœºæ™¯å’Œè§£å†³æ–¹æ¡ˆã€‚

---


## 11.2 Podæ•…éšœæ’æŸ¥

Podæ˜¯Kubernetesä¸­æœ€åŸºç¡€çš„è°ƒåº¦å•å…ƒï¼ŒPodæ•…éšœæ˜¯æœ€å¸¸è§çš„é—®é¢˜ç±»å‹ã€‚æœ¬èŠ‚å°†è¯¦ç»†ä»‹ç»å„ç§Podæ•…éšœåœºæ™¯çš„è¯Šæ–­å’Œè§£å†³æ–¹æ³•ã€‚

### 11.2.1 PodçŠ¶æ€è¯¦è§£

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£Podçš„å„ç§çŠ¶æ€åŠå…¶å«ä¹‰ï¼š

#### Pod Phaseï¼ˆé˜¶æ®µï¼‰

```yaml
Podç”Ÿå‘½å‘¨æœŸé˜¶æ®µ:

Pending (å¾…å®š):
  å«ä¹‰: Podå·²è¢«Kubernetesæ¥å—ï¼Œä½†å®¹å™¨å°šæœªåˆ›å»º
  å¸¸è§åŸå› :
    - ç­‰å¾…è°ƒåº¦åˆ°èŠ‚ç‚¹
    - æ­£åœ¨æ‹‰å–é•œåƒ
    - èµ„æºä¸è¶³æ— æ³•è°ƒåº¦
    - å­˜å‚¨å·æŒ‚è½½å¤±è´¥
  
  è¯Šæ–­å‘½ä»¤:
    kubectl describe pod <pod-name>
    # æŸ¥çœ‹Eventséƒ¨åˆ†çš„è¯¦ç»†ä¿¡æ¯

Running (è¿è¡Œä¸­):
  å«ä¹‰: Podå·²ç»‘å®šåˆ°èŠ‚ç‚¹ï¼Œæ‰€æœ‰å®¹å™¨éƒ½å·²åˆ›å»º
  çŠ¶æ€:
    - è‡³å°‘ä¸€ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œ
    - æˆ–æ­£åœ¨å¯åŠ¨/é‡å¯
  
  æ³¨æ„: Runningä¸ä»£è¡¨åº”ç”¨æ­£å¸¸å·¥ä½œ
    - å®¹å™¨å¯èƒ½åœ¨åå¤é‡å¯
    - åº”ç”¨å¯èƒ½å·²æ­»é”ä½†è¿›ç¨‹æœªé€€å‡º

Succeeded (æˆåŠŸ):
  å«ä¹‰: Podä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²æˆåŠŸç»ˆæ­¢ï¼Œä¸ä¼šé‡å¯
  é€‚ç”¨åœºæ™¯:
    - Jobç±»å‹çš„Pod
    - ä¸€æ¬¡æ€§ä»»åŠ¡æ‰§è¡Œå®Œæˆ
  
  é€€å‡ºç : æ‰€æœ‰å®¹å™¨é€€å‡ºç ä¸º0

Failed (å¤±è´¥):
  å«ä¹‰: Podä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²ç»ˆæ­¢ï¼Œè‡³å°‘ä¸€ä¸ªå®¹å™¨å¤±è´¥
  å¤±è´¥å®šä¹‰:
    - å®¹å™¨é€€å‡ºç é0
    - è¢«ç³»ç»Ÿç»ˆæ­¢
  
  å¸¸è§åŸå› :
    - åº”ç”¨é”™è¯¯å¯¼è‡´å´©æºƒ
    - å¥åº·æ£€æŸ¥å¤±è´¥
    - OOMè¢«æ€æ­»

Unknown (æœªçŸ¥):
  å«ä¹‰: æ— æ³•è·å–PodçŠ¶æ€
  å¸¸è§åŸå› :
    - Nodeå¤±è”
    - kubeletæ•…éšœ
    - ç½‘ç»œé—®é¢˜
```

#### å®¹å™¨çŠ¶æ€

```yaml
å®¹å™¨ä¸‰ç§çŠ¶æ€:

Waiting (ç­‰å¾…):
  å«ä¹‰: å®¹å™¨å°šæœªè¿è¡Œ
  åŸå› å­—æ®µ (Reason):
    - ContainerCreating: æ­£åœ¨åˆ›å»º
    - PodInitializing: ç­‰å¾…Initå®¹å™¨å®Œæˆ
    - ErrImagePull: é•œåƒæ‹‰å–é”™è¯¯
    - ImagePullBackOff: é•œåƒæ‹‰å–å¤±è´¥ï¼ˆé€€é¿é‡è¯•ï¼‰
    - CrashLoopBackOff: å®¹å™¨åå¤å´©æºƒ

Running (è¿è¡Œä¸­):
  å«ä¹‰: å®¹å™¨æ­£åœ¨æ‰§è¡Œ
  é‡è¦ä¿¡æ¯:
    - startedAt: å¯åŠ¨æ—¶é—´
    - containerID: å®¹å™¨ID
  
  æ£€æŸ¥è¦ç‚¹:
    - è¿›ç¨‹æ˜¯å¦æ­£å¸¸
    - èµ„æºä½¿ç”¨æƒ…å†µ
    - æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

Terminated (å·²ç»ˆæ­¢):
  å«ä¹‰: å®¹å™¨å·²åœæ­¢è¿è¡Œ
  é‡è¦ä¿¡æ¯:
    - exitCode: é€€å‡ºç 
    - reason: ç»ˆæ­¢åŸå› 
    - startedAt/finishedAt: è¿è¡Œæ—¶é—´
  
  å¸¸è§é€€å‡ºç :
    - 0: æ­£å¸¸é€€å‡º
    - 1: åº”ç”¨é”™è¯¯
    - 137: OOMKilled (128+9)
    - 143: SIGTERM (128+15)
```

#### Pod Conditionsï¼ˆæ¡ä»¶ï¼‰

```yaml
Podæ¡ä»¶ç±»å‹:

PodScheduled:
  True: Podå·²æˆåŠŸè°ƒåº¦åˆ°èŠ‚ç‚¹
  False: è°ƒåº¦å¤±è´¥ï¼ˆèµ„æºä¸è¶³ã€äº²å’Œæ€§ç­‰ï¼‰

Initialized:
  True: æ‰€æœ‰Initå®¹å™¨æˆåŠŸå®Œæˆ
  False: Initå®¹å™¨æ‰§è¡Œå¤±è´¥

ContainersReady:
  True: æ‰€æœ‰å®¹å™¨é€šè¿‡å°±ç»ªæ£€æŸ¥
  False: å®¹å™¨æœªå°±ç»ª

Ready:
  True: Podå¯ä»¥æ¥æ”¶æµé‡
  False: Podä¸åº”æ¥æ”¶æµé‡
  
  æ³¨æ„: Ready=True æ˜¯å®¹å™¨åŠ å…¥Service Endpointsçš„æ¡ä»¶

PodReadyToStartContainers (K8s 1.28+):
  True: Podæ²™ç®±åˆ›å»ºå®Œæˆï¼Œå¯ä»¥å¼€å§‹åˆ›å»ºå®¹å™¨
  False: Podæ²™ç®±åˆ›å»ºå¤±è´¥
```

### 11.2.2 PendingçŠ¶æ€æ’æŸ¥

Pendingæ˜¯Podæ— æ³•å¯åŠ¨çš„å¸¸è§çŠ¶æ€ï¼Œéœ€è¦ç³»ç»ŸåŒ–æ’æŸ¥ã€‚

#### åœºæ™¯1ï¼šèŠ‚ç‚¹èµ„æºä¸è¶³

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: Podä¸€ç›´å¤„äºPendingï¼Œäº‹ä»¶æ˜¾ç¤ºèµ„æºä¸è¶³
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æŸ¥çœ‹PodçŠ¶æ€
kubectl get pod myapp-pod
# NAME        READY   STATUS    RESTARTS   AGE
# myapp-pod   0/1     Pending   0          5m

# 2. æŸ¥çœ‹è¯¦ç»†äº‹ä»¶
kubectl describe pod myapp-pod
# Events:
#   Type     Reason            Age   Message
#   ----     ------            ----  -------
#   Warning  FailedScheduling  2m    0/3 nodes are available: 
#                                    1 Insufficient cpu, 
#                                    2 Insufficient memory.

# 3. åˆ†æå…·ä½“åŸå› 
# "Insufficient cpu" - CPUèµ„æºä¸è¶³
# "Insufficient memory" - å†…å­˜èµ„æºä¸è¶³

# 4. æ£€æŸ¥èŠ‚ç‚¹èµ„æº
kubectl top node
# NAME     CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
# node-1   3900m        97%    30Gi            98%
# node-2   3800m        95%    28Gi            92%
# node-3   3700m        92%    29Gi            95%

# 5. æŸ¥çœ‹Podçš„èµ„æºè¯·æ±‚
kubectl get pod myapp-pod -o yaml | grep -A 10 "resources:"
#     resources:
#       requests:
#         cpu: 2000m      # è¯·æ±‚2æ ¸CPU
#         memory: 4Gi     # è¯·æ±‚4GBå†…å­˜
#       limits:
#         cpu: 4000m
#         memory: 8Gi

# 6. æŸ¥çœ‹èŠ‚ç‚¹å¯åˆ†é…èµ„æº
kubectl describe node node-1 | grep -A 5 "Allocated resources"
#   Resource           Requests      Limits
#   --------           --------      ------
#   cpu                3900m (97%)   7800m (195%)
#   memory             30Gi (98%)    45Gi (147%)
# åˆ†æ: Requestså·²æ¥è¿‘100%ï¼Œæ— æ³•å†åˆ†é…2æ ¸CPUå’Œ4GBå†…å­˜

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: é™ä½Podèµ„æºè¯·æ±‚ï¼ˆå¦‚æœå¯æ¥å—ï¼‰
kubectl set resources deployment myapp --requests=cpu=500m,memory=1Gi

# æ–¹æ¡ˆB: æ‰©å®¹èŠ‚ç‚¹
# æ·»åŠ æ–°çš„WorkerèŠ‚ç‚¹åˆ°é›†ç¾¤

# æ–¹æ¡ˆC: æ¸…ç†ä¸å¿…è¦çš„Pod
kubectl get pods --all-namespaces --sort-by='.spec.containers[0].resources.requests.cpu'
# æ‰¾åˆ°èµ„æºå ç”¨å¤§ä½†ä¼˜å…ˆçº§ä½çš„Podå¹¶åˆ é™¤

# æ–¹æ¡ˆD: å¯ç”¨èŠ‚ç‚¹è‡ªåŠ¨æ‰©å®¹ï¼ˆäº‘ç¯å¢ƒï¼‰
# é…ç½®Cluster Autoscaler

# æ–¹æ¡ˆE: è°ƒæ•´ç°æœ‰Podçš„èµ„æºé…ç½®
# æ‰¾åˆ°è¿‡åº¦åˆ†é…èµ„æºçš„Podï¼Œé™ä½å…¶requestså€¼
kubectl top pod --all-namespaces --sort-by=memory
# æ¯”è¾ƒå®é™…ä½¿ç”¨vsè¯·æ±‚å€¼ï¼Œè°ƒæ•´è¿‡åº¦åˆ†é…
```

**å®æˆ˜æ¡ˆä¾‹ - èµ„æºè¯·æ±‚è®¾ç½®ä¸åˆç†**:

```yaml
# é—®é¢˜åœºæ™¯: å¼€å‘ç¯å¢ƒPodæ— æ³•è°ƒåº¦

# 1. æŸ¥çœ‹Podé…ç½®
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    resources:
      requests:
        cpu: "8000m"     # âŒ è¯·æ±‚8æ ¸ï¼Œä½†å®é™…åªç”¨1æ ¸
        memory: "16Gi"   # âŒ è¯·æ±‚16GBï¼Œä½†å®é™…åªç”¨2GB
      limits:
        cpu: "16000m"
        memory: "32Gi"

# 2. æŸ¥çœ‹å®é™…ä½¿ç”¨
kubectl top pod myapp-pod
# NAME        CPU(cores)   MEMORY(bytes)
# myapp-pod   950m         1.8Gi
# åˆ†æ: å®é™…åªç”¨1æ ¸å’Œ2GBï¼Œä½†è¯·æ±‚äº†8æ ¸16GB

# 3. è°ƒæ•´ä¸ºåˆç†å€¼
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    resources:
      requests:
        cpu: "1000m"     # âœ… æ ¹æ®å®é™…ä½¿ç”¨+20%ä½™é‡
        memory: "2Gi"    # âœ… æ ¹æ®å®é™…ä½¿ç”¨+20%ä½™é‡
      limits:
        cpu: "2000m"     # âœ… å…è®¸çŸ­æ—¶é—´burst
        memory: "4Gi"    # âœ… é˜²æ­¢å†…å­˜æ³„æ¼
```

#### åœºæ™¯2ï¼šèŠ‚ç‚¹äº²å’Œæ€§ä¸æ»¡è¶³

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: Podå› èŠ‚ç‚¹é€‰æ‹©å™¨æˆ–äº²å’Œæ€§è§„åˆ™æ— æ³•è°ƒåº¦
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æŸ¥çœ‹è°ƒåº¦å¤±è´¥åŸå› 
kubectl describe pod myapp-pod
# Events:
#   Warning  FailedScheduling  1m  0/3 nodes are available: 
#                                  3 node(s) didn't match node selector.

# 2. æŸ¥çœ‹Podçš„èŠ‚ç‚¹é€‰æ‹©å™¨
kubectl get pod myapp-pod -o yaml | grep -A 5 "nodeSelector:"
#   nodeSelector:
#     disktype: ssd
#     zone: us-west-1a

# 3. æ£€æŸ¥é›†ç¾¤ä¸­æ˜¯å¦æœ‰åŒ¹é…çš„èŠ‚ç‚¹
kubectl get nodes --show-labels | grep "disktype=ssd"
# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜æ²¡æœ‰èŠ‚ç‚¹æœ‰disktype=ssdæ ‡ç­¾

# 4. æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹çš„æ ‡ç­¾
kubectl get nodes --show-labels

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ç»™èŠ‚ç‚¹æ·»åŠ æ‰€éœ€æ ‡ç­¾
kubectl label nodes node-1 disktype=ssd zone=us-west-1a

# æ–¹æ¡ˆB: ä¿®æ”¹Podçš„èŠ‚ç‚¹é€‰æ‹©å™¨ï¼ˆå¦‚æœéœ€æ±‚ä¸ä¸¥æ ¼ï¼‰
kubectl delete pod myapp-pod
# ä¿®æ”¹YAMLåé‡æ–°åˆ›å»º

# æ–¹æ¡ˆC: ä½¿ç”¨èŠ‚ç‚¹äº²å’Œæ€§ä»£æ›¿ç¡¬æ€§é€‰æ‹©å™¨
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:  # è½¯äº²å’Œæ€§
      - weight: 100
        preference:
          matchExpressions:
          - key: disktype
            operator: In
            values:
            - ssd
  containers:
  - name: myapp
    image: myapp:v1.0
```

#### åœºæ™¯3ï¼šæ±¡ç‚¹å’Œå®¹å¿åº¦é—®é¢˜

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: Podæ— æ³•è°ƒåº¦åˆ°æœ‰æ±¡ç‚¹çš„èŠ‚ç‚¹
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æŸ¥çœ‹è°ƒåº¦å¤±è´¥åŸå› 
kubectl describe pod myapp-pod
# Events:
#   Warning  FailedScheduling  30s  0/3 nodes are available: 
#                                   3 node(s) had taint {dedicated=gpu}, 
#                                   that the pod didn't tolerate.

# 2. æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹
kubectl describe node node-1 | grep Taints
# Taints:  dedicated=gpu:NoSchedule

# 3. æŸ¥çœ‹Podçš„å®¹å¿åº¦é…ç½®
kubectl get pod myapp-pod -o yaml | grep -A 5 "tolerations:"
# å¦‚æœæ²¡æœ‰tolerationså­—æ®µï¼ŒPodæ— æ³•å®¹å¿ä»»ä½•æ±¡ç‚¹

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ç»™Podæ·»åŠ å®¹å¿åº¦
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  tolerations:
  - key: "dedicated"
    operator: "Equal"
    value: "gpu"
    effect: "NoSchedule"
  containers:
  - name: myapp
    image: myapp:v1.0

# æ–¹æ¡ˆB: ç§»é™¤èŠ‚ç‚¹æ±¡ç‚¹
kubectl taint nodes node-1 dedicated=gpu:NoSchedule-

# æ–¹æ¡ˆC: ä¿®æ”¹æ±¡ç‚¹æ•ˆæœï¼ˆå¦‚æœåªæ˜¯è­¦å‘Šï¼‰
kubectl taint nodes node-1 dedicated=gpu:NoSchedule- 
kubectl taint nodes node-1 dedicated=gpu:PreferNoSchedule
# PreferNoSchedule: å°½é‡é¿å…è°ƒåº¦ï¼Œä½†ä¸æ˜¯å¼ºåˆ¶
```

#### åœºæ™¯4ï¼šå­˜å‚¨å·æŒ‚è½½å¤±è´¥

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: Pod Pendingï¼Œäº‹ä»¶æ˜¾ç¤ºVolumeæŒ‚è½½é—®é¢˜
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æŸ¥çœ‹PodçŠ¶æ€
kubectl describe pod myapp-pod
# Events:
#   Warning  FailedMount  2m  MountVolume.SetUp failed: 
#                            rpc error: code = NotFound 
#                            desc = volume "pvc-123456" not found

# 2. æ£€æŸ¥PVCçŠ¶æ€
kubectl get pvc myapp-pvc
# NAME        STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS
# myapp-pvc   Pending   -        -          -              fast-ssd

# 3. æŸ¥çœ‹PVCè¯¦ç»†ä¿¡æ¯
kubectl describe pvc myapp-pvc
# Events:
#   Warning  ProvisioningFailed  1m  Failed to provision volume: 
#                                    storageclass.storage.k8s.io "fast-ssd" not found

# 4. æ£€æŸ¥StorageClassæ˜¯å¦å­˜åœ¨
kubectl get storageclass
# NAME                 PROVISIONER
# standard (default)   kubernetes.io/gce-pd
# slow                 kubernetes.io/gce-pd

# é—®é¢˜: StorageClass "fast-ssd" ä¸å­˜åœ¨

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: åˆ›å»ºç¼ºå¤±çš„StorageClass
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast-ssd
provisioner: kubernetes.io/gce-pd
parameters:
  type: pd-ssd
  replication-type: regional-pd

# æ–¹æ¡ˆB: ä¿®æ”¹PVCä½¿ç”¨å·²å­˜åœ¨çš„StorageClass
kubectl edit pvc myapp-pvc
# ä¿®æ”¹ storageClassName: standard

# æ–¹æ¡ˆC: æ‰‹åŠ¨åˆ›å»ºPVå¹¶ç»‘å®šPVCï¼ˆé™æ€ä¾›ç»™ï¼‰
apiVersion: v1
kind: PersistentVolume
metadata:
  name: myapp-pv
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: fast-ssd
  hostPath:
    path: /mnt/data
```

### 11.2.3 CrashLoopBackOffæ’æŸ¥

CrashLoopBackOffè¡¨ç¤ºå®¹å™¨åå¤å´©æºƒé‡å¯ï¼Œè¿™æ˜¯æœ€å¸¸è§ä¹Ÿæœ€éœ€è¦æ·±å…¥æ’æŸ¥çš„é—®é¢˜ã€‚

#### é€€é¿æœºåˆ¶è§£é‡Š

```yaml
CrashLoopBackOffé€€é¿æœºåˆ¶:

å·¥ä½œåŸç†:
  - å®¹å™¨å¯åŠ¨å¤±è´¥åï¼ŒKubernetesä¼šç­‰å¾…ä¸€æ®µæ—¶é—´å†é‡å¯
  - ç­‰å¾…æ—¶é—´å‘ˆæŒ‡æ•°å¢é•¿: 0s, 10s, 20s, 40s, 80s, 160s
  - æœ€å¤§ç­‰å¾…æ—¶é—´: 5åˆ†é’Ÿ (300ç§’)
  - å¦‚æœå®¹å™¨æˆåŠŸè¿è¡Œ10åˆ†é’Ÿï¼Œé‡å¯è®¡æ•°å™¨æ¸…é›¶

çŠ¶æ€è½¬æ¢:
  Running â†’ Terminated (Exit Code != 0) 
  â†’ Waiting (CrashLoopBackOff) 
  â†’ Running â†’ ...

é‡å¯æ¬¡æ•°:
  - RESTARTSåˆ—æ˜¾ç¤ºå®¹å™¨é‡å¯æ¬¡æ•°
  - æ¬¡æ•°è¶Šé«˜ï¼Œè¯´æ˜é—®é¢˜æŒç»­æ—¶é—´è¶Šé•¿
```

#### æ’æŸ¥æ­¥éª¤

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 1. åŸºç¡€ä¿¡æ¯æ”¶é›†
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹PodçŠ¶æ€
kubectl get pod myapp-pod
# NAME        READY   STATUS             RESTARTS   AGE
# myapp-pod   0/1     CrashLoopBackOff   5          10m

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
kubectl describe pod myapp-pod

# é‡ç‚¹å…³æ³¨:
# - Last State: Terminated (æŸ¥çœ‹é€€å‡ºç å’ŒåŸå› )
# - Exit Code: é0è¡¨ç¤ºå¼‚å¸¸é€€å‡º
# - Reason: ç»ˆæ­¢åŸå› 
# - Events: æœ€è¿‘çš„äº‹ä»¶

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 2. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹å½“å‰æ—¥å¿—
kubectl logs myapp-pod

# âš ï¸ é‡è¦: æŸ¥çœ‹ä¸Šæ¬¡å´©æºƒçš„æ—¥å¿—
kubectl logs myapp-pod --previous
# è¿™æ˜¯æœ€é‡è¦çš„å‘½ä»¤ï¼Œèƒ½çœ‹åˆ°å´©æºƒå‰çš„æ—¥å¿—

# å¤šå®¹å™¨PodæŒ‡å®šå®¹å™¨
kubectl logs myapp-pod -c myapp --previous

# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶åˆ†æ
kubectl logs myapp-pod --previous > crash-log.txt

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 3. åˆ†æé€€å‡ºç 
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

kubectl get pod myapp-pod -o jsonpath='{.status.containerStatuses[0].lastState.terminated.exitCode}'

# å¸¸è§é€€å‡ºç :
#   0:   æ­£å¸¸é€€å‡ºï¼ˆä¸åº”è¯¥å¯¼è‡´CrashLoopï¼‰
#   1:   åº”ç”¨é”™è¯¯ï¼ˆä»£ç å¼‚å¸¸ã€é…ç½®é”™è¯¯ç­‰ï¼‰
#   2:   è¯¯ç”¨shellå‘½ä»¤
#   126: å‘½ä»¤æ— æ³•æ‰§è¡Œ
#   127: å‘½ä»¤æœªæ‰¾åˆ°
#   130: é€šè¿‡Ctrl+Cç»ˆæ­¢
#   137: SIGKILLï¼ˆå¯èƒ½æ˜¯OOMï¼‰
#   143: SIGTERMï¼ˆæ­£å¸¸ç»ˆæ­¢ä¿¡å·ï¼‰
#   255: é€€å‡ºçŠ¶æ€ç è¶…å‡ºèŒƒå›´
```

#### å¸¸è§åŸå› åˆ†æ

**åŸå› 1: åº”ç”¨é…ç½®é”™è¯¯**

```bash
# ç—‡çŠ¶
kubectl logs myapp-pod --previous
# è¾“å‡º:
# Error: Failed to load config file /etc/app/config.yaml: 
# no such file or directory
# Exiting...

# è¯Šæ–­
kubectl describe pod myapp-pod | grep -A 10 "Mounts:"
# æ£€æŸ¥ConfigMapæ˜¯å¦æ­£ç¡®æŒ‚è½½

kubectl get configmap app-config -o yaml
# æ£€æŸ¥ConfigMapå†…å®¹æ˜¯å¦æ­£ç¡®

# è§£å†³æ–¹æ¡ˆ
# 1. ç¡®ä¿ConfigMapå­˜åœ¨
kubectl create configmap app-config --from-file=config.yaml

# 2. ç¡®ä¿Podæ­£ç¡®å¼•ç”¨
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    volumeMounts:
    - name: config
      mountPath: /etc/app
  volumes:
  - name: config
    configMap:
      name: app-config
```

**åŸå› 2: ç¯å¢ƒå˜é‡ç¼ºå¤±**

```bash
# ç—‡çŠ¶
kubectl logs myapp-pod --previous
# è¾“å‡º:
# panic: Environment variable DB_PASSWORD is required
# goroutine 1 [running]:
# main.main()

# è¯Šæ–­
kubectl get pod myapp-pod -o yaml | grep -A 20 "env:"
# æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®

# è§£å†³æ–¹æ¡ˆ
# 1. åˆ›å»ºSecret
kubectl create secret generic db-secret   --from-literal=password=mypassword

# 2. åœ¨Podä¸­å¼•ç”¨
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    env:
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: db-secret
          key: password
```

**åŸå› 3: åº”ç”¨ä¾èµ–æœåŠ¡ä¸å¯ç”¨**

```bash
# ç—‡çŠ¶
kubectl logs myapp-pod --previous
# è¾“å‡º:
# Connecting to database mysql://db.default.svc.cluster.local:3306
# Error: dial tcp: lookup db.default.svc.cluster.local: 
# no such host
# Retrying in 5s...
# (5æ¬¡é‡è¯•å)
# Failed to connect to database after 5 attempts, exiting...

# è¯Šæ–­
# 1. æ£€æŸ¥ä¾èµ–çš„Serviceæ˜¯å¦å­˜åœ¨
kubectl get svc db
# å¦‚æœä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆéƒ¨ç½²æ•°æ®åº“

# 2. æµ‹è¯•DNSè§£æ
kubectl run test --image=busybox:1.36 -it --rm --   nslookup db.default.svc.cluster.local

# 3. æµ‹è¯•è¿æ¥
kubectl run test --image=mysql:8.0 -it --rm --   mysql -h db.default.svc.cluster.local -u root -p

# è§£å†³æ–¹æ¡ˆA: å…ˆéƒ¨ç½²ä¾èµ–æœåŠ¡
kubectl apply -f mysql-deployment.yaml

# è§£å†³æ–¹æ¡ˆB: ä½¿ç”¨Initå®¹å™¨ç­‰å¾…ä¾èµ–å°±ç»ª
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  initContainers:
  - name: wait-for-db
    image: busybox:1.36
    command:
    - 'sh'
    - '-c'
    - |
      until nslookup db.default.svc.cluster.local; do
        echo "Waiting for db service..."
        sleep 2
      done
  containers:
  - name: myapp
    image: myapp:v1.0

# è§£å†³æ–¹æ¡ˆC: åº”ç”¨å±‚å®ç°é‡è¯•å’Œä¼˜é›…é™çº§
# ä¿®æ”¹åº”ç”¨ä»£ç ï¼Œå¯åŠ¨æ—¶å¤±è´¥ä¸é€€å‡ºï¼ŒæŒç»­é‡è¯•è¿æ¥
```

**åŸå› 4: å¯åŠ¨å‘½ä»¤é”™è¯¯**

```bash
# ç—‡çŠ¶
kubectl logs myapp-pod --previous
# è¾“å‡º:
# /bin/sh: /app/start.sh: not found

# è¯Šæ–­
kubectl get pod myapp-pod -o yaml | grep -A 5 "command:"
#     command:
#     - /app/start.sh

# è¿›å…¥æ­£å¸¸è¿è¡Œçš„åŒç‰ˆæœ¬å®¹å™¨æ£€æŸ¥
kubectl run debug --image=myapp:v1.0 -it --rm -- /bin/sh
ls -la /app/
# å‘ç°æ²¡æœ‰start.shï¼Œå®é™…å¯åŠ¨è„šæœ¬æ˜¯ /app/run.sh

# è§£å†³æ–¹æ¡ˆ
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    command: ["/app/run.sh"]  # âœ… ä½¿ç”¨æ­£ç¡®çš„å‘½ä»¤
```

**åŸå› 5: æƒé™é—®é¢˜**

```bash
# ç—‡çŠ¶
kubectl logs myapp-pod --previous
# è¾“å‡º:
# mkdir: cannot create directory '/var/log/app': Permission denied
# Failed to initialize logging, exiting...

# è¯Šæ–­
kubectl get pod myapp-pod -o yaml | grep -A 10 "securityContext:"
#   securityContext:
#     runAsNonRoot: true
#     runAsUser: 1000

# é—®é¢˜: /var/log/appç›®å½•å±äºrootï¼Œç”¨æˆ·1000æ— å†™æƒé™

# è§£å†³æ–¹æ¡ˆA: ä¿®æ”¹åº”ç”¨å†™å…¥å…¶ä»–ç›®å½•
# åº”ç”¨é…ç½®æ”¹ä¸ºå†™ /tmp/app.log ï¼ˆæ‰€æœ‰ç”¨æˆ·å¯å†™ï¼‰

# è§£å†³æ–¹æ¡ˆB: æŒ‚è½½å¯å†™çš„Volume
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  securityContext:
    fsGroup: 1000  # è®¾ç½®Volumeçš„ç»„ID
  containers:
  - name: myapp
    image: myapp:v1.0
    securityContext:
      runAsUser: 1000
    volumeMounts:
    - name: logs
      mountPath: /var/log/app
  volumes:
  - name: logs
    emptyDir: {}

# è§£å†³æ–¹æ¡ˆC: ä»¥rootè¿è¡Œï¼ˆä¸æ¨èï¼‰
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    securityContext:
      runAsUser: 0  # rootç”¨æˆ·
```

#### é«˜çº§è°ƒè¯•æŠ€å·§

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æŠ€å·§1: ä¿®æ”¹å¯åŠ¨å‘½ä»¤ï¼Œè®©å®¹å™¨ä¿æŒè¿è¡Œ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ä½¿ç”¨kubectl debugå¤åˆ¶Podå¹¶ä¿®æ”¹å‘½ä»¤
kubectl debug myapp-pod -it --copy-to=debug-pod   --container=myapp -- /bin/sleep 3600

# åœ¨debug-podä¸­æ‰‹åŠ¨è¿è¡Œåº”ç”¨
kubectl exec -it debug-pod -- /bin/bash
# æ‰‹åŠ¨æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼Œè§‚å¯Ÿé”™è¯¯
/app/start.sh

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æŠ€å·§2: å¢åŠ æ—¥å¿—è¯¦ç»†ç¨‹åº¦
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ä¿®æ”¹åº”ç”¨ç¯å¢ƒå˜é‡ï¼Œå¯ç”¨è°ƒè¯•æ—¥å¿—
kubectl set env deployment/myapp LOG_LEVEL=debug

# æˆ–ä¿®æ”¹Podå®šä¹‰
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    env:
    - name: LOG_LEVEL
      value: "debug"
    - name: VERBOSE
      value: "true"

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æŠ€å·§3: ç¦ç”¨å¥åº·æ£€æŸ¥ï¼ˆä¸´æ—¶è°ƒè¯•ï¼‰
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# å¦‚æœæ€€ç–‘æ˜¯å¥åº·æ£€æŸ¥å¯¼è‡´çš„é‡å¯
kubectl edit deployment myapp
# æ³¨é‡Šæ‰ livenessProbe å’Œ readinessProbe
# è§‚å¯Ÿå®¹å™¨æ˜¯å¦è¿˜ä¼šå´©æºƒ

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æŠ€å·§4: ä½¿ç”¨straceè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ç»™å®¹å™¨æ·»åŠ SYS_PTRACE capability
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    securityContext:
      capabilities:
        add:
        - SYS_PTRACE

# è¿›å…¥å®¹å™¨ä½¿ç”¨strace
kubectl exec -it myapp-pod -- strace -p 1
# æŸ¥çœ‹è¿›ç¨‹1çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰¾å‡ºå´©æºƒåŸå› 
```

### 11.2.4 ImagePullBackOffæ’æŸ¥

ImagePullBackOffè¡¨ç¤ºé•œåƒæ‹‰å–å¤±è´¥ï¼ŒKubernetesä¼šæŒ‰é€€é¿ç­–ç•¥é‡è¯•ã€‚

#### æ’æŸ¥æµç¨‹

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 1. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

kubectl describe pod myapp-pod
# Events:
#   Warning  Failed     2m    kubelet  Failed to pull image "myapp:v1.0": 
#                             rpc error: code = Unknown 
#                             desc = Error response from daemon: 
#                             pull access denied for myapp, 
#                             repository does not exist or may require 'docker login'

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 2. å¸¸è§é”™è¯¯ç±»å‹
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# é”™è¯¯A: é•œåƒä¸å­˜åœ¨
# Error: manifest for myapp:v1.0 not found

# è¯Šæ–­
docker pull myapp:v1.0
# æˆ–
docker search myapp

# è§£å†³: ä¿®æ­£é•œåƒåç§°å’Œæ ‡ç­¾

# é”™è¯¯B: è®¤è¯å¤±è´¥
# Error: pull access denied

# è¯Šæ–­
kubectl get pod myapp-pod -o yaml | grep imagePullSecrets
# æ£€æŸ¥æ˜¯å¦é…ç½®äº†imagePullSecrets

# è§£å†³: åˆ›å»ºå¹¶ä½¿ç”¨docker-registry Secret

# é”™è¯¯C: ç½‘ç»œé—®é¢˜
# Error: net/http: TLS handshake timeout

# è¯Šæ–­
# åœ¨èŠ‚ç‚¹ä¸Šæµ‹è¯•ç½‘ç»œè¿é€šæ€§
ssh node-1
curl -v https://registry.example.com

# è§£å†³: ä¿®å¤ç½‘ç»œæˆ–ä½¿ç”¨ä»£ç†
```

#### åœºæ™¯1: ç§æœ‰ä»“åº“è®¤è¯å¤±è´¥

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å®Œæ•´è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. åˆ›å»ºdocker-registryç±»å‹çš„Secret
kubectl create secret docker-registry regcred   --docker-server=registry.example.com   --docker-username=myuser   --docker-password=mypassword   --docker-email=myemail@example.com

# 2. éªŒè¯Secretåˆ›å»ºæˆåŠŸ
kubectl get secret regcred
kubectl describe secret regcred

# 3. åœ¨Podä¸­ä½¿ç”¨Secret
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: registry.example.com/myapp:v1.0
  imagePullSecrets:
  - name: regcred  # å¼•ç”¨Secret

# 4. ä¸ºServiceAccounté…ç½®é»˜è®¤imagePullSecrets
kubectl patch serviceaccount default -p   '{"imagePullSecrets":[{"name":"regcred"}]}'

# ä¹‹åä½¿ç”¨default ServiceAccountçš„æ‰€æœ‰Podéƒ½ä¼šè‡ªåŠ¨ä½¿ç”¨è¯¥Secret
```

#### åœºæ™¯2: é•œåƒåç§°æˆ–æ ‡ç­¾é”™è¯¯

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è¯Šæ–­å’Œä¿®å¤
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æŸ¥çœ‹Podé…ç½®çš„é•œåƒ
kubectl get pod myapp-pod -o jsonpath='{.spec.containers[*].image}'
# registry.example.com/myapp:v1.0

# 2. åœ¨èŠ‚ç‚¹ä¸Šå°è¯•æ‹‰å–é•œåƒ
ssh node-1
docker pull registry.example.com/myapp:v1.0
# Error: manifest for registry.example.com/myapp:v1.0 not found

# 3. æ£€æŸ¥é•œåƒä»“åº“ä¸­çš„å¯ç”¨æ ‡ç­¾
# ä½¿ç”¨ä»“åº“APIæˆ–Webç•Œé¢æŸ¥çœ‹

# 4. å‘ç°æ­£ç¡®çš„é•œåƒæ˜¯ v1.0.0 è€Œä¸æ˜¯ v1.0

# 5. ä¿®æ­£é•œåƒæ ‡ç­¾
kubectl set image deployment/myapp myapp=registry.example.com/myapp:v1.0.0

# æˆ–ä½¿ç”¨kubectl edit
kubectl edit deployment myapp
# ä¿®æ”¹ image: registry.example.com/myapp:v1.0.0
```

#### åœºæ™¯3: é•œåƒæ‹‰å–è¶…æ—¶

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: å¤§é•œåƒæ‹‰å–è¶…æ—¶
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

kubectl describe pod myapp-pod
# Events:
#   Warning  Failed  5m  kubelet  Failed to pull image: 
#                        context deadline exceeded

# åŸå› åˆ†æ:
# - é•œåƒè¿‡å¤§ (>5GB)
# - ç½‘ç»œå¸¦å®½é™åˆ¶
# - æ‹‰å–è¶…æ—¶è®¾ç½®å¤ªçŸ­

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ä¼˜åŒ–é•œåƒå¤§å°
# ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼Œç§»é™¤ä¸å¿…è¦çš„æ–‡ä»¶
FROM golang:1.21 AS builder
WORKDIR /app
COPY . .
RUN go build -o myapp

FROM alpine:3.18
COPY --from=builder /app/myapp /usr/local/bin/
CMD ["myapp"]

# æ–¹æ¡ˆB: å¢åŠ kubeleté•œåƒæ‹‰å–è¶…æ—¶
# åœ¨èŠ‚ç‚¹ä¸Šä¿®æ”¹kubeleté…ç½®
ssh node-1
sudo vi /var/lib/kubelet/config.yaml
# æ·»åŠ :
imageGCHighThresholdPercent: 85
imageGCLowThresholdPercent: 80
imageMinimumGCAge: 2m

# é‡å¯kubelet
sudo systemctl restart kubelet

# æ–¹æ¡ˆC: ä½¿ç”¨é•œåƒç¼“å­˜
# æå‰åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‹‰å–é•œåƒ
for node in $(kubectl get nodes -o name); do
  ssh $node docker pull registry.example.com/myapp:v1.0
done

# æ–¹æ¡ˆD: ä½¿ç”¨é•œåƒé¢„çƒ­DaemonSet
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: image-puller
spec:
  selector:
    matchLabels:
      name: image-puller
  template:
    metadata:
      labels:
        name: image-puller
    spec:
      initContainers:
      - name: pull-image
        image: registry.example.com/myapp:v1.0
        command: ['sh', '-c', 'echo Image pulled']
      containers:
      - name: pause
        image: k8s.gcr.io/pause:3.9
```

#### åœºæ™¯4: é•œåƒä»“åº“ç½‘ç»œé—®é¢˜

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è¯Šæ–­ç½‘ç»œè¿é€šæ€§
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. åœ¨èŠ‚ç‚¹ä¸Šæµ‹è¯•è¿æ¥
ssh node-1
curl -v https://registry.example.com/v2/
# æ£€æŸ¥æ˜¯å¦èƒ½è®¿é—®é•œåƒä»“åº“

# 2. æµ‹è¯•DNSè§£æ
nslookup registry.example.com

# 3. æµ‹è¯•TLSæ¡æ‰‹
openssl s_client -connect registry.example.com:443

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: é…ç½®HTTPä»£ç†
# ä¿®æ”¹containerdé…ç½®
ssh node-1
sudo vi /etc/systemd/system/containerd.service.d/http-proxy.conf
# æ·»åŠ :
[Service]
Environment="HTTP_PROXY=http://proxy.example.com:3128"
Environment="HTTPS_PROXY=http://proxy.example.com:3128"
Environment="NO_PROXY=localhost,127.0.0.1,.cluster.local"

sudo systemctl daemon-reload
sudo systemctl restart containerd

# æ–¹æ¡ˆB: é…ç½®é•œåƒä»“åº“é•œåƒ
# ä¿®æ”¹containerdé…ç½®
sudo vi /etc/containerd/config.toml
# æ·»åŠ :
[plugins."io.containerd.grpc.v1.cri".registry.mirrors]
  [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]
    endpoint = ["https://mirror.example.com"]

sudo systemctl restart containerd

# æ–¹æ¡ˆC: ä½¿ç”¨Insecure Registry (ä»…æµ‹è¯•ç¯å¢ƒ)
sudo vi /etc/containerd/config.toml
# æ·»åŠ :
[plugins."io.containerd.grpc.v1.cri".registry.configs."registry.example.com".tls]
  insecure_skip_verify = true

sudo systemctl restart containerd
```



### 11.2.5 OOMKilledé—®é¢˜æ’æŸ¥

OOMKilled (Out Of Memory Killed) æ˜¯å®¹å™¨å› å†…å­˜ä¸è¶³è¢«ç³»ç»Ÿæ€æ­»çš„æƒ…å†µã€‚

#### è¯†åˆ«OOMKilled

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 1. è¯†åˆ«OOMKilledçŠ¶æ€
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹PodçŠ¶æ€
kubectl get pod myapp-pod
# NAME        READY   STATUS      RESTARTS   AGE
# myapp-pod   0/1     OOMKilled   3          5m

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
kubectl describe pod myapp-pod
# Last State:     Terminated
#   Reason:       OOMKilled
#   Exit Code:    137
#   Started:      Mon, 08 Feb 2024 10:00:00 +0800
#   Finished:     Mon, 08 Feb 2024 10:00:30 +0800

# é€€å‡ºç 137 = 128 + 9 (SIGKILL)

# æŸ¥çœ‹å®¹å™¨ç»ˆæ­¢åŸå› 
kubectl get pod myapp-pod -o jsonpath='{.status.containerStatuses[0].lastState.terminated.reason}'
# OOMKilled

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 2. åˆ†æå†…å­˜ä½¿ç”¨
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹Podçš„å†…å­˜é™åˆ¶
kubectl get pod myapp-pod -o yaml | grep -A 5 "resources:"
#     resources:
#       limits:
#         memory: "512Mi"
#       requests:
#         memory: "256Mi"

# æŸ¥çœ‹å®é™…å†…å­˜ä½¿ç”¨ï¼ˆå¦‚æœPodè¿˜åœ¨è¿è¡Œï¼‰
kubectl top pod myapp-pod
# NAME        CPU(cores)   MEMORY(bytes)
# myapp-pod   100m         510Mi
# åˆ†æ: ä½¿ç”¨510Miï¼Œæ¥è¿‘512Mié™åˆ¶

# æŸ¥çœ‹èŠ‚ç‚¹å†…å­˜å‹åŠ›
kubectl describe node node-1 | grep -A 10 "Allocated resources"
kubectl describe node node-1 | grep -i "memory pressure"

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 3. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# åœ¨èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹OOMäº‹ä»¶
ssh node-1
dmesg | grep -i "out of memory"
# æˆ–
journalctl -k | grep -i "oom"

# è¾“å‡ºç¤ºä¾‹:
# [12345.678] Memory cgroup out of memory: Killed process 12345 (java) 
# total-vm:2097152kB, anon-rss:524288kB, file-rss:0kB
```

#### å¸¸è§OOMåŸå› 

**åŸå› 1: å†…å­˜é™åˆ¶è®¾ç½®è¿‡ä½**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# åœºæ™¯: åº”ç”¨å®é™…éœ€è¦1GBå†…å­˜ï¼Œä½†é™åˆ¶è®¾ç½®ä¸º512MB
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. ç›‘æ§åº”ç”¨å®é™…å†…å­˜ä½¿ç”¨
# åœ¨å®¹å™¨å†…æŸ¥çœ‹å†…å­˜ä½¿ç”¨
kubectl exec myapp-pod -- ps aux
kubectl exec myapp-pod -- free -h

# 2. æŸ¥çœ‹Prometheus metricsï¼ˆå¦‚æœæœ‰ï¼‰
# container_memory_usage_bytes
# container_memory_working_set_bytes

# 3. è°ƒæ•´å†…å­˜é™åˆ¶
kubectl set resources deployment myapp   --limits=memory=1Gi   --requests=memory=512Mi

# æˆ–ç¼–è¾‘YAML
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    resources:
      requests:
        memory: "512Mi"    # ä¿è¯åˆ†é…
      limits:
        memory: "1Gi"      # å…è®¸ä½¿ç”¨ä¸Šé™
```

**åŸå› 2: å†…å­˜æ³„æ¼**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# åœºæ™¯: åº”ç”¨å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œå†…å­˜ä½¿ç”¨æŒç»­å¢é•¿
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. ç›‘æ§å†…å­˜å¢é•¿è¶‹åŠ¿
# ä½¿ç”¨PrometheusæŸ¥è¯¢
# rate(container_memory_usage_bytes[5m])

# 2. Javaåº”ç”¨å†…å­˜åˆ†æ
# ç”Ÿæˆå †è½¬å‚¨
kubectl exec myapp-pod --   jmap -dump:format=b,file=/tmp/heap.hprof 1

# å¤åˆ¶å †è½¬å‚¨åˆ°æœ¬åœ°
kubectl cp myapp-pod:/tmp/heap.hprof ./heap.hprof

# ä½¿ç”¨MAT (Memory Analyzer Tool) æˆ– VisualVM åˆ†æ

# 3. Goåº”ç”¨å†…å­˜åˆ†æ
# å¯ç”¨pprof
kubectl port-forward myapp-pod 6060:6060

# è·å–å†…å­˜profile
go tool pprof http://localhost:6060/debug/pprof/heap

# 4. Pythonåº”ç”¨å†…å­˜åˆ†æ
# ä½¿ç”¨memory_profileræˆ–tracemalloc

# 5. Node.jsåº”ç”¨å†…å­˜åˆ†æ
kubectl exec myapp-pod --   node --inspect --max-old-space-size=4096 app.js
```

**åŸå› 3: å³°å€¼å†…å­˜ä½¿ç”¨**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# åœºæ™¯: æ‰¹å¤„ç†ä»»åŠ¡å¯¼è‡´å†…å­˜å³°å€¼
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. è¯†åˆ«å†…å­˜å³°å€¼åœºæ™¯
# - å¤§æ–‡ä»¶å¤„ç†
# - æ‰¹é‡æ•°æ®åŠ è½½
# - ç¼“å­˜é¢„çƒ­
# - å®šæ—¶ä»»åŠ¡æ‰§è¡Œ

# 2. ä¸´æ—¶æ–¹æ¡ˆ: å¢åŠ å†…å­˜é™åˆ¶
kubectl set resources deployment myapp   --limits=memory=2Gi

# 3. æ°¸ä¹…æ–¹æ¡ˆ: ä¼˜åŒ–åº”ç”¨
# - æµå¼å¤„ç†æ›¿ä»£ä¸€æ¬¡æ€§åŠ è½½
# - åˆ†æ‰¹å¤„ç†å¤§æ•°æ®é›†
# - é™åˆ¶ç¼“å­˜å¤§å°
# - ä¼˜åŒ–ç®—æ³•å‡å°‘å†…å­˜ä½¿ç”¨

# ç¤ºä¾‹: Javaæ‰¹å¤„ç†ä¼˜åŒ–
# âŒ ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
List<Data> allData = repository.findAll(); // OOMé£é™©
processData(allData);

# âœ… æµå¼å¤„ç†
repository.findAll().stream()
  .forEach(data -> processData(data));

# âœ… åˆ†é¡µå¤„ç†
int pageSize = 1000;
Page<Data> page = repository.findAll(PageRequest.of(0, pageSize));
while (page.hasContent()) {
  processData(page.getContent());
  page = repository.findAll(page.nextPageable());
}
```

**åŸå› 4: JVMå †å¤§å°é…ç½®ä¸å½“**

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Javaåº”ç”¨ç‰¹æ®Šå¤„ç†
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# é—®é¢˜: å®¹å™¨å†…å­˜é™åˆ¶1GBï¼Œä½†JVMé»˜è®¤ä½¿ç”¨ç‰©ç†å†…å­˜çš„1/4

# âŒ é”™è¯¯é…ç½®
apiVersion: v1
kind: Pod
metadata:
  name: java-app
spec:
  containers:
  - name: java-app
    image: openjdk:11
    resources:
      limits:
        memory: "1Gi"
    # JVMå¯èƒ½å°è¯•ä½¿ç”¨è¶…è¿‡1GBå†…å­˜ï¼Œå¯¼è‡´OOM

# âœ… æ­£ç¡®é…ç½®
apiVersion: v1
kind: Pod
metadata:
  name: java-app
spec:
  containers:
  - name: java-app
    image: openjdk:11
    env:
    - name: JAVA_OPTS
      value: "-Xms512m -Xmx768m -XX:MaxMetaspaceSize=128m"
    resources:
      requests:
        memory: "512Mi"
      limits:
        memory: "1Gi"

# è®¡ç®—å…¬å¼:
# å®¹å™¨å†…å­˜é™åˆ¶ >= Xmx + MaxMetaspaceSize + å…¶ä»–å¼€é”€(~200MB)
# 1GB >= 768MB + 128MB + 200MB âœ…

# âœ… ä½¿ç”¨å®¹å™¨æ„ŸçŸ¥JVMå‚æ•° (Java 10+)
apiVersion: v1
kind: Pod
metadata:
  name: java-app
spec:
  containers:
  - name: java-app
    image: openjdk:17
    env:
    - name: JAVA_OPTS
      value: >-
        -XX:InitialRAMPercentage=50.0
        -XX:MaxRAMPercentage=75.0
        -XX:+UseContainerSupport
    resources:
      limits:
        memory: "1Gi"
# JVMä¼šè‡ªåŠ¨æ ¹æ®å®¹å™¨é™åˆ¶è°ƒæ•´å †å¤§å°
```

#### OOMé¢„é˜²æªæ–½

```yaml
OOMé¢„é˜²æœ€ä½³å®è·µ:

1. åˆç†è®¾ç½®èµ„æºé™åˆ¶:
   åŸåˆ™:
     - requests: åº”ç”¨æ­£å¸¸è¿è¡Œæ‰€éœ€å†…å­˜
     - limits: requestsçš„1.5-2å€ï¼Œå…è®¸å³°å€¼
   
   ç¤ºä¾‹:
     requests:
       memory: "1Gi"     # æ­£å¸¸è¿è¡Œéœ€è¦
     limits:
       memory: "1.5Gi"   # å…è®¸50%å³°å€¼

2. å¯ç”¨å†…å­˜é™åˆ¶:
   å§‹ç»ˆè®¾ç½®memory limitsï¼Œé˜²æ­¢å½±å“å…¶ä»–Pod
   
   âŒ ä¸è®¾ç½®limits
   resources:
     requests:
       memory: "1Gi"
   # å¯èƒ½æ— é™åˆ¶ä½¿ç”¨å†…å­˜
   
   âœ… è®¾ç½®åˆç†limits
   resources:
     requests:
       memory: "1Gi"
     limits:
       memory: "2Gi"

3. ç›‘æ§å’Œå‘Šè­¦:
   - è®¾ç½®å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦ (>80%)
   - ç›‘æ§OOMäº‹ä»¶
   - è·Ÿè¸ªå†…å­˜å¢é•¿è¶‹åŠ¿
   
   Prometheuså‘Šè­¦è§„åˆ™:
   - alert: PodMemoryUsageHigh
     expr: >
       container_memory_usage_bytes / 
       container_spec_memory_limit_bytes > 0.8
     for: 5m
     annotations:
       summary: "Pod {{ $labels.pod }} memory usage > 80%"

4. åº”ç”¨ä¼˜åŒ–:
   - é¿å…å†…å­˜æ³„æ¼
   - é™åˆ¶ç¼“å­˜å¤§å°
   - ä½¿ç”¨æµå¼å¤„ç†
   - åŠæ—¶é‡Šæ”¾èµ„æº
   - å®šæœŸè¿›è¡Œå†…å­˜åˆ†æ

5. Javaåº”ç”¨ç‰¹æ®Šé…ç½®:
   - è®¾ç½®æ˜ç¡®çš„å †å¤§å°
   - ä½¿ç”¨å®¹å™¨æ„ŸçŸ¥å‚æ•°
   - ç›‘æ§GCæ´»åŠ¨
   - è€ƒè™‘ä½¿ç”¨ä½å»¶è¿ŸGC (ZGC/Shenandoah)
```

### 11.2.6 Initå®¹å™¨å¤±è´¥æ’æŸ¥

Initå®¹å™¨å¿…é¡»åœ¨ä¸»å®¹å™¨å¯åŠ¨å‰æˆåŠŸå®Œæˆï¼Œå¤±è´¥ä¼šå¯¼è‡´Podæ— æ³•å¯åŠ¨ã€‚

#### Initå®¹å™¨å·¥ä½œæœºåˆ¶

```yaml
Initå®¹å™¨ç‰¹ç‚¹:

1. æ‰§è¡Œé¡ºåº:
   - Initå®¹å™¨æŒ‰é¡ºåºæ‰§è¡Œ
   - å‰ä¸€ä¸ªæˆåŠŸåï¼Œä¸‹ä¸€ä¸ªæ‰èƒ½å¼€å§‹
   - æ‰€æœ‰Initå®¹å™¨æˆåŠŸåï¼Œä¸»å®¹å™¨æ‰å¯åŠ¨

2. é‡å¯è¡Œä¸º:
   - Initå®¹å™¨å¤±è´¥ï¼ŒPodä¼šé‡å¯
   - éµå¾ªPodçš„restartPolicy
   - å¤±è´¥ä¼šè¿›å…¥CrashLoopBackOff

3. èµ„æºå…±äº«:
   - ä¸ä¸»å®¹å™¨å…±äº«Volume
   - å…±äº«ç½‘ç»œå‘½åç©ºé—´
   - ä¸å…±äº«æ–‡ä»¶ç³»ç»Ÿ

4. ä½¿ç”¨åœºæ™¯:
   - ç­‰å¾…ä¾èµ–æœåŠ¡å°±ç»ª
   - ä¸‹è½½é…ç½®æˆ–æ•°æ®
   - è®¾ç½®æƒé™æˆ–åˆå§‹åŒ–ç¯å¢ƒ
   - æ•°æ®åº“è¿ç§»
```

#### æ’æŸ¥æ–¹æ³•

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 1. è¯†åˆ«Initå®¹å™¨å¤±è´¥
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹PodçŠ¶æ€
kubectl get pod myapp-pod
# NAME        READY   STATUS     RESTARTS   AGE
# myapp-pod   0/1     Init:0/2   0          5m

# çŠ¶æ€è§£é‡Š:
# Init:0/2 è¡¨ç¤ºæœ‰2ä¸ªInitå®¹å™¨ï¼Œå½“å‰ç¬¬1ä¸ªæ‰§è¡Œä¸­/å¤±è´¥
# Init:1/2 è¡¨ç¤ºç¬¬1ä¸ªæˆåŠŸï¼Œç¬¬2ä¸ªæ‰§è¡Œä¸­
# Init:Error è¡¨ç¤ºInitå®¹å™¨æ‰§è¡Œé”™è¯¯
# Init:CrashLoopBackOff è¡¨ç¤ºInitå®¹å™¨åå¤å¤±è´¥

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
kubectl describe pod myapp-pod
# Init Containers:
#   init-db:
#     Container ID:  containerd://abc123
#     State:         Terminated
#       Reason:      Error
#       Exit Code:   1

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 2. æŸ¥çœ‹Initå®¹å™¨æ—¥å¿—
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æŸ¥çœ‹ç‰¹å®šInitå®¹å™¨çš„æ—¥å¿—
kubectl logs myapp-pod -c init-db

# å¦‚æœInitå®¹å™¨å·²é‡å¯ï¼ŒæŸ¥çœ‹ä¸Šæ¬¡æ—¥å¿—
kubectl logs myapp-pod -c init-db --previous

# æŸ¥çœ‹æ‰€æœ‰Initå®¹å™¨çš„æ—¥å¿—
for container in $(kubectl get pod myapp-pod -o jsonpath='{.spec.initContainers[*].name}'); do
  echo "=== Init Container: $container ==="
  kubectl logs myapp-pod -c $container
done

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 3. è¿›å…¥Initå®¹å™¨è°ƒè¯•ï¼ˆå¦‚æœè¿˜åœ¨è¿è¡Œï¼‰
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è¿›å…¥Initå®¹å™¨
kubectl exec -it myapp-pod -c init-db -- /bin/sh

# æ‰‹åŠ¨æ‰§è¡ŒInitå®¹å™¨çš„å‘½ä»¤
/scripts/init-db.sh
```

#### å¸¸è§Initå®¹å™¨é—®é¢˜

**åœºæ™¯1: ç­‰å¾…ä¾èµ–æœåŠ¡è¶…æ—¶**

```yaml
# âŒ é—®é¢˜é…ç½®ï¼šæ— è¶…æ—¶é™åˆ¶ï¼Œå¯èƒ½æ— é™ç­‰å¾…
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  initContainers:
  - name: wait-for-db
    image: busybox:1.36
    command:
    - 'sh'
    - '-c'
    - |
      until nslookup mysql.default.svc.cluster.local; do
        echo "Waiting for mysql..."
        sleep 2
      done
  containers:
  - name: myapp
    image: myapp:v1.0

# âœ… æ”¹è¿›é…ç½®ï¼šæ·»åŠ è¶…æ—¶å’Œé‡è¯•æ¬¡æ•°
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  initContainers:
  - name: wait-for-db
    image: busybox:1.36
    command:
    - 'sh'
    - '-c'
    - |
      MAX_RETRIES=30
      RETRY_COUNT=0
      until nslookup mysql.default.svc.cluster.local || [ $RETRY_COUNT -eq $MAX_RETRIES ]; do
        echo "Waiting for mysql... ($RETRY_COUNT/$MAX_RETRIES)"
        RETRY_COUNT=$((RETRY_COUNT+1))
        sleep 2
      done
      if [ $RETRY_COUNT -eq $MAX_RETRIES ]; then
        echo "Failed to connect to mysql after $MAX_RETRIES attempts"
        exit 1
      fi
      echo "MySQL is available"
  containers:
  - name: myapp
    image: myapp:v1.0
```

**åœºæ™¯2: æ–‡ä»¶ä¸‹è½½å¤±è´¥**

```bash
# ç—‡çŠ¶
kubectl logs myapp-pod -c init-download
# Downloading config from https://config.example.com/app.yaml
# curl: (6) Could not resolve host: config.example.com

# è¯Šæ–­
# 1. æ£€æŸ¥DNSè§£æ
kubectl run test --image=busybox:1.36 -it --rm --   nslookup config.example.com

# 2. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
kubectl run test --image=curlimages/curl -it --rm --   curl -v https://config.example.com/app.yaml

# 3. æ£€æŸ¥Initå®¹å™¨é…ç½®
kubectl get pod myapp-pod -o yaml | grep -A 20 "initContainers:"

# è§£å†³æ–¹æ¡ˆ
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  initContainers:
  - name: init-download
    image: curlimages/curl:latest
    command:
    - 'sh'
    - '-c'
    - |
      # æ·»åŠ é‡è¯•é€»è¾‘
      MAX_RETRIES=5
      RETRY_COUNT=0
      until curl -f -o /config/app.yaml https://config.example.com/app.yaml || [ $RETRY_COUNT -eq $MAX_RETRIES ]; do
        echo "Download failed, retrying... ($RETRY_COUNT/$MAX_RETRIES)"
        RETRY_COUNT=$((RETRY_COUNT+1))
        sleep 5
      done
      if [ $RETRY_COUNT -eq $MAX_RETRIES ]; then
        echo "Failed to download config after $MAX_RETRIES attempts"
        exit 1
      fi
      echo "Config downloaded successfully"
    volumeMounts:
    - name: config
      mountPath: /config
  containers:
  - name: myapp
    image: myapp:v1.0
    volumeMounts:
    - name: config
      mountPath: /etc/app
  volumes:
  - name: config
    emptyDir: {}
```

**åœºæ™¯3: æ•°æ®åº“è¿ç§»å¤±è´¥**

```yaml
# åœºæ™¯: Initå®¹å™¨æ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬å¤±è´¥

# Podé…ç½®
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  initContainers:
  - name: db-migration
    image: migrate/migrate:latest
    command:
    - 'migrate'
    - '-path'
    - '/migrations'
    - '-database'
    - 'postgres://user:pass@postgres:5432/mydb?sslmode=disable'
    - 'up'
    env:
    - name: DB_HOST
      value: "postgres.default.svc.cluster.local"
    - name: DB_USER
      valueFrom:
        secretKeyRef:
          name: db-secret
          key: username
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: db-secret
          key: password
    volumeMounts:
    - name: migrations
      mountPath: /migrations
  containers:
  - name: myapp
    image: myapp:v1.0
  volumes:
  - name: migrations
    configMap:
      name: db-migrations

# è¯Šæ–­
kubectl logs myapp-pod -c db-migration
# error: Dirty database version 3. Fix and force version.

# è§£å†³æ–¹æ¡ˆ: æ‰‹åŠ¨ä¿®å¤æ•°æ®åº“è¿ç§»çŠ¶æ€
kubectl run db-fix --image=postgres:15 -it --rm --   psql -h postgres.default.svc.cluster.local -U user -d mydb
# åœ¨psqlä¸­:
# UPDATE schema_migrations SET dirty = false WHERE version = 3;

# æˆ–æ·»åŠ å¼ºåˆ¶ç‰ˆæœ¬å‚æ•°
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  initContainers:
  - name: db-migration
    image: migrate/migrate:latest
    command:
    - 'sh'
    - '-c'
    - |
      # å…ˆæ£€æŸ¥æ•°æ®åº“çŠ¶æ€
      migrate -path /migrations -database "$DB_URL" version
      # å¦‚æœå¤±è´¥ï¼Œå¼ºåˆ¶è®¾ç½®ç‰ˆæœ¬
      if [ $? -ne 0 ]; then
        echo "Migration in dirty state, forcing version..."
        migrate -path /migrations -database "$DB_URL" force 3
      fi
      # æ‰§è¡Œè¿ç§»
      migrate -path /migrations -database "$DB_URL" up
```

**åœºæ™¯4: æƒé™é—®é¢˜**

```yaml
# åœºæ™¯: Initå®¹å™¨éœ€è¦ä¿®æ”¹æ–‡ä»¶æƒé™

# âŒ é—®é¢˜é…ç½®ï¼šæ²¡æœ‰æƒé™ä¿®æ”¹æ–‡ä»¶
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  securityContext:
    fsGroup: 1000
  initContainers:
  - name: fix-permissions
    image: busybox:1.36
    command:
    - 'sh'
    - '-c'
    - 'chmod -R 777 /data'
    securityContext:
      runAsUser: 1000  # érootç”¨æˆ·æ— æ³•chmod
    volumeMounts:
    - name: data
      mountPath: /data
  containers:
  - name: myapp
    image: myapp:v1.0
    volumeMounts:
    - name: data
      mountPath: /app/data
  volumes:
  - name: data
    emptyDir: {}

# æ—¥å¿—é”™è¯¯
kubectl logs myapp-pod -c fix-permissions
# chmod: /data: Operation not permitted

# âœ… è§£å†³æ–¹æ¡ˆAï¼šInitå®¹å™¨ä»¥rootè¿è¡Œ
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  securityContext:
    fsGroup: 1000
  initContainers:
  - name: fix-permissions
    image: busybox:1.36
    command:
    - 'sh'
    - '-c'
    - |
      chown -R 1000:1000 /data
      chmod -R 755 /data
    securityContext:
      runAsUser: 0  # rootç”¨æˆ·
    volumeMounts:
    - name: data
      mountPath: /data
  containers:
  - name: myapp
    image: myapp:v1.0
    securityContext:
      runAsUser: 1000
    volumeMounts:
    - name: data
      mountPath: /app/data
  volumes:
  - name: data
    emptyDir: {}

# âœ… è§£å†³æ–¹æ¡ˆBï¼šä½¿ç”¨fsGroupè‡ªåŠ¨è®¾ç½®æƒé™
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  securityContext:
    fsGroup: 1000      # Volumeè‡ªåŠ¨è®¾ç½®ç»„æƒé™
    fsGroupChangePolicy: "OnRootMismatch"  # ä»…åœ¨å¿…è¦æ—¶æ›´æ”¹
  containers:
  - name: myapp
    image: myapp:v1.0
    securityContext:
      runAsUser: 1000
    volumeMounts:
    - name: data
      mountPath: /app/data
  volumes:
  - name: data
    emptyDir: {}
# ä¸éœ€è¦Initå®¹å™¨ï¼ŒfsGroupè‡ªåŠ¨å¤„ç†æƒé™
```

#### Initå®¹å™¨æœ€ä½³å®è·µ

```yaml
Initå®¹å™¨æœ€ä½³å®è·µ:

1. å¹‚ç­‰æ€§:
   ç¡®ä¿Initå®¹å™¨å¯ä»¥å®‰å…¨é‡å¤æ‰§è¡Œ
   
   âœ… å¥½çš„åšæ³•:
   - æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨å†ä¸‹è½½
   - æ•°æ®åº“è¿ç§»å·¥å…·å¤©ç„¶æ”¯æŒå¹‚ç­‰
   - ä½¿ç”¨æ¡ä»¶åˆ¤æ–­é¿å…é‡å¤æ“ä½œ

2. å¿«é€Ÿå¤±è´¥:
   è®¾ç½®åˆç†çš„è¶…æ—¶å’Œé‡è¯•æ¬¡æ•°
   é¿å…æ— é™ç­‰å¾…
   
   âœ… ç¤ºä¾‹:
   command:
   - timeout
   - '60'  # 60ç§’è¶…æ—¶
   - sh
   - -c
   - |
     for i in $(seq 1 30); do
       if check_dependency; then
         exit 0
       fi
       sleep 2
     done
     exit 1

3. è¯¦ç»†æ—¥å¿—:
   è¾“å‡ºæ¸…æ™°çš„è¿›åº¦ä¿¡æ¯
   ä¾¿äºé—®é¢˜æ’æŸ¥
   
   âœ… ç¤ºä¾‹:
   echo "Step 1/3: Checking dependencies..."
   echo "Step 2/3: Downloading configuration..."
   echo "Step 3/3: Initializing database..."
   echo "Initialization completed successfully"

4. èµ„æºé™åˆ¶:
   Initå®¹å™¨ä¹Ÿéœ€è¦è®¾ç½®èµ„æºé™åˆ¶
   
   âœ… é…ç½®:
   initContainers:
   - name: init-db
     image: busybox:1.36
     resources:
       requests:
         memory: "64Mi"
         cpu: "100m"
       limits:
         memory: "128Mi"
         cpu: "200m"

5. é”™è¯¯å¤„ç†:
   æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯
   éé›¶é€€å‡ºç è¡¨ç¤ºå¤±è´¥
   
   âœ… ç¤ºä¾‹:
   if ! download_config; then
     echo "ERROR: Failed to download configuration"
     echo "Please check network connectivity and config URL"
     exit 1
   fi

6. ä¾èµ–é¡ºåº:
   åˆç†å®‰æ’Initå®¹å™¨é¡ºåº
   å…ˆæ£€æŸ¥ä¾èµ–ï¼Œå†æ‰§è¡Œè€—æ—¶æ“ä½œ
   
   âœ… é¡ºåº:
   initContainers:
   - name: check-dependencies  # å¿«é€Ÿæ£€æŸ¥
   - name: download-data       # è€—æ—¶ä¸‹è½½
   - name: initialize-app      # åº”ç”¨åˆå§‹åŒ–
```

### 11.2.7 Podæ•…éšœæ’æŸ¥æ¸…å•

æœ€åï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç³»ç»ŸåŒ–çš„Podæ•…éšœæ’æŸ¥æ£€æŸ¥æ¸…å•ï¼š

```yaml
Podæ•…éšœæ’æŸ¥æ£€æŸ¥æ¸…å•:

ç¬¬ä¸€æ­¥: åŸºç¡€ä¿¡æ¯æ”¶é›† (1-2åˆ†é’Ÿ)
  â–¡ kubectl get pod <pod-name>
    - æŸ¥çœ‹STATUSå’ŒRESTARTS
  
  â–¡ kubectl describe pod <pod-name>
    - æŸ¥çœ‹Eventséƒ¨åˆ†
    - æŸ¥çœ‹Conditionséƒ¨åˆ†
    - æŸ¥çœ‹å®¹å™¨çŠ¶æ€
  
  â–¡ kubectl logs <pod-name> --previous
    - æŸ¥çœ‹å´©æºƒå‰æ—¥å¿—

ç¬¬äºŒæ­¥: æŒ‰çŠ¶æ€åˆ†ç±»æ’æŸ¥ (5-10åˆ†é’Ÿ)

PendingçŠ¶æ€:
  â–¡ æ£€æŸ¥èŠ‚ç‚¹èµ„æº: kubectl top node
  â–¡ æ£€æŸ¥Podèµ„æºè¯·æ±‚: kubectl describe pod | grep -A 5 "Requests"
  â–¡ æ£€æŸ¥nodeSelector: kubectl get pod -o yaml | grep nodeSelector
  â–¡ æ£€æŸ¥èŠ‚ç‚¹æ±¡ç‚¹: kubectl describe node | grep Taints
  â–¡ æ£€æŸ¥PVCçŠ¶æ€: kubectl get pvc

CrashLoopBackOffçŠ¶æ€:
  â–¡ æŸ¥çœ‹é€€å‡ºç : kubectl describe pod | grep "Exit Code"
  â–¡ æŸ¥çœ‹å´©æºƒæ—¥å¿—: kubectl logs <pod> --previous
  â–¡ æ£€æŸ¥é…ç½®: kubectl get pod -o yaml | grep -A 20 "env:"
  â–¡ æ£€æŸ¥ä¾èµ–æœåŠ¡: kubectl get svc
  â–¡ éªŒè¯é•œåƒå¯åŠ¨å‘½ä»¤

ImagePullBackOffçŠ¶æ€:
  â–¡ æ£€æŸ¥é•œåƒåç§°: kubectl get pod -o yaml | grep image:
  â–¡ æ£€æŸ¥imagePullSecrets: kubectl describe pod | grep "Image Pull Secrets"
  â–¡ æµ‹è¯•é•œåƒæ‹‰å–: docker pull <image>
  â–¡ æ£€æŸ¥ç½‘ç»œè¿é€šæ€§

OOMKilledçŠ¶æ€:
  â–¡ æŸ¥çœ‹å†…å­˜é™åˆ¶: kubectl describe pod | grep "Limits"
  â–¡ æŸ¥çœ‹å®é™…ä½¿ç”¨: kubectl top pod <pod>
  â–¡ æ£€æŸ¥åº”ç”¨æ—¥å¿—æ˜¯å¦æœ‰å†…å­˜ç›¸å…³é”™è¯¯
  â–¡ åˆ†ææ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼

Initå®¹å™¨å¤±è´¥:
  â–¡ æŸ¥çœ‹Initå®¹å™¨çŠ¶æ€: kubectl describe pod | grep -A 10 "Init Containers"
  â–¡ æŸ¥çœ‹Initå®¹å™¨æ—¥å¿—: kubectl logs <pod> -c <init-container>
  â–¡ æ£€æŸ¥Initå®¹å™¨ä¾èµ–

ç¬¬ä¸‰æ­¥: æ·±å…¥åˆ†æ (10-30åˆ†é’Ÿ)
  â–¡ è¿›å…¥å®¹å™¨æ£€æŸ¥: kubectl exec -it <pod> -- /bin/sh
  â–¡ æ£€æŸ¥å®¹å™¨è¿›ç¨‹: ps aux
  â–¡ æ£€æŸ¥ç½‘ç»œè¿æ¥: netstat -tunlp
  â–¡ æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ: df -h, ls -la
  â–¡ æµ‹è¯•ä¾èµ–è¿æ¥: curl/ping/nslookup

ç¬¬å››æ­¥: ç¯å¢ƒéªŒè¯
  â–¡ æ£€æŸ¥ConfigMap: kubectl get configmap -o yaml
  â–¡ æ£€æŸ¥Secret: kubectl get secret
  â–¡ æ£€æŸ¥Service: kubectl get svc
  â–¡ æ£€æŸ¥Endpoints: kubectl get endpoints
  â–¡ æ£€æŸ¥NetworkPolicy: kubectl get networkpolicy

ç¬¬äº”æ­¥: èŠ‚ç‚¹çº§æ’æŸ¥ (å¦‚æœé—®é¢˜æ¶‰åŠèŠ‚ç‚¹)
  â–¡ æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€: kubectl get node
  â–¡ æ£€æŸ¥èŠ‚ç‚¹èµ„æº: kubectl top node
  â–¡ ç™»å½•èŠ‚ç‚¹æ£€æŸ¥: ssh <node>
  â–¡ æŸ¥çœ‹kubeletæ—¥å¿—: journalctl -u kubelet
  â–¡ æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¶: crictl ps

å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥:
  # å¿«é€ŸæŸ¥çœ‹æ‰€æœ‰é—®é¢˜Pod
  kubectl get pods --all-namespaces --field-selector status.phase!=Running
  
  # æŸ¥çœ‹æœ€è¿‘çš„äº‹ä»¶
  kubectl get events --sort-by='.lastTimestamp' | head -20
  
  # æŸ¥çœ‹ç‰¹å®šPodçš„æ‰€æœ‰æ—¥å¿—ï¼ˆåŒ…æ‹¬Initå®¹å™¨ï¼‰
  kubectl logs <pod> --all-containers=true
  
  # å¯¼å‡ºPodå®šä¹‰è¿›è¡Œç¦»çº¿åˆ†æ
  kubectl get pod <pod> -o yaml > pod-debug.yaml
  
  # åˆ›å»ºä¸´æ—¶è°ƒè¯•Pod
  kubectl run debug --image=nicolaka/netshoot -it --rm -- bash
```

---

**æœ¬èŠ‚å°ç»“**

åœ¨11.2èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥å­¦ä¹ äº†Podæ•…éšœæ’æŸ¥çš„å„ä¸ªæ–¹é¢ï¼š

1. **PodçŠ¶æ€è¯¦è§£**: ç†è§£Pod Phaseã€å®¹å™¨çŠ¶æ€å’ŒConditionsçš„å«ä¹‰
2. **PendingçŠ¶æ€**: èµ„æºä¸è¶³ã€èŠ‚ç‚¹äº²å’Œæ€§ã€æ±¡ç‚¹å®¹å¿åº¦ã€å­˜å‚¨å·é—®é¢˜
3. **CrashLoopBackOff**: é…ç½®é”™è¯¯ã€ä¾èµ–ç¼ºå¤±ã€å¯åŠ¨å‘½ä»¤é”™è¯¯ã€æƒé™é—®é¢˜
4. **ImagePullBackOff**: ç§æœ‰ä»“åº“è®¤è¯ã€é•œåƒåç§°é”™è¯¯ã€ç½‘ç»œé—®é¢˜
5. **OOMKilled**: å†…å­˜é™åˆ¶è¿‡ä½ã€å†…å­˜æ³„æ¼ã€å³°å€¼ä½¿ç”¨ã€JVMé…ç½®
6. **Initå®¹å™¨å¤±è´¥**: ç­‰å¾…è¶…æ—¶ã€æ–‡ä»¶ä¸‹è½½å¤±è´¥ã€æ•°æ®åº“è¿ç§»é—®é¢˜ã€æƒé™é—®é¢˜
7. **ç³»ç»ŸåŒ–æ£€æŸ¥æ¸…å•**: 5æ­¥æ’æŸ¥æ³•å’Œå¸¸ç”¨å‘½ä»¤

æŒæ¡è¿™äº›æŠ€èƒ½åï¼Œä½ å°†èƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œè§£å†³ç»å¤§å¤šæ•°Podç›¸å…³é—®é¢˜ï¼

---


## 11.3 ç½‘ç»œé—®é¢˜è¯Šæ–­

ç½‘ç»œé—®é¢˜æ˜¯Kubernetesä¸­æœ€å¤æ‚ä¹Ÿæœ€å¸¸è§çš„æ•…éšœç±»å‹ä¹‹ä¸€ã€‚æœ¬èŠ‚å°†ç³»ç»ŸåŒ–åœ°ä»‹ç»å„ç§ç½‘ç»œé—®é¢˜çš„è¯Šæ–­å’Œè§£å†³æ–¹æ³•ã€‚

### 11.3.1 Kubernetesç½‘ç»œæ¨¡å‹å›é¡¾

åœ¨å¼€å§‹æ’æŸ¥ç½‘ç»œé—®é¢˜å‰ï¼Œå…ˆå›é¡¾Kubernetesçš„ç½‘ç»œæ¨¡å‹å’Œå…³é”®æ¦‚å¿µï¼š

```yaml
Kubernetesç½‘ç»œä¸‰å¤§è¦æ±‚:

1. Podé—´é€šä¿¡:
   - æ‰€æœ‰Podå¯ä»¥åœ¨ä¸ä½¿ç”¨NATçš„æƒ…å†µä¸‹ç›¸äº’é€šä¿¡
   - æ¯ä¸ªPodæœ‰ç‹¬ç«‹çš„IPåœ°å€
   - Pod IPåœ¨é›†ç¾¤å†…å…¨å±€å¯è¾¾

2. Podä¸Nodeé€šä¿¡:
   - Podå¯ä»¥ç›´æ¥è®¿é—®Node
   - Nodeå¯ä»¥ç›´æ¥è®¿é—®Pod
   - ä¸éœ€è¦NATè½¬æ¢

3. Podä¸å¤–éƒ¨é€šä¿¡:
   - é€šè¿‡Serviceæš´éœ²æœåŠ¡
   - é€šè¿‡Ingressæä¾›HTTP/HTTPSè·¯ç”±
   - é€šè¿‡NodePort/LoadBalancerå¯¹å¤–æš´éœ²

ç½‘ç»œç»„ä»¶æ¶æ„:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨ç”¨æˆ·                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  LoadBalancer  â”‚ (äº‘å‚å•†LB)
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Ingress     â”‚ (HTTPè·¯ç”±)
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Service     â”‚ (ClusterIP)
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Pod 1 â”‚      â”‚ Pod 2 â”‚      â”‚ Pod 3 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                  â”‚   CNI   â”‚ (ç½‘ç»œæ’ä»¶)
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®ç»„ä»¶:

CNIæ’ä»¶:
  - Calico: BGPè·¯ç”±ï¼Œæ”¯æŒNetworkPolicy
  - Flannel: VXLANéš§é“ï¼Œç®€å•æ˜“ç”¨
  - Cilium: eBPFï¼Œé«˜æ€§èƒ½
  - Weave: ç½‘æ ¼ç½‘ç»œ

kube-proxy:
  - iptablesæ¨¡å¼: è§„åˆ™é“¾ï¼Œé€‚åˆä¸­å°é›†ç¾¤
  - ipvsæ¨¡å¼: å“ˆå¸Œè¡¨ï¼Œé€‚åˆå¤§è§„æ¨¡é›†ç¾¤
  - è´Ÿè´£Serviceåˆ°Podçš„è´Ÿè½½å‡è¡¡

CoreDNS:
  - é›†ç¾¤å†…DNSæœåŠ¡
  - ServiceåŸŸåè§£æ
  - PodåŸŸåè§£æ
```

### 11.3.2 Serviceä¸å¯è¾¾é—®é¢˜æ’æŸ¥

Serviceæ˜¯Kubernetesä¸­æœ€å¸¸è§çš„æœåŠ¡æš´éœ²æ–¹å¼ï¼ŒServiceä¸å¯è¾¾æ˜¯æœ€é¢‘ç¹é‡åˆ°çš„ç½‘ç»œé—®é¢˜ã€‚

#### ç³»ç»ŸåŒ–æ’æŸ¥æµç¨‹

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Serviceä¸å¯è¾¾æ’æŸ¥5æ­¥æ³•
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ­¥éª¤1: éªŒè¯Serviceæ˜¯å¦å­˜åœ¨
kubectl get svc my-service
# å¦‚æœä¸å­˜åœ¨ï¼Œéœ€è¦åˆ›å»ºService

# æ­¥éª¤2: æ£€æŸ¥Serviceé…ç½®
kubectl describe svc my-service
# é‡ç‚¹æŸ¥çœ‹:
# - Type: ClusterIP/NodePort/LoadBalancer
# - Selector: æ ‡ç­¾é€‰æ‹©å™¨
# - Endpoints: åç«¯Podåˆ—è¡¨
# - Port: ç«¯å£æ˜ å°„

# æ­¥éª¤3: æ£€æŸ¥Endpoints
kubectl get endpoints my-service
# NAME         ENDPOINTS                          AGE
# my-service   10.244.1.5:8080,10.244.2.8:8080   5m

# å¦‚æœEndpointsä¸ºç©ºï¼Œè¯´æ˜æ²¡æœ‰åŒ¹é…çš„Pod

# æ­¥éª¤4: éªŒè¯Podæ ‡ç­¾
kubectl get pods --show-labels | grep my-app
# æ£€æŸ¥Podæ ‡ç­¾æ˜¯å¦ä¸Service selectoråŒ¹é…

# æ­¥éª¤5: æµ‹è¯•è¿é€šæ€§
# ä»é›†ç¾¤å†…Podæµ‹è¯•
kubectl run test --image=busybox:1.36 -it --rm --   wget -O- http://my-service:8080
```

#### åœºæ™¯1: Endpointsä¸ºç©º

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: Serviceåˆ›å»ºæˆåŠŸï¼Œä½†æ— æ³•è®¿é—®
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥Service
kubectl get svc my-service
# NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
# my-service   ClusterIP   10.96.100.10   <none>        80/TCP    5m

# 2. æ£€æŸ¥Endpoints
kubectl get endpoints my-service
# NAME         ENDPOINTS   AGE
# my-service   <none>      5m
# âŒ Endpointsä¸ºç©ºï¼

# 3. æŸ¥çœ‹Serviceè¯¦æƒ…
kubectl describe svc my-service
# Selector:  app=myapp,version=v1
# Endpoints: <none>

# 4. æ£€æŸ¥Podæ ‡ç­¾
kubectl get pods -l app=myapp --show-labels
# NAME                     READY   STATUS    LABELS
# myapp-5d7f8c9b-xyz       1/1     Running   app=myapp,version=v2
#                                            ^^^^^^^^^^^^^^^^
# é—®é¢˜: Podæ ‡ç­¾æ˜¯version=v2ï¼Œä½†Serviceé€‰æ‹©å™¨è¦æ±‚version=v1

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ä¿®æ”¹Serviceé€‰æ‹©å™¨
kubectl edit svc my-service
# ä¿®æ”¹ selector:
#   app: myapp
#   version: v2  # æ”¹ä¸ºv2

# æ–¹æ¡ˆB: ä¿®æ”¹Podæ ‡ç­¾
kubectl label pod myapp-5d7f8c9b-xyz version=v1 --overwrite

# æ–¹æ¡ˆC: ç®€åŒ–Serviceé€‰æ‹©å™¨ï¼ˆæ¨èï¼‰
kubectl edit svc my-service
# ä¿®æ”¹ selector:
#   app: myapp  # åªç”¨appæ ‡ç­¾ï¼Œä¸é™åˆ¶version

# éªŒè¯Endpointså·²ç”Ÿæˆ
kubectl get endpoints my-service
# NAME         ENDPOINTS                          AGE
# my-service   10.244.1.5:8080,10.244.2.8:8080   5m
# âœ… Endpointså·²ç”Ÿæˆ
```

#### åœºæ™¯2: ç«¯å£é…ç½®é”™è¯¯

```yaml
# ç—‡çŠ¶: Endpointså­˜åœ¨ï¼Œä½†Serviceä»æ— æ³•è®¿é—®

# 1. æ£€æŸ¥Serviceç«¯å£é…ç½®
kubectl get svc my-service -o yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: myapp
  ports:
  - protocol: TCP
    port: 80          # Serviceç«¯å£
    targetPort: 8080  # Podç«¯å£

# 2. æ£€æŸ¥Podå®é™…ç›‘å¬ç«¯å£
kubectl get pod myapp-5d7f8c9b-xyz -o yaml | grep -A 5 "ports:"
#   ports:
#   - containerPort: 80  # âŒ Podç›‘å¬80ç«¯å£
#     protocol: TCP

# é—®é¢˜: Serviceçš„targetPortæ˜¯8080ï¼Œä½†Podç›‘å¬80ç«¯å£

# 3. è¿›å…¥PodéªŒè¯
kubectl exec myapp-5d7f8c9b-xyz -- netstat -tunlp
# tcp  0  0  0.0.0.0:80  0.0.0.0:*  LISTEN  1/nginx
# ç¡®è®¤Podç›‘å¬80ç«¯å£

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ä¿®æ”¹Serviceçš„targetPort
kubectl edit svc my-service
# ä¿®æ”¹:
#   ports:
#   - protocol: TCP
#     port: 80
#     targetPort: 80  # æ”¹ä¸º80

# æ–¹æ¡ˆB: ä½¿ç”¨å‘½åç«¯å£ï¼ˆæ¨èï¼‰
# åœ¨Podä¸­å®šä¹‰å‘½åç«¯å£
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: myapp:v1.0
    ports:
    - name: http      # å‘½åç«¯å£
      containerPort: 80
      protocol: TCP

# Serviceå¼•ç”¨å‘½åç«¯å£
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: myapp
  ports:
  - protocol: TCP
    port: 80
    targetPort: http  # å¼•ç”¨å‘½åç«¯å£
```

#### åœºæ™¯3: kube-proxyé—®é¢˜

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: Endpointsæ­£å¸¸ï¼Œä½†Serviceä»æ— æ³•è®¿é—®
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥kube-proxyæ˜¯å¦è¿è¡Œ
kubectl get pods -n kube-system -l k8s-app=kube-proxy
# NAME               READY   STATUS    RESTARTS   AGE
# kube-proxy-abc     1/1     Running   0          10d
# kube-proxy-def     1/1     Running   0          10d

# 2. æŸ¥çœ‹kube-proxyæ—¥å¿—
kubectl logs -n kube-system kube-proxy-abc --tail=100
# æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯

# 3. æ£€æŸ¥kube-proxyæ¨¡å¼
kubectl logs -n kube-system kube-proxy-abc | grep "Using"
# Using iptables Proxier

# 4. éªŒè¯iptablesè§„åˆ™ï¼ˆiptablesæ¨¡å¼ï¼‰
# ç™»å½•åˆ°èŠ‚ç‚¹
ssh node-1

# æŸ¥çœ‹Serviceçš„iptablesè§„åˆ™
sudo iptables-save | grep my-service
# åº”è¯¥çœ‹åˆ°KUBE-SVC-xxxå’ŒKUBE-SEP-xxxè§„åˆ™

# 5. éªŒè¯ipvsè§„åˆ™ï¼ˆipvsæ¨¡å¼ï¼‰
sudo ipvsadm -Ln | grep 10.96.100.10
# åº”è¯¥çœ‹åˆ°Service IPå’Œåç«¯Pod IP

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: é‡å¯kube-proxy
kubectl delete pod -n kube-system -l k8s-app=kube-proxy
# kube-proxyä¼šè‡ªåŠ¨é‡å»ºiptables/ipvsè§„åˆ™

# æ–¹æ¡ˆB: æ£€æŸ¥kube-proxyé…ç½®
kubectl get configmap -n kube-system kube-proxy -o yaml
# æ£€æŸ¥modeé…ç½®æ˜¯å¦æ­£ç¡®

# æ–¹æ¡ˆC: æ‰‹åŠ¨æ¸…ç†iptablesè§„åˆ™ï¼ˆè°¨æ…ï¼‰
ssh node-1
sudo iptables -t nat -F KUBE-SERVICES
sudo iptables -t nat -F KUBE-SVC-*
# ç„¶åé‡å¯kube-proxy
```

#### åœºæ™¯4: NetworkPolicyé˜»æ­¢æµé‡

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: æŸäº›Podå¯ä»¥è®¿é—®Serviceï¼ŒæŸäº›ä¸èƒ½
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥æ˜¯å¦æœ‰NetworkPolicy
kubectl get networkpolicy
# NAME              POD-SELECTOR   AGE
# deny-all          app=myapp      5m
# allow-frontend    app=myapp      5m

# 2. æŸ¥çœ‹NetworkPolicyè¯¦æƒ…
kubectl describe networkpolicy deny-all
# Spec:
#   PodSelector:     app=myapp
#   Allowing ingress traffic:
#     To Port: 8080/TCP
#     From:
#       PodSelector: app=frontend

# åˆ†æ: åªå…è®¸å¸¦æœ‰app=frontendæ ‡ç­¾çš„Podè®¿é—®

# 3. æ£€æŸ¥æºPodæ ‡ç­¾
kubectl get pod test-pod --show-labels
# NAME       READY   STATUS    LABELS
# test-pod   1/1     Running   app=test
# âŒ æ²¡æœ‰app=frontendæ ‡ç­¾

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ç»™Podæ·»åŠ æ­£ç¡®çš„æ ‡ç­¾
kubectl label pod test-pod app=frontend

# æ–¹æ¡ˆB: ä¿®æ”¹NetworkPolicyè§„åˆ™
kubectl edit networkpolicy allow-frontend
# æ·»åŠ å…è®¸çš„æ ‡ç­¾

# æ–¹æ¡ˆC: ä¸´æ—¶åˆ é™¤NetworkPolicyï¼ˆä»…è°ƒè¯•ï¼‰
kubectl delete networkpolicy deny-all
# æµ‹è¯•è¿æ¥æ˜¯å¦æ¢å¤

# æ–¹æ¡ˆD: åˆ›å»ºæ›´å®½æ¾çš„NetworkPolicy
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-ingress
spec:
  podSelector:
    matchLabels:
      app: myapp
  policyTypes:
  - Ingress
  ingress:
  - {}  # å…è®¸æ‰€æœ‰å…¥ç«™æµé‡
```

#### åœºæ™¯5: Serviceç±»å‹é…ç½®é”™è¯¯

```yaml
# åœºæ™¯: éœ€è¦ä»é›†ç¾¤å¤–è®¿é—®ï¼Œä½†ä½¿ç”¨äº†ClusterIP

# âŒ é”™è¯¯é…ç½®
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  type: ClusterIP  # åªèƒ½é›†ç¾¤å†…è®¿é—®
  selector:
    app: myapp
  ports:
  - port: 80
    targetPort: 8080

# ä»é›†ç¾¤å¤–è®¿é—®å¤±è´¥
curl http://10.96.100.10:80
# curl: (7) Failed to connect to 10.96.100.10 port 80: No route to host

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ä½¿ç”¨NodePortï¼ˆå¼€å‘/æµ‹è¯•ç¯å¢ƒï¼‰
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  type: NodePort
  selector:
    app: myapp
  ports:
  - port: 80
    targetPort: 8080
    nodePort: 30080  # å¯é€‰ï¼Œä¸æŒ‡å®šåˆ™è‡ªåŠ¨åˆ†é…

# è®¿é—®æ–¹å¼: http://<ä»»æ„èŠ‚ç‚¹IP>:30080

# æ–¹æ¡ˆB: ä½¿ç”¨LoadBalancerï¼ˆç”Ÿäº§ç¯å¢ƒï¼Œéœ€è¦äº‘å‚å•†æ”¯æŒï¼‰
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  type: LoadBalancer
  selector:
    app: myapp
  ports:
  - port: 80
    targetPort: 8080

# äº‘å‚å•†ä¼šè‡ªåŠ¨åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨
kubectl get svc my-service
# NAME         TYPE           CLUSTER-IP     EXTERNAL-IP      PORT(S)
# my-service   LoadBalancer   10.96.100.10   203.0.113.10     80:31234/TCP

# è®¿é—®æ–¹å¼: http://203.0.113.10:80

# æ–¹æ¡ˆC: ä½¿ç”¨Ingressï¼ˆæ¨èï¼ŒHTTP/HTTPSæœåŠ¡ï¼‰
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
spec:
  rules:
  - host: myapp.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: my-service
            port:
              number: 80

# è®¿é—®æ–¹å¼: http://myapp.example.com
```

### 11.3.3 DNSè§£æé—®é¢˜æ’æŸ¥

DNSæ˜¯KubernetesæœåŠ¡å‘ç°çš„æ ¸å¿ƒï¼ŒDNSé—®é¢˜ä¼šå¯¼è‡´Podæ— æ³•é€šè¿‡åŸŸåè®¿é—®Serviceã€‚

#### DNSå·¥ä½œåŸç†

```yaml
Kubernetes DNSæ¶æ„:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Pod                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /etc/resolv.conf                            â”‚  â”‚
â”‚  â”‚  nameserver 10.96.0.10                       â”‚  â”‚
â”‚  â”‚  search default.svc.cluster.local            â”‚  â”‚
â”‚  â”‚         svc.cluster.local                    â”‚  â”‚
â”‚  â”‚         cluster.local                        â”‚  â”‚
â”‚  â”‚  options ndots:5                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ DNSæŸ¥è¯¢
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   CoreDNS      â”‚ (10.96.0.10:53)
          â”‚   Service      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚CoreDNS  â”‚          â”‚CoreDNS  â”‚
   â”‚ Pod 1   â”‚          â”‚ Pod 2   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DNSè®°å½•ç±»å‹:

Service DNS:
  æ ¼å¼: <service-name>.<namespace>.svc.cluster.local
  ç¤ºä¾‹: my-service.default.svc.cluster.local
  è§£æ: Service ClusterIP

Headless Service DNS:
  æ ¼å¼: <pod-name>.<service-name>.<namespace>.svc.cluster.local
  ç¤ºä¾‹: myapp-0.my-service.default.svc.cluster.local
  è§£æ: Pod IP

Pod DNS:
  æ ¼å¼: <pod-ip>.<namespace>.pod.cluster.local
  ç¤ºä¾‹: 10-244-1-5.default.pod.cluster.local
  è§£æ: Pod IP (IPä¸­çš„.æ›¿æ¢ä¸º-)
```

#### æ’æŸ¥æ­¥éª¤

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DNSé—®é¢˜æ’æŸ¥æµç¨‹
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ­¥éª¤1: éªŒè¯CoreDNSæ˜¯å¦è¿è¡Œ
kubectl get pods -n kube-system -l k8s-app=kube-dns
# NAME                       READY   STATUS    RESTARTS   AGE
# coredns-5d78c9cfcd-abc     1/1     Running   0          10d
# coredns-5d78c9cfcd-def     1/1     Running   0          10d

# æ­¥éª¤2: æ£€æŸ¥CoreDNS Service
kubectl get svc -n kube-system kube-dns
# NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)         AGE
# kube-dns   ClusterIP   10.96.0.10   <none>        53/UDP,53/TCP   10d

# æ­¥éª¤3: æµ‹è¯•DNSè§£æ
kubectl run test-dns --image=busybox:1.36 -it --rm -- nslookup kubernetes.default
# Server:    10.96.0.10
# Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local
#
# Name:      kubernetes.default
# Address 1: 10.96.0.1 kubernetes.default.svc.cluster.local

# æ­¥éª¤4: æ£€æŸ¥Podçš„DNSé…ç½®
kubectl run test --image=busybox:1.36 -it --rm -- cat /etc/resolv.conf
# nameserver 10.96.0.10
# search default.svc.cluster.local svc.cluster.local cluster.local
# options ndots:5

# æ­¥éª¤5: æŸ¥çœ‹CoreDNSæ—¥å¿—
kubectl logs -n kube-system -l k8s-app=kube-dns --tail=100
```

#### åœºæ™¯1: CoreDNS Podæœªè¿è¡Œ

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: æ‰€æœ‰DNSè§£æå¤±è´¥
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥CoreDNSçŠ¶æ€
kubectl get pods -n kube-system -l k8s-app=kube-dns
# NAME                       READY   STATUS             RESTARTS   AGE
# coredns-5d78c9cfcd-abc     0/1     CrashLoopBackOff   5          5m

# 2. æŸ¥çœ‹CoreDNSæ—¥å¿—
kubectl logs -n kube-system coredns-5d78c9cfcd-abc
# plugin/loop: Loop (127.0.0.1:55953 -> :53) detected for zone ".", see https://coredns.io/plugins/loop/

# é—®é¢˜: æ£€æµ‹åˆ°DNSå¾ªç¯

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ä¿®å¤èŠ‚ç‚¹DNSé…ç½®
# ç™»å½•åˆ°èŠ‚ç‚¹
ssh node-1

# æ£€æŸ¥/etc/resolv.conf
cat /etc/resolv.conf
# nameserver 127.0.0.1  # âŒ æŒ‡å‘æœ¬åœ°ï¼Œå¯¼è‡´å¾ªç¯

# ä¿®æ”¹ä¸ºæ­£ç¡®çš„DNSæœåŠ¡å™¨
sudo vi /etc/resolv.conf
# nameserver 8.8.8.8
# nameserver 8.8.4.4

# é‡å¯CoreDNS
kubectl delete pod -n kube-system -l k8s-app=kube-dns

# æ–¹æ¡ˆB: ä¿®æ”¹CoreDNSé…ç½®ç¦ç”¨loopæ£€æµ‹ï¼ˆä¸æ¨èï¼‰
kubectl edit configmap -n kube-system coredns
# åˆ é™¤ "loop" è¡Œ
```

#### åœºæ™¯2: DNSè§£æè¶…æ—¶

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: DNSè§£æéå¸¸æ…¢æˆ–è¶…æ—¶
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æµ‹è¯•DNSå“åº”æ—¶é—´
kubectl run test --image=busybox:1.36 -it --rm -- sh
# åœ¨å®¹å™¨å†…:
time nslookup kubernetes.default
# real    0m 5.123s  # âŒ è¶…è¿‡5ç§’ï¼Œå¤ªæ…¢

# 2. æ£€æŸ¥CoreDNSèµ„æºä½¿ç”¨
kubectl top pod -n kube-system -l k8s-app=kube-dns
# NAME                       CPU(cores)   MEMORY(bytes)
# coredns-5d78c9cfcd-abc     950m         180Mi
# åˆ†æ: CPUä½¿ç”¨ç‡å¾ˆé«˜

# 3. æŸ¥çœ‹CoreDNSæ—¥å¿—
kubectl logs -n kube-system coredns-5d78c9cfcd-abc | grep -i error
# [ERROR] plugin/errors: 2 kubernetes.default.svc.cluster.local. A: read udp 10.244.1.5:53->10.96.0.10:53: i/o timeout

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: å¢åŠ CoreDNSå‰¯æœ¬æ•°
kubectl scale deployment -n kube-system coredns --replicas=3

# æ–¹æ¡ˆB: å¢åŠ CoreDNSèµ„æºé™åˆ¶
kubectl edit deployment -n kube-system coredns
# ä¿®æ”¹:
#   resources:
#     requests:
#       cpu: 200m
#       memory: 256Mi
#     limits:
#       cpu: 500m
#       memory: 512Mi

# æ–¹æ¡ˆC: å¯ç”¨DNSç¼“å­˜
# åœ¨Podä¸­ä½¿ç”¨NodeLocal DNSCache
# å‚è€ƒ: https://kubernetes.io/docs/tasks/administer-cluster/nodelocaldns/

# æ–¹æ¡ˆD: ä¼˜åŒ–CoreDNSé…ç½®
kubectl edit configmap -n kube-system coredns
# æ·»åŠ ç¼“å­˜é…ç½®:
#   cache 30  # ç¼“å­˜30ç§’
```

#### åœºæ™¯3: ç‰¹å®šåŸŸåæ— æ³•è§£æ

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: é›†ç¾¤å†…åŸŸåå¯ä»¥è§£æï¼Œå¤–éƒ¨åŸŸåæ— æ³•è§£æ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æµ‹è¯•é›†ç¾¤å†…åŸŸå
kubectl run test --image=busybox:1.36 -it --rm --   nslookup kubernetes.default
# âœ… æˆåŠŸ

# 2. æµ‹è¯•å¤–éƒ¨åŸŸå
kubectl run test --image=busybox:1.36 -it --rm --   nslookup www.google.com
# ;; connection timed out; no servers could be reached
# âŒ å¤±è´¥

# 3. æ£€æŸ¥CoreDNSé…ç½®
kubectl get configmap -n kube-system coredns -o yaml
# data:
#   Corefile: |
#     .:53 {
#         errors
#         health
#         kubernetes cluster.local in-addr.arpa ip6.arpa {
#            pods insecure
#            fallthrough in-addr.arpa ip6.arpa
#         }
#         prometheus :9153
#         forward . /etc/resolv.conf  # è½¬å‘åˆ°èŠ‚ç‚¹DNS
#         cache 30
#         loop
#         reload
#         loadbalance
#     }

# 4. æ£€æŸ¥èŠ‚ç‚¹DNSé…ç½®
ssh node-1
cat /etc/resolv.conf
# nameserver 192.168.1.1  # èŠ‚ç‚¹DNSæœåŠ¡å™¨

# æµ‹è¯•èŠ‚ç‚¹DNS
nslookup www.google.com
# âŒ èŠ‚ç‚¹DNSä¹Ÿæ— æ³•è§£æ

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ä¿®æ”¹CoreDNSè½¬å‘åˆ°å…¬å…±DNS
kubectl edit configmap -n kube-system coredns
# ä¿®æ”¹:
#   forward . 8.8.8.8 8.8.4.4  # ä½¿ç”¨Google DNS

# é‡å¯CoreDNS
kubectl delete pod -n kube-system -l k8s-app=kube-dns

# æ–¹æ¡ˆB: ä¿®å¤èŠ‚ç‚¹DNSé…ç½®
ssh node-1
sudo vi /etc/resolv.conf
# nameserver 8.8.8.8
# nameserver 8.8.4.4

# æ–¹æ¡ˆC: æ·»åŠ è‡ªå®šä¹‰DNSæœåŠ¡å™¨
kubectl edit configmap -n kube-system coredns
# æ·»åŠ :
#   forward . 8.8.8.8 8.8.4.4 {
#     max_concurrent 1000
#   }
```

#### åœºæ™¯4: ndotsé…ç½®é—®é¢˜

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: DNSæŸ¥è¯¢æ¬¡æ•°è¿‡å¤šï¼Œæ€§èƒ½å·®
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥Podçš„DNSé…ç½®
kubectl run test --image=busybox:1.36 -it --rm -- cat /etc/resolv.conf
# nameserver 10.96.0.10
# search default.svc.cluster.local svc.cluster.local cluster.local
# options ndots:5

# 2. æµ‹è¯•DNSæŸ¥è¯¢
kubectl run test --image=busybox:1.36 -it --rm -- sh
# åœ¨å®¹å™¨å†…å¯ç”¨DNSæŸ¥è¯¢æ—¥å¿—
nslookup -debug www.google.com
# è¾“å‡ºæ˜¾ç¤ºå¤šæ¬¡æŸ¥è¯¢:
# www.google.com.default.svc.cluster.local  # ç¬¬1æ¬¡
# www.google.com.svc.cluster.local          # ç¬¬2æ¬¡
# www.google.com.cluster.local              # ç¬¬3æ¬¡
# www.google.com                            # ç¬¬4æ¬¡ âœ…

# é—®é¢˜: ndots:5 å¯¼è‡´åŸŸåä¸­ç‚¹æ•°<5æ—¶ï¼Œä¼šå°è¯•æ‰€æœ‰searchåŸŸ

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ä½¿ç”¨å®Œæ•´åŸŸåï¼ˆFQDNï¼‰
# åœ¨åº”ç”¨ä¸­ä½¿ç”¨å®Œæ•´åŸŸåï¼Œæœ«å°¾åŠ ç‚¹
# ä¾‹å¦‚: www.google.com. (æ³¨æ„æœ«å°¾çš„ç‚¹)

# æ–¹æ¡ˆB: è‡ªå®šä¹‰Podçš„dnsConfig
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  dnsConfig:
    options:
    - name: ndots
      value: "2"  # é™ä½ndotså€¼
  containers:
  - name: myapp
    image: myapp:v1.0

# æ–¹æ¡ˆC: åœ¨åº”ç”¨å±‚ä¼˜åŒ–
# ä½¿ç”¨IPåœ°å€è€ŒéåŸŸåï¼ˆå¦‚æœå¯èƒ½ï¼‰
# æˆ–ç¼“å­˜DNSè§£æç»“æœ
```



### 11.3.4 NetworkPolicyè°ƒè¯•

NetworkPolicyç”¨äºæ§åˆ¶Podé—´çš„ç½‘ç»œæµé‡ï¼Œé…ç½®ä¸å½“ä¼šå¯¼è‡´è¿æ¥é—®é¢˜ã€‚

#### NetworkPolicyå·¥ä½œåŸç†

```yaml
NetworkPolicyåŸºç¡€æ¦‚å¿µ:

ç­–ç•¥ç±»å‹:
  Ingress: æ§åˆ¶å…¥ç«™æµé‡ï¼ˆè¿›å…¥Podçš„æµé‡ï¼‰
  Egress:  æ§åˆ¶å‡ºç«™æµé‡ï¼ˆä»Podå‘å‡ºçš„æµé‡ï¼‰

é€‰æ‹©å™¨:
  podSelector:     é€‰æ‹©åº”ç”¨ç­–ç•¥çš„Pod
  namespaceSelector: é€‰æ‹©å…è®¸çš„å‘½åç©ºé—´
  ipBlock:         é€‰æ‹©å…è®¸çš„IPæ®µ

é»˜è®¤è¡Œä¸º:
  - æ²¡æœ‰NetworkPolicyæ—¶ï¼Œæ‰€æœ‰æµé‡éƒ½å…è®¸
  - ä¸€æ—¦æœ‰NetworkPolicyåº”ç”¨åˆ°Podï¼Œé»˜è®¤æ‹’ç»æ‰€æœ‰æµé‡
  - åªæœ‰æ˜ç¡®å…è®¸çš„æµé‡æ‰èƒ½é€šè¿‡

ç¤ºä¾‹æ¶æ„:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Namespace: frontend                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ Web Pod  â”‚ (app=web)                            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚       â”‚ âœ… å…è®¸è®¿é—®backend                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Namespace: backend                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚ API Pod      â”‚ (app=api)                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚         â”‚ âœ… å…è®¸è®¿é—®database                       â”‚
â”‚         â”‚ âŒ æ‹’ç»å…¶ä»–è®¿é—®                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Namespace: database                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚ MySQL Pod    â”‚ (app=mysql)                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚  âŒ åªå…è®¸backendå‘½åç©ºé—´è®¿é—®                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ’æŸ¥æ–¹æ³•

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# NetworkPolicyæ’æŸ¥æµç¨‹
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ­¥éª¤1: æ£€æŸ¥æ˜¯å¦æœ‰NetworkPolicy
kubectl get networkpolicy --all-namespaces
# NAMESPACE   NAME              POD-SELECTOR   AGE
# default     deny-all          app=api        5m
# default     allow-frontend    app=api        5m

# æ­¥éª¤2: æŸ¥çœ‹NetworkPolicyè¯¦æƒ…
kubectl describe networkpolicy deny-all
# Spec:
#   PodSelector:     app=api
#   Allowing ingress traffic:
#     To Port: 8080/TCP
#     From:
#       PodSelector: app=frontend
#   Policy Types: Ingress

# æ­¥éª¤3: æµ‹è¯•è¿æ¥
# ä»å…è®¸çš„Podæµ‹è¯•
kubectl run frontend --image=busybox:1.36 --labels="app=frontend" -it --rm --   wget -O- http://api-service:8080
# âœ… åº”è¯¥æˆåŠŸ

# ä»ä¸å…è®¸çš„Podæµ‹è¯•
kubectl run test --image=busybox:1.36 -it --rm --   wget -O- http://api-service:8080
# âŒ åº”è¯¥è¶…æ—¶

# æ­¥éª¤4: æ£€æŸ¥CNIæ’ä»¶æ˜¯å¦æ”¯æŒNetworkPolicy
kubectl get pods -n kube-system | grep -E "calico|cilium|weave"
# ç¡®è®¤ç½‘ç»œæ’ä»¶æ”¯æŒNetworkPolicy
```

#### åœºæ™¯1: æ„å¤–é˜»æ­¢äº†åˆæ³•æµé‡

```yaml
# ç—‡çŠ¶: åº”ç”¨çªç„¶æ— æ³•è®¿é—®æ•°æ®åº“

# 1. æ£€æŸ¥NetworkPolicy
kubectl get networkpolicy -n database
# NAME              POD-SELECTOR   AGE
# mysql-policy      app=mysql      2m

kubectl describe networkpolicy -n database mysql-policy
# Spec:
#   PodSelector:     app=mysql
#   Allowing ingress traffic:
#     To Port: 3306/TCP
#     From:
#       NamespaceSelector:
#         matchLabels:
#           name: backend  # âŒ è¦æ±‚å‘½åç©ºé—´æœ‰name=backendæ ‡ç­¾
#   Policy Types: Ingress

# 2. æ£€æŸ¥å‘½åç©ºé—´æ ‡ç­¾
kubectl get namespace backend --show-labels
# NAME      STATUS   AGE   LABELS
# backend   Active   10d   <none>
# âŒ å‘½åç©ºé—´æ²¡æœ‰name=backendæ ‡ç­¾

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: ç»™å‘½åç©ºé—´æ·»åŠ æ ‡ç­¾
kubectl label namespace backend name=backend

# éªŒè¯è¿æ¥æ¢å¤
kubectl run test -n backend --image=mysql:8.0 -it --rm --   mysql -h mysql.database.svc.cluster.local -u root -p
# âœ… åº”è¯¥èƒ½è¿æ¥

# æ–¹æ¡ˆB: ä¿®æ”¹NetworkPolicyä½¿ç”¨å‘½åç©ºé—´åç§°
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: mysql-policy
  namespace: database
spec:
  podSelector:
    matchLabels:
      app: mysql
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: backend  # ä½¿ç”¨å†…ç½®æ ‡ç­¾
    ports:
    - protocol: TCP
      port: 3306

# æ–¹æ¡ˆC: ä½¿ç”¨Podé€‰æ‹©å™¨ä»£æ›¿å‘½åç©ºé—´é€‰æ‹©å™¨
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: mysql-policy
  namespace: database
spec:
  podSelector:
    matchLabels:
      app: mysql
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: api  # å…è®¸æ‰€æœ‰å‘½åç©ºé—´ä¸­app=apiçš„Pod
    ports:
    - protocol: TCP
      port: 3306
```

#### åœºæ™¯2: Egressç­–ç•¥é˜»æ­¢å¤–éƒ¨è®¿é—®

```yaml
# ç—‡çŠ¶: Podæ— æ³•è®¿é—®å¤–éƒ¨API

# 1. æ£€æŸ¥NetworkPolicy
kubectl describe networkpolicy egress-policy
# Spec:
#   PodSelector:     app=myapp
#   Allowing egress traffic:
#     To Port: 443/TCP
#     To:
#       PodSelector: app=api
#   Policy Types: Egress

# é—®é¢˜: åªå…è®¸è®¿é—®é›†ç¾¤å†…çš„app=api Podï¼Œä¸å…è®¸å¤–éƒ¨è®¿é—®

# 2. æµ‹è¯•å¤–éƒ¨è®¿é—®
kubectl run test --labels="app=myapp" --image=curlimages/curl -it --rm --   curl https://api.github.com
# curl: (28) Connection timed out
# âŒ è¶…æ—¶

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: æ·»åŠ å…è®¸å¤–éƒ¨è®¿é—®çš„è§„åˆ™
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: egress-policy
spec:
  podSelector:
    matchLabels:
      app: myapp
  policyTypes:
  - Egress
  egress:
  # å…è®¸è®¿é—®é›†ç¾¤å†…API
  - to:
    - podSelector:
        matchLabels:
          app: api
    ports:
    - protocol: TCP
      port: 443
  # å…è®¸è®¿é—®å¤–éƒ¨HTTPS
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
        except:
        - 169.254.169.254/32  # æ’é™¤äº‘å‚å•†å…ƒæ•°æ®æœåŠ¡
    ports:
    - protocol: TCP
      port: 443
  # å…è®¸DNSæŸ¥è¯¢
  - to:
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: kube-system
      podSelector:
        matchLabels:
          k8s-app: kube-dns
    ports:
    - protocol: UDP
      port: 53

# æ–¹æ¡ˆB: å…è®¸ç‰¹å®šåŸŸåï¼ˆéœ€è¦Ciliumç­‰é«˜çº§CNIï¼‰
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: egress-policy
spec:
  endpointSelector:
    matchLabels:
      app: myapp
  egress:
  - toFQDNs:
    - matchName: "api.github.com"
    toPorts:
    - ports:
      - port: "443"
        protocol: TCP
```

#### åœºæ™¯3: NetworkPolicyä¸ç”Ÿæ•ˆ

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: åˆ›å»ºäº†NetworkPolicyï¼Œä½†æµé‡æ²¡æœ‰è¢«é˜»æ­¢
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥CNIæ’ä»¶æ˜¯å¦æ”¯æŒNetworkPolicy
kubectl get pods -n kube-system -o wide | grep -E "calico|cilium|weave"

# å¦‚æœä½¿ç”¨Flannel:
kubectl get pods -n kube-system | grep flannel
# âŒ Flannelä¸æ”¯æŒNetworkPolicy

# 2. æ£€æŸ¥NetworkPolicyæ˜¯å¦åº”ç”¨åˆ°æ­£ç¡®çš„Pod
kubectl get networkpolicy deny-all -o yaml
# spec:
#   podSelector:
#     matchLabels:
#       app: api

kubectl get pods --show-labels | grep api
# myapp-pod   1/1   Running   app=myapp  # âŒ æ ‡ç­¾ä¸åŒ¹é…

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: æ›´æ¢æ”¯æŒNetworkPolicyçš„CNIæ’ä»¶
# å®‰è£…Calico
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml

# æ–¹æ¡ˆB: ä¿®æ­£Podæ ‡ç­¾
kubectl label pod myapp-pod app=api --overwrite

# æ–¹æ¡ˆC: ä¿®æ­£NetworkPolicyé€‰æ‹©å™¨
kubectl edit networkpolicy deny-all
# ä¿®æ”¹ podSelector åŒ¹é…æ­£ç¡®çš„æ ‡ç­¾
```

### 11.3.5 CNIæ’ä»¶é—®é¢˜æ’æŸ¥

CNI (Container Network Interface) æ’ä»¶è´Ÿè´£Podçš„ç½‘ç»œé…ç½®ï¼ŒCNIé—®é¢˜ä¼šå¯¼è‡´Podæ— æ³•é€šä¿¡ã€‚

#### å¸¸è§CNIæ’ä»¶

```yaml
ä¸»æµCNIæ’ä»¶å¯¹æ¯”:

Calico:
  ç½‘ç»œæ¨¡å¼: BGPè·¯ç”± / VXLANéš§é“
  NetworkPolicy: âœ… æ”¯æŒ
  æ€§èƒ½: â­â­â­â­â­
  å¤æ‚åº¦: ä¸­ç­‰
  é€‚ç”¨åœºæ™¯: ç”Ÿäº§ç¯å¢ƒï¼Œéœ€è¦NetworkPolicy

Flannel:
  ç½‘ç»œæ¨¡å¼: VXLANéš§é“ / host-gw
  NetworkPolicy: âŒ ä¸æ”¯æŒ
  æ€§èƒ½: â­â­â­â­
  å¤æ‚åº¦: ç®€å•
  é€‚ç”¨åœºæ™¯: å¼€å‘/æµ‹è¯•ç¯å¢ƒ

Cilium:
  ç½‘ç»œæ¨¡å¼: eBPF
  NetworkPolicy: âœ… æ”¯æŒï¼ˆå¢å¼ºï¼‰
  æ€§èƒ½: â­â­â­â­â­
  å¤æ‚åº¦: é«˜
  é€‚ç”¨åœºæ™¯: é«˜æ€§èƒ½éœ€æ±‚ï¼ŒL7ç­–ç•¥

Weave:
  ç½‘ç»œæ¨¡å¼: ç½‘æ ¼ç½‘ç»œ
  NetworkPolicy: âœ… æ”¯æŒ
  æ€§èƒ½: â­â­â­
  å¤æ‚åº¦: ç®€å•
  é€‚ç”¨åœºæ™¯: å¿«é€Ÿéƒ¨ç½²
```

#### æ’æŸ¥æ–¹æ³•

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CNIé—®é¢˜æ’æŸ¥æµç¨‹
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ­¥éª¤1: æ£€æŸ¥CNIæ’ä»¶æ˜¯å¦è¿è¡Œ
kubectl get pods -n kube-system | grep -E "calico|flannel|cilium|weave"
# NAME                          READY   STATUS    RESTARTS   AGE
# calico-node-abc               1/1     Running   0          10d
# calico-node-def               1/1     Running   0          10d

# æ­¥éª¤2: æ£€æŸ¥CNIé…ç½®æ–‡ä»¶
ssh node-1
ls -la /etc/cni/net.d/
# 10-calico.conflist

cat /etc/cni/net.d/10-calico.conflist
# æŸ¥çœ‹CNIé…ç½®

# æ­¥éª¤3: æ£€æŸ¥CNIäºŒè¿›åˆ¶æ–‡ä»¶
ls -la /opt/cni/bin/
# calico  flannel  bridge  host-local  ...

# æ­¥éª¤4: æŸ¥çœ‹CNIæ—¥å¿—
kubectl logs -n kube-system calico-node-abc
```

#### åœºæ™¯1: Podæ— æ³•åˆ†é…IP

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: Podä¸€ç›´å¤„äºContainerCreatingçŠ¶æ€
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æŸ¥çœ‹PodçŠ¶æ€
kubectl get pod myapp-pod
# NAME        READY   STATUS              RESTARTS   AGE
# myapp-pod   0/1     ContainerCreating   0          5m

# 2. æŸ¥çœ‹è¯¦ç»†äº‹ä»¶
kubectl describe pod myapp-pod
# Events:
#   Warning  FailedCreatePodSandBox  2m  kubelet  
#   Failed to create pod sandbox: rpc error: code = Unknown 
#   desc = failed to setup network for sandbox: 
#   plugin type="calico" failed: error getting ClusterInformation: 
#   connection refused

# 3. æ£€æŸ¥CNIæ’ä»¶çŠ¶æ€
kubectl get pods -n kube-system -l k8s-app=calico-node
# NAME                READY   STATUS             RESTARTS   AGE
# calico-node-abc     0/1     CrashLoopBackOff   5          5m

# 4. æŸ¥çœ‹CNIæ—¥å¿—
kubectl logs -n kube-system calico-node-abc
# Calico node failed to start: error getting cluster information: 
# Get "https://10.96.0.1:443/apis/crd.projectcalico.org/v1/clusterinformations/default": 
# dial tcp 10.96.0.1:443: connect: connection refused

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: æ£€æŸ¥API Serverè¿æ¥
# Calicoéœ€è¦è®¿é—®API Server
kubectl get svc kubernetes
# NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
# kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   10d

# æµ‹è¯•ä»èŠ‚ç‚¹è®¿é—®API Server
ssh node-1
curl -k https://10.96.0.1:443
# å¦‚æœæ— æ³•è®¿é—®ï¼Œæ£€æŸ¥é˜²ç«å¢™è§„åˆ™

# æ–¹æ¡ˆB: æ£€æŸ¥Calicoé…ç½®
kubectl get installation -o yaml
# æ£€æŸ¥datastoreé…ç½®

# æ–¹æ¡ˆC: é‡æ–°å®‰è£…CNIæ’ä»¶
kubectl delete -f calico.yaml
kubectl apply -f calico.yaml

# æ–¹æ¡ˆD: æ£€æŸ¥IPæ± é…ç½®
kubectl get ippool -o yaml
# ç¡®è®¤IPæ± é…ç½®æ­£ç¡®ï¼Œæ²¡æœ‰è€—å°½
```

#### åœºæ™¯2: Podé—´æ— æ³•é€šä¿¡

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: Podæœ‰IPï¼Œä½†æ— æ³•ç›¸äº’pingé€š
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥Pod IP
kubectl get pod -o wide
# NAME      READY   STATUS    IP            NODE
# pod-a     1/1     Running   10.244.1.5    node-1
# pod-b     1/1     Running   10.244.2.8    node-2

# 2. æµ‹è¯•è¿é€šæ€§
kubectl exec pod-a -- ping 10.244.2.8
# PING 10.244.2.8 (10.244.2.8): 56 data bytes
# (æ— å“åº”ï¼Œè¶…æ—¶)

# 3. æ£€æŸ¥CNIæ’ä»¶æ—¥å¿—
kubectl logs -n kube-system calico-node-abc | grep -i error
# ERROR: Failed to create veth pair: operation not permitted

# 4. æ£€æŸ¥èŠ‚ç‚¹é—´ç½‘ç»œ
# ä»node-1 ping node-2
ssh node-1
ping <node-2-ip>
# âœ… èŠ‚ç‚¹é—´ç½‘ç»œæ­£å¸¸

# 5. æ£€æŸ¥è·¯ç”±è¡¨
ssh node-1
ip route
# åº”è¯¥çœ‹åˆ°åˆ°å…¶ä»–èŠ‚ç‚¹Podç½‘æ®µçš„è·¯ç”±

# 6. æ£€æŸ¥iptablesè§„åˆ™
sudo iptables-save | grep FORWARD
# æ£€æŸ¥FORWARDé“¾æ˜¯å¦å…è®¸æµé‡

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: æ£€æŸ¥èŠ‚ç‚¹é˜²ç«å¢™
ssh node-1
# å…è®¸Podç½‘æ®µæµé‡
sudo iptables -A FORWARD -s 10.244.0.0/16 -j ACCEPT
sudo iptables -A FORWARD -d 10.244.0.0/16 -j ACCEPT

# æ–¹æ¡ˆB: æ£€æŸ¥CNIé…ç½®
# ç¡®è®¤ç½‘ç»œæ¨¡å¼é…ç½®æ­£ç¡®
kubectl get configmap -n kube-system calico-config -o yaml

# æ–¹æ¡ˆC: é‡å¯CNIæ’ä»¶
kubectl delete pod -n kube-system -l k8s-app=calico-node

# æ–¹æ¡ˆD: æ£€æŸ¥IP-in-IPæˆ–VXLANé…ç½®
# Calico IP-in-IPæ¨¡å¼
kubectl get ippool default-ipv4-ippool -o yaml
# spec:
#   ipipMode: Always  # æˆ– CrossSubnet

# å¦‚æœä½¿ç”¨VXLAN
# spec:
#   vxlanMode: Always
```

#### åœºæ™¯3: CNIé…ç½®å†²çª

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: å®‰è£…äº†å¤šä¸ªCNIæ’ä»¶ï¼Œå¯¼è‡´å†²çª
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥CNIé…ç½®æ–‡ä»¶
ssh node-1
ls -la /etc/cni/net.d/
# 10-calico.conflist
# 10-flannel.conflist  # âŒ æœ‰å¤šä¸ªCNIé…ç½®

# 2. æ£€æŸ¥kubeletæ—¥å¿—
journalctl -u kubelet | grep -i cni
# Error: multiple CNI configurations found

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: åˆ é™¤ä¸éœ€è¦çš„CNIé…ç½®
ssh node-1
sudo rm /etc/cni/net.d/10-flannel.conflist

# é‡å¯kubelet
sudo systemctl restart kubelet

# æ–¹æ¡ˆB: å®Œå…¨å¸è½½æ—§CNIæ’ä»¶
# å¸è½½Flannel
kubectl delete -f flannel.yaml
# æ¸…ç†èŠ‚ç‚¹ä¸Šçš„Flannelæ–‡ä»¶
ssh node-1
sudo rm -rf /etc/cni/net.d/10-flannel.conflist
sudo rm -rf /opt/cni/bin/flannel
sudo rm -rf /run/flannel

# æ–¹æ¡ˆC: ä½¿ç”¨CNIé…ç½®ä¼˜å…ˆçº§
# ç¡®ä¿åªæœ‰ä¸€ä¸ªCNIé…ç½®æ–‡ä»¶
# æ–‡ä»¶åæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜
```

### 11.3.6 Ingressé—®é¢˜æ’æŸ¥

Ingressæä¾›HTTP/HTTPSè·¯ç”±ï¼Œæ˜¯å¯¹å¤–æš´éœ²æœåŠ¡çš„å¸¸ç”¨æ–¹å¼ã€‚

#### Ingressæ¶æ„

```yaml
Ingresså·¥ä½œæµç¨‹:

å¤–éƒ¨ç”¨æˆ·
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DNSè§£æ         â”‚ myapp.example.com â†’ LoadBalancer IP
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LoadBalancer    â”‚ (äº‘å‚å•†LBæˆ–NodePort)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ingress         â”‚ (Nginx/Traefik/HAProxy)
â”‚  Controller      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ /api    â†’ api-service:80
         â”œâ”€ /web    â†’ web-service:80
         â””â”€ /admin  â†’ admin-service:80
              â”‚
              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Service â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
              â”‚
         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
         â–¼         â–¼
      Pod-1     Pod-2

å¸¸è§Ingress Controller:

Nginx Ingress:
  - æœ€æµè¡Œ
  - åŠŸèƒ½ä¸°å¯Œ
  - æ€§èƒ½å¥½

Traefik:
  - è‡ªåŠ¨æœåŠ¡å‘ç°
  - æ”¯æŒå¤šç§åç«¯
  - é…ç½®ç®€å•

HAProxy Ingress:
  - é«˜æ€§èƒ½
  - ä¼ä¸šçº§ç‰¹æ€§
  - å¤æ‚é…ç½®

Kong Ingress:
  - APIç½‘å…³åŠŸèƒ½
  - æ’ä»¶ç”Ÿæ€
  - é€‚åˆå¾®æœåŠ¡
```

#### æ’æŸ¥æµç¨‹

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ingressé—®é¢˜æ’æŸ¥æµç¨‹
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ­¥éª¤1: æ£€æŸ¥Ingress Controlleræ˜¯å¦è¿è¡Œ
kubectl get pods -n ingress-nginx
# NAME                                   READY   STATUS    RESTARTS   AGE
# ingress-nginx-controller-abc           1/1     Running   0          10d

# æ­¥éª¤2: æ£€æŸ¥Ingressèµ„æº
kubectl get ingress
# NAME          CLASS   HOSTS                ADDRESS        PORTS   AGE
# my-ingress    nginx   myapp.example.com    203.0.113.10   80      5m

# æ­¥éª¤3: æŸ¥çœ‹Ingressè¯¦æƒ…
kubectl describe ingress my-ingress
# Rules:
#   Host                Path  Backends
#   ----                ----  --------
#   myapp.example.com
#                       /   my-service:80 (10.244.1.5:8080,10.244.2.8:8080)

# æ­¥éª¤4: æ£€æŸ¥Serviceå’ŒEndpoints
kubectl get svc my-service
kubectl get endpoints my-service

# æ­¥éª¤5: æµ‹è¯•è®¿é—®
curl -H "Host: myapp.example.com" http://203.0.113.10/
```

#### åœºæ™¯1: Ingressæ— æ³•è®¿é—®

```bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç—‡çŠ¶: è®¿é—®IngressåŸŸåè¿”å›404æˆ–è¶…æ—¶
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. æ£€æŸ¥Ingressé…ç½®
kubectl get ingress my-ingress -o yaml
# spec:
#   rules:
#   - host: myapp.example.com
#     http:
#       paths:
#       - path: /
#         pathType: Prefix
#         backend:
#           service:
#             name: my-service
#             port:
#               number: 80

# 2. æ£€æŸ¥Ingress Controlleræ—¥å¿—
kubectl logs -n ingress-nginx ingress-nginx-controller-abc
# æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯

# 3. æµ‹è¯•ç›´æ¥è®¿é—®Service
kubectl run test --image=curlimages/curl -it --rm --   curl http://my-service:80
# âœ… Serviceå¯ä»¥è®¿é—®

# 4. æµ‹è¯•Ingress Controller
# è·å–Ingress Controllerçš„Pod IP
kubectl get pod -n ingress-nginx -o wide
# NAME                                   IP            NODE
# ingress-nginx-controller-abc           10.244.1.10   node-1

# ç›´æ¥è®¿é—®Ingress Controller
kubectl run test --image=curlimages/curl -it --rm --   curl -H "Host: myapp.example.com" http://10.244.1.10/
# å¦‚æœæˆåŠŸï¼Œè¯´æ˜Ingress Controlleré…ç½®æ­£ç¡®

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: æ£€æŸ¥Ingress Class
kubectl get ingressclass
# NAME    CONTROLLER             PARAMETERS   AGE
# nginx   k8s.io/ingress-nginx   <none>       10d

# ç¡®ä¿Ingressä½¿ç”¨æ­£ç¡®çš„IngressClass
kubectl edit ingress my-ingress
# spec:
#   ingressClassName: nginx  # æ·»åŠ æ­¤è¡Œ

# æ–¹æ¡ˆB: æ£€æŸ¥Serviceç«¯å£
kubectl get svc my-service
# NAME         TYPE        CLUSTER-IP     PORT(S)   AGE
# my-service   ClusterIP   10.96.100.10   80/TCP    5m

# ç¡®ä¿Ingress backendç«¯å£ä¸Serviceç«¯å£åŒ¹é…

# æ–¹æ¡ˆC: æ£€æŸ¥DNSè§£æ
nslookup myapp.example.com
# ç¡®ä¿åŸŸåè§£æåˆ°Ingress Controllerçš„å¤–éƒ¨IP

# æ–¹æ¡ˆD: æ£€æŸ¥TLSé…ç½®ï¼ˆHTTPSåœºæ™¯ï¼‰
kubectl describe ingress my-ingress
# TLS:
#   my-tls-secret terminates myapp.example.com

kubectl get secret my-tls-secret
# ç¡®ä¿TLSè¯ä¹¦å­˜åœ¨ä¸”æœ‰æ•ˆ
```

#### åœºæ™¯2: è·¯å¾„è·¯ç”±ä¸å·¥ä½œ

```yaml
# ç—‡çŠ¶: æ ¹è·¯å¾„å¯ä»¥è®¿é—®ï¼Œå­è·¯å¾„è¿”å›404

# Ingressé…ç½®
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
spec:
  rules:
  - host: myapp.example.com
    http:
      paths:
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: api-service
            port:
              number: 80
      - path: /web
        pathType: Prefix
        backend:
          service:
            name: web-service
            port:
              number: 80

# æµ‹è¯•
curl http://myapp.example.com/api/users
# 404 Not Found

#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è§£å†³æ–¹æ¡ˆ
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ–¹æ¡ˆA: æ£€æŸ¥pathType
# Prefix: åŒ¹é…è·¯å¾„å‰ç¼€
# Exact: ç²¾ç¡®åŒ¹é…
# ImplementationSpecific: ç”±Ingress Controllerå†³å®š

# ä¿®æ”¹ä¸ºExactï¼ˆå¦‚æœéœ€è¦ï¼‰
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
spec:
  rules:
  - host: myapp.example.com
    http:
      paths:
      - path: /api
        pathType: Exact  # åªåŒ¹é… /api
        backend:
          service:
            name: api-service
            port:
              number: 80

# æ–¹æ¡ˆB: ä½¿ç”¨rewriteæ³¨è§£ï¼ˆNginx Ingressï¼‰
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
spec:
  rules:
  - host: myapp.example.com
    http:
      paths:
      - path: /api(/|$)(.*)
        pathType: Prefix
        backend:
          service:
            name: api-service
            port:
              number: 80
# /api/users â†’ /users (å»æ‰/apiå‰ç¼€)

# æ–¹æ¡ˆC: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è·¯å¾„
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
  annotations:
    nginx.ingress.kubernetes.io/use-regex: "true"
spec:
  rules:
  - host: myapp.example.com
    http:
      paths:
      - path: /api/.*
        pathType: ImplementationSpecific
        backend:
          service:
            name: api-service
            port:
              number: 80
```

---

**æœ¬èŠ‚å°ç»“**

åœ¨11.3èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥å­¦ä¹ äº†Kubernetesç½‘ç»œé—®é¢˜çš„è¯Šæ–­æ–¹æ³•ï¼š

1. **ç½‘ç»œæ¨¡å‹å›é¡¾**: Podé—´é€šä¿¡ã€CNIæ’ä»¶ã€kube-proxyã€CoreDNSæ¶æ„
2. **Serviceä¸å¯è¾¾**: Endpointsä¸ºç©ºã€ç«¯å£é”™è¯¯ã€kube-proxyé—®é¢˜ã€NetworkPolicyã€Serviceç±»å‹
3. **DNSè§£æé—®é¢˜**: CoreDNSæ•…éšœã€è§£æè¶…æ—¶ã€å¤–éƒ¨åŸŸåã€ndotsé…ç½®
4. **NetworkPolicyè°ƒè¯•**: ç­–ç•¥ä¸ç”Ÿæ•ˆã€æ„å¤–é˜»æ­¢æµé‡ã€Egressé™åˆ¶
5. **CNIæ’ä»¶é—®é¢˜**: IPåˆ†é…å¤±è´¥ã€Podé—´æ— æ³•é€šä¿¡ã€é…ç½®å†²çª
6. **Ingressæ’æŸ¥**: æ— æ³•è®¿é—®ã€è·¯å¾„è·¯ç”±ã€TLSé…ç½®

æŒæ¡è¿™äº›æŠ€èƒ½åï¼Œä½ å°†èƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œè§£å†³å„ç§Kubernetesç½‘ç»œé—®é¢˜ï¼

---

