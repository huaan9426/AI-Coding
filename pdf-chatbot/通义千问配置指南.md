# é€šä¹‰åƒé—® API é…ç½®æŒ‡å—

## ğŸ¯ ä¸ºä»€ä¹ˆé€‰æ‹©é€šä¹‰åƒé—®ï¼Ÿ

- âœ… **å®Œå…¨å…è´¹**ï¼šæ–°ç”¨æˆ·èµ é€ 100 ä¸‡ tokens å…è´¹é¢åº¦
- âœ… **æ— éœ€ä¿¡ç”¨å¡**ï¼šä»…éœ€æ‰‹æœºå·å³å¯æ³¨å†Œ
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šqwen-turbo æ€§èƒ½æ¥è¿‘ GPT-3.5
- âœ… **ä¸­æ–‡ä¼˜åŒ–**ï¼šå¯¹ä¸­æ–‡ç†è§£æ›´å‡†ç¡®

---

## ğŸ“ è·å– API Keyï¼ˆ5åˆ†é’Ÿå®Œæˆï¼‰

### 1ï¸âƒ£ æ³¨å†Œé˜¿é‡Œäº‘è´¦å·

è®¿é—®ï¼šhttps://dashscope.console.aliyun.com/

- ä½¿ç”¨æ‰‹æœºå·æ³¨å†Œï¼ˆæ”¯æŒå›½å†…æ‰‹æœºå·ï¼‰
- å®Œæˆå®åè®¤è¯ï¼ˆä¸Šä¼ èº«ä»½è¯ç…§ç‰‡ï¼‰

### 2ï¸âƒ£ å¼€é€š DashScope æœåŠ¡

1. ç™»å½•åè¿›å…¥ [DashScope æ§åˆ¶å°](https://dashscope.console.aliyun.com/)
2. ç‚¹å‡»**ç«‹å³å¼€é€š**ï¼ˆå…è´¹ï¼‰
3. åŒæ„æœåŠ¡åè®®

### 3ï¸âƒ£ åˆ›å»º API Key

1. è¿›å…¥ **API-KEY ç®¡ç†**é¡µé¢
2. ç‚¹å‡»**åˆ›å»ºæ–°çš„ API-KEY**
3. å¤åˆ¶ç”Ÿæˆçš„ API Keyï¼ˆæ ¼å¼ï¼š`sk-xxxxxxxxxxxxxx`ï¼‰

### 4ï¸âƒ£ é…ç½®åˆ°é¡¹ç›®

ç¼–è¾‘é¡¹ç›®æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ï¼š

```bash
# å°† your-dashscope-api-key æ›¿æ¢ä¸ºæ‚¨å¤åˆ¶çš„ API Key
DASHSCOPE_API_KEY=sk-xxxxxxxxxxxxxx
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ Poetryï¼ˆæ¨èï¼‰
poetry install

# æˆ–ä½¿ç”¨ pip
pip install -e .
```

### 2. é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½æœ¬åœ° Embedding æ¨¡å‹

```bash
poetry run pdf-chatbot
```

é¦–æ¬¡è¿è¡Œæ—¶ä¼šæç¤ºï¼š
```
ğŸ“¥ é¦–æ¬¡ä½¿ç”¨ä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹ï¼ˆçº¦ 100MBï¼‰ï¼Œè¯·ç¨å€™...
```

æ¨¡å‹ä¼šè‡ªåŠ¨ä¸‹è½½åˆ° `~/.cache/huggingface/` ç›®å½•ï¼Œ**ä»…éœ€ä¸‹è½½ä¸€æ¬¡**ã€‚

### 3. åŠ è½½ PDF å¹¶å¼€å§‹æé—®

```
ğŸ“„ è¯·è¾“å…¥ PDF æ–‡ä»¶è·¯å¾„: /path/to/your/file.pdf
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### LLM æä¾›å•†

åœ¨ `.env` ä¸­é…ç½®ï¼š

```bash
# é€‰æ‹© LLM æä¾›å•†ï¼ˆqwen / openaiï¼‰
LLM_PROVIDER=qwen

# é€šä¹‰åƒé—®æ¨¡å‹é€‰æ‹©
# - qwen-turbo: å…è´¹ï¼Œæ€§èƒ½æ¥è¿‘ GPT-3.5
# - qwen-plus: æ€§èƒ½æ¥è¿‘ GPT-4ï¼ˆéœ€ä»˜è´¹ï¼‰
# - qwen-max: æœ€å¼ºæ€§èƒ½ï¼ˆéœ€ä»˜è´¹ï¼‰
MODEL_NAME=qwen-turbo
```

### Embedding æ¨¡å‹

```bash
# é€‰æ‹© Embedding æä¾›å•†ï¼ˆlocal / openaiï¼‰
EMBEDDING_PROVIDER=local

# æœ¬åœ°æ¨¡å‹ï¼ˆæ¨èï¼Œå…è´¹ï¼‰
# - BAAI/bge-small-zh-v1.5: ä¸­æ–‡ä¼˜åŒ–ï¼Œè½»é‡çº§ï¼ˆ100MBï¼‰
# - BAAI/bge-large-zh-v1.5: æ›´é«˜ç²¾åº¦ï¼ˆ1.3GBï¼‰
LOCAL_EMBEDDING_MODEL=BAAI/bge-small-zh-v1.5
```

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: API Key æ— æ•ˆï¼Ÿ

**é”™è¯¯æç¤ºï¼š**
```
âŒ DashScope API Key æ— æ•ˆæˆ–å·²è¿‡æœŸ
```

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `DASHSCOPE_API_KEY` æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ API Key ä»¥ `sk-` å¼€å¤´
3. ç™»å½• [DashScope æ§åˆ¶å°](https://dashscope.console.aliyun.com/) æ£€æŸ¥ API Key çŠ¶æ€

### Q2: æ¨¡å‹ä¸‹è½½å¤±è´¥ï¼Ÿ

**é”™è¯¯æç¤ºï¼š**
```
âŒ åˆå§‹åŒ– Embedding æ¨¡å‹å¤±è´¥
```

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ˆéœ€è®¿é—® HuggingFaceï¼‰
2. é…ç½® HuggingFace é•œåƒï¼ˆå›½å†…ç”¨æˆ·ï¼‰ï¼š

```bash
export HF_ENDPOINT=https://hf-mirror.com
```

3. æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹åˆ°ç¼“å­˜ç›®å½•ï¼š

```bash
# åˆ›å»ºç¼“å­˜ç›®å½•
mkdir -p ~/.cache/huggingface/

# å…‹éš†æ¨¡å‹ï¼ˆä½¿ç”¨é•œåƒï¼‰
cd ~/.cache/huggingface/
git clone https://hf-mirror.com/BAAI/bge-small-zh-v1.5
```

### Q3: å…è´¹é¢åº¦ç”¨å®Œäº†æ€ä¹ˆåŠï¼Ÿ

**æŸ¥çœ‹é¢åº¦ï¼š**
è®¿é—® [DashScope æ§åˆ¶å° - è´¹ç”¨ä¸­å¿ƒ](https://dashscope.console.aliyun.com/billing)

**å……å€¼æ–¹å¼ï¼š**
- æ”¯æŒæ”¯ä»˜å®/å¾®ä¿¡æ”¯ä»˜
- æœ€ä½å……å€¼ 10 å…ƒäººæ°‘å¸
- qwen-turbo ä»·æ ¼ï¼š0.4 å…ƒ / ç™¾ä¸‡ tokensï¼ˆéå¸¸ä¾¿å®œï¼‰

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹ | ä»·æ ¼ | ä¸­æ–‡èƒ½åŠ› | é€Ÿåº¦ | æ¨èåœºæ™¯ |
|------|------|---------|------|---------|
| **qwen-turbo** | å…è´¹/0.4å…ƒ/M | â­â­â­â­â­ | å¿« | æ—¥å¸¸ä½¿ç”¨ |
| qwen-plus | 4å…ƒ/M | â­â­â­â­â­ | ä¸­ç­‰ | å¤æ‚ä»»åŠ¡ |
| gpt-3.5-turbo | 10.5å…ƒ/M | â­â­â­ | å¿« | è‹±æ–‡ä¼˜å…ˆ |
| gpt-4 | 210å…ƒ/M | â­â­â­â­ | æ…¢ | é«˜ç²¾åº¦éœ€æ±‚ |

> **ç»“è®º**ï¼šå¯¹äºä¸­æ–‡ PDF é—®ç­”ï¼Œ**qwen-turbo æ€§ä»·æ¯”æœ€é«˜**ï¼

---

## ğŸ”„ åˆ‡æ¢å› OpenAI

å¦‚æœéœ€è¦åˆ‡æ¢å› OpenAIï¼Œåªéœ€ä¿®æ”¹ `.env`ï¼š

```bash
# åˆ‡æ¢ä¸º OpenAI
LLM_PROVIDER=openai
OPENAI_API_KEY=sk-your-openai-key

# ä½¿ç”¨ OpenAI Embedding
EMBEDDING_PROVIDER=openai
EMBEDDING_MODEL=text-embedding-3-small
```

---

## ğŸ“š æ›´å¤šèµ„æº

- [é€šä¹‰åƒé—®å®˜æ–¹æ–‡æ¡£](https://help.aliyun.com/zh/dashscope/)
- [DashScope API å‚è€ƒ](https://help.aliyun.com/zh/dashscope/developer-reference/api-details)
- [é€šä¹‰åƒé—®æ¨¡å‹ä»·æ ¼](https://help.aliyun.com/zh/dashscope/developer-reference/tongyi-thousand-questions-metering-and-billing)
- [æœ¬åœ° Embedding æ¨¡å‹åˆ—è¡¨](https://huggingface.co/BAAI)

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

é…ç½®å®Œæˆåï¼Œè¿è¡Œï¼š

```bash
poetry run pdf-chatbot
```

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
